
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/logo_circle.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>Mobile App Authentication Architectures - OWASP Mobile Security Project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mobile-app-authentication-architectures" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OWASP Mobile Security Project" class="md-header__button md-logo" aria-label="OWASP Mobile Security Project" data-md-component="logo">
      
  <img src="../../assets/logo_circle.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OWASP Mobile Security Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mobile App Authentication Architectures
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/OWASP/owasp-mstg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/owasp-mstg
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../donate/" class="md-tabs__link">
      ♡ Donations
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../news/" class="md-tabs__link">
      News
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../talks/" class="md-tabs__link">
      Talks
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../0x01-Foreword/" class="md-tabs__link md-tabs__link--active">
        MSTG
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/1_How_Can_You_Contribute/" class="md-tabs__link">
        Contributing
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OWASP Mobile Security Project" class="md-nav__button md-logo" aria-label="OWASP Mobile Security Project" data-md-component="logo">
      
  <img src="../../assets/logo_circle.png" alt="logo">

    </a>
    OWASP Mobile Security Project
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/OWASP/owasp-mstg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/owasp-mstg
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../donate/" class="md-nav__link">
        ♡ Donations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../news/" class="md-nav__link">
        News
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../talks/" class="md-nav__link">
        Talks
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          MSTG
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MSTG" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          MSTG
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x01-Foreword/" class="md-nav__link">
        Foreword
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x02a-Frontispiece/" class="md-nav__link">
        Frontispiece
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x02b-MASVS-MSTG-Adoption/" class="md-nav__link">
        OWASP MASVS and MSTG Adoption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x02c-Acknowledgements/" class="md-nav__link">
        Acknowledgments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x03-Overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04a-Mobile-App-Taxonomy/" class="md-nav__link">
        Mobile App Taxonomy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04b-Mobile-App-Security-Testing/" class="md-nav__link">
        Mobile App Security Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04c-Tampering-and-Reverse-Engineering/" class="md-nav__link">
        Mobile App Tampering and Reverse Engineering
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Mobile App Authentication Architectures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Mobile App Authentication Architectures
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-guidelines-on-testing-authentication" class="md-nav__link">
    General Guidelines on Testing Authentication
  </a>
  
    <nav class="md-nav" aria-label="General Guidelines on Testing Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stateful-vs-stateless-authentication" class="md-nav__link">
    Stateful vs. Stateless Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supplementary-authentication" class="md-nav__link">
    Supplementary Authentication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-that-appropriate-authentication-is-in-place-mstg-arch-2-and-mstg-auth-1" class="md-nav__link">
    Verifying that Appropriate Authentication is in Place (MSTG-ARCH-2 and MSTG-AUTH-1)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-best-practices-for-passwords-mstg-auth-5-and-mstg-auth-6" class="md-nav__link">
    Testing Best Practices for Passwords (MSTG-AUTH-5 and MSTG-AUTH-6)
  </a>
  
    <nav class="md-nav" aria-label="Testing Best Practices for Passwords (MSTG-AUTH-5 and MSTG-AUTH-6)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-analysis" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav" aria-label="Static Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zxcvbn" class="md-nav__link">
    zxcvbn
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#have-i-been-pwned-pwnedpasswords" class="md-nav__link">
    Have I Been Pwned: PwnedPasswords
  </a>
  
    <nav class="md-nav" aria-label="Have I Been Pwned: PwnedPasswords">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-throttling" class="md-nav__link">
    Login Throttling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-testing-mstg-auth-6" class="md-nav__link">
    Dynamic Testing (MSTG-AUTH-6)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-stateful-session-management-mstg-auth-2" class="md-nav__link">
    Testing Stateful Session Management (MSTG-AUTH-2)
  </a>
  
    <nav class="md-nav" aria-label="Testing Stateful Session Management (MSTG-AUTH-2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-management-best-practices" class="md-nav__link">
    Session Management Best Practices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-session-timeout-mstg-auth-7" class="md-nav__link">
    Testing Session Timeout (MSTG-AUTH-7)
  </a>
  
    <nav class="md-nav" aria-label="Testing Session Timeout (MSTG-AUTH-7)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-analysis_1" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-user-logout-mstg-auth-4" class="md-nav__link">
    Testing User Logout (MSTG-AUTH-4)
  </a>
  
    <nav class="md-nav" aria-label="Testing User Logout (MSTG-AUTH-4)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-analysis_2" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_1" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-two-factor-authentication-and-step-up-authentication-mstg-auth-9-and-mstg-auth-10" class="md-nav__link">
    Testing Two-Factor Authentication and Step-up Authentication (MSTG-AUTH-9 and MSTG-AUTH-10)
  </a>
  
    <nav class="md-nav" aria-label="Testing Two-Factor Authentication and Step-up Authentication (MSTG-AUTH-9 and MSTG-AUTH-10)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dangers-of-sms-otp" class="md-nav__link">
    Dangers of SMS-OTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction-signing-with-push-notifications-and-pki" class="md-nav__link">
    Transaction Signing with Push Notifications and PKI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_3" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-testing" class="md-nav__link">
    Dynamic Testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-stateless-token-based-authentication-mstg-auth-3" class="md-nav__link">
    Testing Stateless (Token-Based) Authentication (MSTG-AUTH-3)
  </a>
  
    <nav class="md-nav" aria-label="Testing Stateless (Token-Based) Authentication (MSTG-AUTH-3)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-analysis_4" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav" aria-label="Static Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enforcing-the-hashing-algorithm" class="md-nav__link">
    Enforcing the Hashing Algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-expiration" class="md-nav__link">
    Token Expiration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_2" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-oauth-20-flows-mstg-auth-1-and-mstg-auth-3" class="md-nav__link">
    Testing OAuth 2.0 Flows (MSTG-AUTH-1 and MSTG-AUTH-3)
  </a>
  
    <nav class="md-nav" aria-label="Testing OAuth 2.0 Flows (MSTG-AUTH-1 and MSTG-AUTH-3)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauth-20-best-practices" class="md-nav__link">
    OAUTH 2.0 Best Practices
  </a>
  
    <nav class="md-nav" aria-label="OAUTH 2.0 Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-user-agent-vs-embedded-user-agent" class="md-nav__link">
    External User Agent vs. Embedded User Agent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-oauth2-best-practices" class="md-nav__link">
    Other OAuth2 Best Practices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-login-activity-and-device-blocking-mstg-auth-11" class="md-nav__link">
    Testing Login Activity and Device Blocking (MSTG-AUTH-11)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#owasp-masvs" class="md-nav__link">
    OWASP MASVS
  </a>
  
    <nav class="md-nav" aria-label="OWASP MASVS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sms-otp-research" class="md-nav__link">
    SMS-OTP Research
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04f-Testing-Network-Communication/" class="md-nav__link">
        Mobile App Network Communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04g-Testing-Cryptography/" class="md-nav__link">
        Mobile App Cryptography
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04h-Testing-Code-Quality/" class="md-nav__link">
        Mobile App Code Quality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04i-Testing-User-Privacy-Protection/" class="md-nav__link">
        Mobile App User Privacy Protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05a-Platform-Overview/" class="md-nav__link">
        Android Platform Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05b-Basic-Security_Testing/" class="md-nav__link">
        Android Basic Security Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05c-Reverse-Engineering-and-Tampering/" class="md-nav__link">
        Android Tampering and Reverse Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05d-Testing-Data-Storage/" class="md-nav__link">
        Android Data Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05e-Testing-Cryptography/" class="md-nav__link">
        Android Cryptographic APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05f-Testing-Local-Authentication/" class="md-nav__link">
        Android Local Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05g-Testing-Network-Communication/" class="md-nav__link">
        Android Network APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05h-Testing-Platform-Interaction/" class="md-nav__link">
        Android Platform APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05i-Testing-Code-Quality-and-Build-Settings/" class="md-nav__link">
        Android Code Quality and Build Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05j-Testing-Resiliency-Against-Reverse-Engineering/" class="md-nav__link">
        Android Anti-Reversing Defenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06a-Platform-Overview/" class="md-nav__link">
        iOS Platform Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06b-Basic-Security-Testing/" class="md-nav__link">
        iOS Basic Security Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06c-Reverse-Engineering-and-Tampering/" class="md-nav__link">
        iOS Tampering and Reverse Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06d-Testing-Data-Storage/" class="md-nav__link">
        iOS Data Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06e-Testing-Cryptography/" class="md-nav__link">
        iOS Cryptographic APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06f-Testing-Local-Authentication/" class="md-nav__link">
        iOS Local Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06g-Testing-Network-Communication/" class="md-nav__link">
        iOS Network APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06h-Testing-Platform-Interaction/" class="md-nav__link">
        iOS Platform APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06i-Testing-Code-Quality-and-Build-Settings/" class="md-nav__link">
        iOS Code Quality and Build Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06j-Testing-Resiliency-Against-Reverse-Engineering/" class="md-nav__link">
        iOS Anti-Reversing Defenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x07-Appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x08-Testing-Tools/" class="md-nav__link">
        Testing Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x09-Suggested-Reading/" class="md-nav__link">
        Suggested Reading
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/1_How_Can_You_Contribute/" class="md-nav__link">
        How Can You Contribute?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/2_Getting_Started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/3_PRs_and_Reviews/" class="md-nav__link">
        Pull Requests & Reviews
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/4_Add_new_Language/" class="md-nav__link">
        Add a New Language
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/5_Style_Guide/" class="md-nav__link">
        Style Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/OWASP/owasp-mstg/edit/master/docs/MSTG/0x04e-Testing-Authentication-and-Session-Management.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="mobile-app-authentication-architectures">Mobile App Authentication Architectures<a class="headerlink" href="#mobile-app-authentication-architectures" title="Permanent link">&para;</a></h1>
<p>Authentication and authorization problems are prevalent security vulnerabilities. In fact, they consistently rank second highest in the <a href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project">OWASP Top 10</a>.</p>
<p>Most mobile apps implement some kind of user authentication. Even though part of the authentication and state management logic is performed by the backend service, authentication is such an integral part of most mobile app architectures that understanding its common implementations is important.</p>
<p>Since the basic concepts are identical on iOS and Android, we'll discuss prevalent authentication and authorization architectures and pitfalls in this generic guide. OS-specific authentication issues, such as local and biometric authentication, will be discussed in the respective OS-specific chapters.</p>
<h2 id="general-guidelines-on-testing-authentication">General Guidelines on Testing Authentication<a class="headerlink" href="#general-guidelines-on-testing-authentication" title="Permanent link">&para;</a></h2>
<p>There's no one-size-fits-all approach to authentication. When reviewing the authentication architecture of an app, you should first consider whether the authentication method(s) used are appropriate in the given context. Authentication can be based on one or more of the following:</p>
<ul>
<li>Something the user knows (password, PIN, pattern, etc.)</li>
<li>Something the user has (SIM card, one-time password generator, or hardware token)</li>
<li>A biometric property of the user (fingerprint, retina, voice)</li>
</ul>
<p>The number of authentication procedures implemented by mobile apps depends on the sensitivity of the functions or accessed resources. Refer to industry best practices when reviewing authentication functions. Username/password authentication (combined with a reasonable password policy) is generally considered sufficient for apps that have a user login and aren't very sensitive. This form of authentication is used by most social media apps.</p>
<p>For sensitive apps, adding a second authentication factor is usually appropriate. This includes apps that provide access to very sensitive information (such as credit card numbers) or allow users to transfer funds. In some industries, these apps must also comply with certain standards. For example, financial apps have to ensure compliance with the Payment Card Industry Data Security Standard (PCI DSS), the Gramm Leach Bliley Act, and the Sarbanes-Oxley Act (SOX). Compliance considerations for the US health care sector include the Health Insurance Portability and Accountability Act (HIPAA) and the Patient Safety Rule.</p>
<p>You can also use the <a href="https://github.com/OWASP/owasp-masvs/blob/master/Document/0x09-V4-Authentication_and_Session_Management_Requirements.md" title="OWASP MASVS: Authentication">OWASP Mobile AppSec Verification Standard</a> as a guideline. For non-critical apps ("Level 1"), the MASVS lists the following authentication requirements:</p>
<ul>
<li>If the app provides users with access to a remote service, an acceptable form of authentication such as username/password authentication is performed at the remote endpoint.</li>
<li>A password policy exists and is enforced at the remote endpoint.</li>
<li>The remote endpoint implements an exponential back-off, or temporarily locks the user account, when incorrect authentication credentials are submitted an excessive number of times.</li>
</ul>
<p>For sensitive apps ("Level 2"), the MASVS adds the following:</p>
<ul>
<li>A second factor of authentication exists at the remote endpoint and the 2FA requirement is consistently enforced.</li>
<li>Step-up authentication is required to enable actions that deal with sensitive data or transactions.</li>
<li>The app informs the user of the recent activities with their account when they log in.</li>
</ul>
<p>You can find details on how to test for the requirements above in the following sections.</p>
<p><br/>
<br/></p>
<h3 id="stateful-vs-stateless-authentication">Stateful vs. Stateless Authentication<a class="headerlink" href="#stateful-vs-stateless-authentication" title="Permanent link">&para;</a></h3>
<p>You'll usually find that the mobile app uses HTTP as the transport layer. The HTTP protocol itself is stateless, so there must be a way to associate a user's subsequent HTTP requests with that user. Otherwise, the user's log in credentials would have to be sent with every request. Also, both the server and client need to keep track of user data (e.g., the user's privileges or role). This can be done in two different ways:</p>
<ul>
<li>
<p>With <em>stateful</em> authentication, a unique session id is generated when the user logs in. In subsequent requests, this session ID serves as a reference to the user details stored on the server. The session ID is <em>opaque</em>; it doesn't contain any user data.</p>
</li>
<li>
<p>With <em>stateless</em> authentication, all user-identifying information is stored in a client-side token. The token can be passed to any server or micro service, eliminating the need to maintain session state on the server. Stateless authentication is often factored out to an authorization server, which produces, signs, and optionally encrypts the token upon user login.</p>
</li>
</ul>
<p>Web applications commonly use stateful authentication with a random session ID that is stored in a client-side cookie. Although mobile apps sometimes use stateful sessions in a similar fashion, stateless token-based approaches are becoming popular for a variety of reasons:</p>
<ul>
<li>They improve scalability and performance by eliminating the need to store session state on the server.</li>
<li>Tokens enable developers to decouple authentication from the app. Tokens can be generated by an authentication server, and the authentication scheme can be changed seamlessly.</li>
</ul>
<p>As a mobile security tester, you should be familiar with both types of authentication.</p>
<h3 id="supplementary-authentication">Supplementary Authentication<a class="headerlink" href="#supplementary-authentication" title="Permanent link">&para;</a></h3>
<p>Authentication schemes are sometimes supplemented by <a href="https://pdfs.semanticscholar.org/13aa/7bf53070ac8e209a84f6389bab58a1e2c888.pdf" title="Best Practices for Multi-factor Authentication">passive contextual authentication</a>, which can incorporate:</p>
<ul>
<li>Geolocation</li>
<li>IP address</li>
<li>Time of day</li>
<li>The device being used</li>
</ul>
<p>Ideally, in such a system the user's context is compared to previously recorded data to identify anomalies that might indicate account abuse or potential fraud. This process is transparent to the user, but can become a powerful deterrent to attackers.</p>
<h2 id="verifying-that-appropriate-authentication-is-in-place-mstg-arch-2-and-mstg-auth-1">Verifying that Appropriate Authentication is in Place (MSTG-ARCH-2 and MSTG-AUTH-1)<a class="headerlink" href="#verifying-that-appropriate-authentication-is-in-place-mstg-arch-2-and-mstg-auth-1" title="Permanent link">&para;</a></h2>
<p>Perform the following steps when testing authentication and authorization:</p>
<ul>
<li>Identify the additional authentication factors the app uses.</li>
<li>Locate all endpoints that provide critical functionality.</li>
<li>Verify that the additional factors are strictly enforced on all server-side endpoints.</li>
</ul>
<p>Authentication bypass vulnerabilities exist when authentication state is not consistently enforced on the server and when the client can tamper with the state. While the backend service is processing requests from the mobile client, it must consistently enforce authorization checks: verifying that the user is logged in and authorized every time a resource is requested.</p>
<p>Consider the following example from the <a href="https://www.owasp.org/index.php/Testing_for_Bypassing_Authentication_Schema_%28OTG-AUTHN-004%29" title="Testing for Bypassing Authentication Schema (OTG-AUTHN-004)">OWASP Web Testing Guide</a>. In the example, a web resource is accessed through a URL, and the authentication state is passed through a GET parameter:</p>
<div class="highlight"><pre><span></span><code>http://www.site.com/page.asp?authenticated=no
</code></pre></div>
<p>The client can arbitrarily change the GET parameters sent with the request. Nothing prevents the client from simply changing the value of the <code>authenticated</code> parameter to "yes", effectively bypassing authentication.</p>
<p>Although this is a simplistic example that you probably won't find in the wild, programmers sometimes rely on "hidden" client-side parameters, such as cookies, to maintain authentication state. They assume that these parameters can't be tampered with. Consider, for example, the following <a href="http://seclists.org/bugtraq/2009/May/251" title="SEC Consult SA-20090525-0 :: Nortel Contact Center Manager Server Authentication Bypass Vulnerability">classic vulnerability in Nortel Contact Center Manager</a>. The administrative web application of Nortel's appliance relied on the cookie "isAdmin" to determine whether the logged-in user should be granted administrative privileges. Consequently, it was possible to get admin access by simply setting the cookie value as follows:</p>
<div class="highlight"><pre><span></span><code>isAdmin=True
</code></pre></div>
<p>Security experts used to recommend using session-based authentication and maintaining session data on the server only. This prevents any form of client-side tampering with the session state. However, the whole point of using stateless authentication instead of session-based authentication is to <em>not</em> have session state on the server. Instead, state is stored in client-side tokens and transmitted with every request. In this case, seeing client-side parameters such as <code>isAdmin</code> is perfectly normal.</p>
<p>To prevent tampering cryptographic signatures are added to client-side tokens. Of course, things may go wrong, and popular implementations of stateless authentication have been vulnerable to attacks. For example, the signature verification of some JSON Web Token (JWT) implementations could be deactivated by <a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/" title="Critical vulnerabilities in JSON Web Token libraries">setting the signature type to "None"</a>. We'll discuss this attack in more detail in the "Testing JSON Web Tokens" chapter.</p>
<h2 id="testing-best-practices-for-passwords-mstg-auth-5-and-mstg-auth-6">Testing Best Practices for Passwords (MSTG-AUTH-5 and MSTG-AUTH-6)<a class="headerlink" href="#testing-best-practices-for-passwords-mstg-auth-5-and-mstg-auth-6" title="Permanent link">&para;</a></h2>
<p>Password strength is a key concern when passwords are used for authentication. The password policy defines requirements to which end users should adhere. A password policy typically specifies password length, password complexity, and password topologies. A "strong" password policy makes manual or automated password cracking difficult or impossible. The following sections will cover various areas regarding password best practices. For further information please consult the <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Authentication_Cheat_Sheet.md#implement-proper-password-strength-controls" title="Implement Proper Password Strength Controls">OWASP Authentication Cheat Sheet</a>.</p>
<h3 id="static-analysis">Static Analysis<a class="headerlink" href="#static-analysis" title="Permanent link">&para;</a></h3>
<p>Confirm the existence of a password policy and verify the implemented password complexity requirements according to the <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Authentication_Cheat_Sheet.md#implement-proper-password-strength-controls" title="Implement Proper Password Strength Controls">OWASP Authentication Cheat Sheet</a> which focuses on length and an unlimited character set. Identify all password-related functions in the source code and make sure that a verification check is performed in each of them. Review the password verification function and make sure that it rejects passwords that violate the password policy.</p>
<h4 id="zxcvbn">zxcvbn<a class="headerlink" href="#zxcvbn" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/dropbox/zxcvbn" title="zxcvbn">zxcvbn</a> is a common library that can be used for estimating password strength, inspired by password crackers. It is available in JavaScript but also for many other programming languages on the server side. There are different methods of installation, please check the Github repo for your preferred method. Once installed, zxcvbn can be used to calculate the complexity and the amount of guesses to crack the password.</p>
<p>After adding the zxcvbn JavaScript library to the HTML page, you can execute the command <code>zxcvbn</code> in the browser console, to get back detailed information about how likely it is to crack the password including a score.</p>
<p><img src="../../assets/Images/Chapters/0x04e/zxcvbn.png" width="100%" /></p>
<p>The score is defined as follows and can be used for a password strength bar for example:</p>
<div class="highlight"><pre><span></span><code>0 # too guessable: risky password. (guesses <span class="p">&lt;</span> <span class="nt">10</span><span class="err">^</span><span class="na">3</span><span class="err">)</span>

<span class="na">1</span> <span class="err">#</span> <span class="na">very</span> <span class="na">guessable:</span> <span class="na">protection</span> <span class="na">from</span> <span class="na">throttled</span> <span class="na">online</span> <span class="na">attacks</span><span class="err">.</span> <span class="err">(</span><span class="na">guesses</span> <span class="err">&lt;</span> <span class="na">10</span><span class="err">^</span><span class="na">6</span><span class="err">)</span>

<span class="na">2</span> <span class="err">#</span> <span class="na">somewhat</span> <span class="na">guessable:</span> <span class="na">protection</span> <span class="na">from</span> <span class="na">unthrottled</span> <span class="na">online</span> <span class="na">attacks</span><span class="err">.</span> <span class="err">(</span><span class="na">guesses</span> <span class="err">&lt;</span> <span class="na">10</span><span class="err">^</span><span class="na">8</span><span class="err">)</span>

<span class="na">3</span> <span class="err">#</span> <span class="na">safely</span> <span class="na">unguessable:</span> <span class="na">moderate</span> <span class="na">protection</span> <span class="na">from</span> <span class="na">offline</span> <span class="na">slow-hash</span> <span class="na">scenario</span><span class="err">.</span> <span class="err">(</span><span class="na">guesses</span> <span class="err">&lt;</span> <span class="na">10</span><span class="err">^</span><span class="na">10</span><span class="err">)</span>

<span class="na">4</span> <span class="err">#</span> <span class="na">very</span> <span class="na">unguessable:</span> <span class="na">strong</span> <span class="na">protection</span> <span class="na">from</span> <span class="na">offline</span> <span class="na">slow-hash</span> <span class="na">scenario</span><span class="err">.</span> <span class="err">(</span><span class="na">guesses</span> <span class="p">&gt;</span>= 10^10)
</code></pre></div>
<p>Note that zxcvbn can be implemented by the app-developer as well using the Java (or other) implementation in order to guide the user into creating a strong password.</p>
<h3 id="have-i-been-pwned-pwnedpasswords">Have I Been Pwned: PwnedPasswords<a class="headerlink" href="#have-i-been-pwned-pwnedpasswords" title="Permanent link">&para;</a></h3>
<p>In order to further reduce the likelihood of a successful dictionary attack against a single factor authentication scheme (e.g. password only), you can verify whether a password has been compromised in a data breach. This can be done using services based on the Pwned Passwords API by Troy Hunt (available at api.pwnedpasswords.com). For example, the "<a href="https://haveibeenpwned.com" title="\';--have i been pwned?">Have I been pwned?</a>" companion website.
Based on the SHA-1 hash of a possible password candidate, the API returns the number of times the hash of the given password has been found in the various breaches collected by the service. The workflow takes the following steps:</p>
<ul>
<li>Encode the user input to UTF-8 (e.g.: the password <code>test</code>).</li>
<li>Take the SHA-1 hash of the result of step 1 (e.g.: the hash of <code>test</code> is <code>A94A8FE5CC...</code>).</li>
<li>Copy the first 5 characters (the hash prefix) and use them for a range-search by  using the following API: <code>http GET https://api.pwnedpasswords.com/range/A94A8</code></li>
<li>Iterate through the result and look for the rest of the hash (e.g. is <code>FE5CC...</code> part of the returned list?). If it is not part of the returned list, then the password for the given hash has not been found. Otherwise, as in case of <code>FE5CC...</code>, it will return a counter showing how many times it has been found in breaches (e.g.: <code>FE5CC...:76479</code>).</li>
</ul>
<p>Further documentation on the Pwned Passwords API can be found <a href="https://haveibeenpwned.com/API/v3" title="Api Docs V3">online</a>.</p>
<p>Note that this API is best used by the app-developer when the user needs to register and enter a password to check whether it is a recommended password or not.</p>
<h4 id="login-throttling">Login Throttling<a class="headerlink" href="#login-throttling" title="Permanent link">&para;</a></h4>
<p>Check the source code for a throttling procedure: a counter for logins attempted in a short period of time with a given user name and a method to prevent login attempts after the maximum number of attempts has been reached. After an authorized login attempt, the error counter should be reset.</p>
<p>Observe the following best practices when implementing anti-brute-force controls:</p>
<ul>
<li>After a few unsuccessful login attempts, targeted accounts should be locked (temporarily or permanently), and additional login attempts should be rejected.</li>
<li>A five-minute account lock is commonly used for temporary account locking.</li>
<li>The controls must be implemented on the server because client-side controls are easily bypassed.</li>
<li>Unauthorized login attempts must be tallied with respect to the targeted account, not a particular session.</li>
</ul>
<p>Additional brute force mitigation techniques are described on the OWASP page <a href="https://www.owasp.org/index.php/Blocking_Brute_Force_Attacks" title="OWASP - Blocking Brute Force Attacks">Blocking Brute Force Attacks</a>.</p>
<h3 id="dynamic-testing-mstg-auth-6">Dynamic Testing (MSTG-AUTH-6)<a class="headerlink" href="#dynamic-testing-mstg-auth-6" title="Permanent link">&para;</a></h3>
<p>Automated password guessing attacks can be performed using a number of tools. For HTTP(S) services, using an interception proxy is a viable option. For example, you can use <a href="https://portswigger.net/burp/documentation/desktop/tools/intruder/using" title="Using Burp Suite Intruder">Burp Suite Intruder</a> to perform both wordlist-based and brute-force attacks.</p>
<blockquote>
<p>Please keep in mind that the Burp Suite Community Edition has significant limitations apart from not being able to save projects. For example, a throttling mechanism will be activated after several requests that will slow down your attacks with Burp Intruder dramatically. Also no built-in password lists are available in this version. If you want to execute a real brute force attack use either <a href="../0x08-Testing-Tools/#burp-suite">Burp Suite</a> Professional or <a href="../0x08-Testing-Tools/#owasp-zap">OWASP ZAP</a>.</p>
</blockquote>
<p>Execute the following steps for a wordlist based brute force attack with Burp Intruder:</p>
<ul>
<li>Start Burp Suite Professional.</li>
<li>Create a new project (or open an existing one).</li>
<li>Set up your mobile device to use Burp as the HTTP/HTTPS proxy. Log into the mobile app and intercept the authentication request sent to the backend service.</li>
<li>Right-click this request on the <strong>Proxy/HTTP History</strong> tab and select <strong>Send to Intruder</strong> in the context menu.</li>
<li>Select the <strong>Intruder</strong> tab. For further information on how to use <a href="https://portswigger.net/burp/documentation/desktop/tools/intruder/using" title="Using Burp Intruder">Burp Intruder</a> read the official documentation on Portswigger.</li>
<li>Make sure all parameters in the <strong>Target</strong>, <strong>Positions</strong>, and <strong>Options</strong> tabs are appropriately set and select the <strong>Payload</strong> tab.</li>
<li>Load or paste the list of passwords you want to try. There are several resources available that offer password lists, like <a href="https://github.com/fuzzdb-project/fuzzdb/" title="FuzzDB">FuzzDB</a>, the built-in lists in Burp Intruder or the files available in <code>/usr/share/wordlists</code> on Kali Linux.</li>
</ul>
<p>Once everything is configured and you have a word-list selected, you're ready to start the attack!</p>
<p><img src="../../assets/Images/Chapters/0x04e/BurpIntruderInputList.png" width="400px" /></p>
<ul>
<li>Click the <strong>Start attack</strong> button to attack the authentication.</li>
</ul>
<p>A new window will open. Site requests are sent sequentially, each request corresponding to a password from the list. Information about the response (length, status code, etc.) is provided for each request, allowing you to distinguish successful and unsuccessful attempts:</p>
<p><img src="../../assets/Images/Chapters/0x04e/BurpIntruderSuccessfulAttack.png" width="400px" /></p>
<p>In this example, you can identify the successful attempt according to the different length and the HTTP status code, which reveals the password 12345.</p>
<p>To test if your own test accounts are prone to brute forcing, append the correct password of your test account to the end of the password list. The list shouldn't have more than 25 passwords. If you can complete the attack without permanently or temporarily locking the account or solving a CAPTCHA after a certain amount of requests with wrong passwords, that means the account isn't protected against brute force attacks.</p>
<blockquote>
<p>Tip: Perform these kinds of tests only at the very end of your penetration test. You don't want to lock out your account on the first day of testing and potentially having to wait for it to be unlocked. For some projects unlocking accounts might be more difficult than you think.</p>
</blockquote>
<h2 id="testing-stateful-session-management-mstg-auth-2">Testing Stateful Session Management (MSTG-AUTH-2)<a class="headerlink" href="#testing-stateful-session-management-mstg-auth-2" title="Permanent link">&para;</a></h2>
<p>Stateful (or "session-based") authentication is characterized by authentication records on both the client and server. The authentication flow is as follows:</p>
<ol>
<li>The app sends a request with the user's credentials to the backend server.</li>
<li>The server verifies the credentials If the credentials are valid, the server creates a new session along with a random session ID.</li>
<li>The server sends to the client a response that includes the session ID.</li>
<li>The client sends the session ID with all subsequent requests. The server validates the session ID and retrieves the associated session record.</li>
<li>After the user logs out, the server-side session record is destroyed and the client discards the session ID.</li>
</ol>
<p>When sessions are improperly managed, they are vulnerable to a variety of attacks that may compromise the session of a legitimate user, allowing the attacker to impersonate the user. This may result in lost data, compromised confidentiality, and illegitimate actions.</p>
<h3 id="session-management-best-practices">Session Management Best Practices<a class="headerlink" href="#session-management-best-practices" title="Permanent link">&para;</a></h3>
<p>Locate any server-side endpoints that provide sensitive information or functions and verify the consistent enforcement of authorization. The backend service must verify the user's session ID or token and make sure that the user has sufficient privileges to access the resource. If the session ID or token is missing or invalid, the request must be rejected.</p>
<p>Make sure that:</p>
<ul>
<li>Session IDs are randomly generated on the server side.</li>
<li>The IDs can't be guessed easily (use proper length and entropy).</li>
<li>Session IDs are always exchanged over secure connections (e.g. HTTPS).</li>
<li>The mobile app doesn't save session IDs in permanent storage.</li>
<li>The server verifies the session whenever a user tries to access privileged application elements, (a session ID must be valid and must correspond to the proper authorization level).</li>
<li>The session is terminated on the server side and session information deleted within the mobile app after it times out or the user logs out.</li>
</ul>
<p>Authentication shouldn't be implemented from scratch but built on top of proven frameworks. Many popular frameworks provide ready-made authentication and session management functionality. If the app uses framework APIs for authentication, check the framework security documentation for best practices. Security guides for common frameworks are available at the following links:</p>
<ul>
<li><a href="https://projects.spring.io/spring-security" title="Spring (Java)">Spring (Java)</a></li>
<li><a href="https://struts.apache.org/security/" title="Struts (Java)">Struts (Java)</a></li>
<li><a href="https://laravel.com/docs/5.4/authentication" title="Laravel (PHP)">Laravel (PHP)</a></li>
<li><a href="https://guides.rubyonrails.org/security.html" title="Ruby on Rails">Ruby on Rails</a></li>
</ul>
<p>A great resource for testing server-side authentication is the OWASP Web Testing Guide, specifically the <a href="https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/04-Authentication_Testing/README">Testing Authentication</a> and <a href="https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/06-Session_Management_Testing/README">Testing Session Management</a> chapters.</p>
<h2 id="testing-session-timeout-mstg-auth-7">Testing Session Timeout (MSTG-AUTH-7)<a class="headerlink" href="#testing-session-timeout-mstg-auth-7" title="Permanent link">&para;</a></h2>
<p>Minimizing the lifetime of session identifiers and tokens decreases the likelihood of successful account hijacking.</p>
<h3 id="static-analysis_1">Static Analysis<a class="headerlink" href="#static-analysis_1" title="Permanent link">&para;</a></h3>
<p>In most popular frameworks, you can set the session timeout via configuration options. This parameter should be set according to the best practices specified in the framework documentation. The recommended timeout may be between 10 minutes and two hours, depending on the app's sensitivity. Refer to the framework documentation for examples of session timeout configuration:</p>
<ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.spring-session" title="Spring (Java)">Spring (Java)</a></li>
<li><a href="https://guides.rubyonrails.org/security.html#session-expiry" title="Ruby on Rails">Ruby on Rails</a></li>
<li><a href="https://php.net/manual/en/session.configuration.php#ini.session.gc-maxlifetime" title="PHP">PHP</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.sessionstate.httpsessionstate.timeout" title="ASP.NET">ASP.Net</a></li>
</ul>
<h3 id="dynamic-analysis">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis" title="Permanent link">&para;</a></h3>
<p>To verify if a session timeout is implemented, proxy your requests through an interception proxy and perform the following steps:</p>
<ol>
<li>Log in to the application.</li>
<li>Access a resource that requires authentication, typically a request for private information belonging to your account.</li>
<li>Try to access the data after an increasing number of 5-minute delays has passed (5, 10, 15, ...).</li>
<li>Once the resource is no longer available, you will know the session timeout.</li>
</ol>
<p>After you have identified the session timeout, verify whether it has an appropriate length for the application. If the timeout is too long, or if the timeout does not exist, this test case fails.</p>
<blockquote>
<p>When using Burp Proxy, you can use the <a href="https://portswigger.net/bappstore/c4bfd29882974712a1d69c6d8f05874e" title="Session Timeout Test extension">Session Timeout Test extension</a> to automate this test.</p>
</blockquote>
<h2 id="testing-user-logout-mstg-auth-4">Testing User Logout (MSTG-AUTH-4)<a class="headerlink" href="#testing-user-logout-mstg-auth-4" title="Permanent link">&para;</a></h2>
<p>The purpose of this test case is verifying logout functionality and determining whether it effectively terminates the session on both client and server and invalidates a stateless token.</p>
<p>Failing to destroy the server-side session is one of the most common logout functionality implementation errors. This error keeps the session or token alive, even after the user logs out of the application. An attacker who gets valid authentication information can continue to use it and hijack a user's account.</p>
<p>Many mobile apps don't automatically log users out. There can be various reasons, such as: because it is inconvenient for customers, or because of decisions made when implementing stateless authentication. The application should still have a logout function, and it should be implemented according to best practices, destroying all locally stored tokens or session identifiers. If session information is stored on the server, it should also be destroyed by sending a logout request to that server. In case of a high-risk application, tokens should be invalidated. Not removing tokens or session identifiers can result in unauthorized access to the application in case the tokens are leaked.
Note that other sensitive types of information should be removed as well, as any information that is not properly cleared may be leaked later, for example during a device backup.</p>
<h3 id="static-analysis_2">Static Analysis<a class="headerlink" href="#static-analysis_2" title="Permanent link">&para;</a></h3>
<p>If server code is available, make sure logout functionality terminates the session correctly. This verification will depend on the technology. Here are different examples of session termination for proper server-side logout:</p>
<ul>
<li><a href="https://docs.spring.io/autorepo/docs/spring-security/4.1.x/apidocs/org/springframework/security/web/authentication/logout/SecurityContextLogoutHandler.html" title="Spring (Java)">Spring (Java)</a></li>
<li><a href="https://guides.rubyonrails.org/security.html" title="Ruby on Rails">Ruby on Rails</a></li>
<li><a href="https://php.net/manual/en/function.session-destroy.php" title="PHP">PHP</a></li>
</ul>
<p>If access and refresh tokens are used with stateless authentication, they should be deleted from the mobile device. The <a href="https://auth0.com/blog/denylist-json-web-token-api-keys/" title="Invalidating JSON Web Token API Keys">refresh token should be invalidated on the server</a>.</p>
<h3 id="dynamic-analysis_1">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_1" title="Permanent link">&para;</a></h3>
<p>Use an interception proxy for dynamic application analysis and execute the following steps to check whether the logout is implemented properly:</p>
<ol>
<li>Log in to the application.</li>
<li>Access a resource that requires authentication, typically a request for private information belonging to your account.</li>
<li>Log out of the application.</li>
<li>Try to access the data again by resending the request from step 2.</li>
</ol>
<p>If the logout is correctly implemented on the server, an error message or redirect to the login page will be sent back to the client. On the other hand, if you receive the same response you got in step 2, the token or session ID is still valid and hasn't been correctly terminated on the server.
The OWASP Web Testing Guide (<a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/06-Testing_for_Logout_Functionality" title="WSTG-SESS-006">WSTG-SESS-06</a>) includes a detailed explanation and more test cases.</p>
<h2 id="testing-two-factor-authentication-and-step-up-authentication-mstg-auth-9-and-mstg-auth-10">Testing Two-Factor Authentication and Step-up Authentication (MSTG-AUTH-9 and MSTG-AUTH-10)<a class="headerlink" href="#testing-two-factor-authentication-and-step-up-authentication-mstg-auth-9-and-mstg-auth-10" title="Permanent link">&para;</a></h2>
<p>Two-factor authentication (2FA) is standard for apps that allow users to access sensitive functions and data. Common implementations use a password for the first factor and any of the following as the second factor:</p>
<ul>
<li>One-time password via SMS (SMS-OTP)</li>
<li>One-time code via phone call</li>
<li>Hardware or software token</li>
<li>Push notifications in combination with PKI and local authentication</li>
</ul>
<p>Whatever option is used as 2nd factor, it always must be enforced and verified on the server-side and never on client-side. Otherwise the 2nd factor can be easily bypassed within the app.</p>
<p>The secondary authentication can be performed at login or later in the user's session. For example, after logging in to a banking app with a username and PIN, the user is authorized to perform non-sensitive tasks. Once the user attempts to execute a bank transfer, the second factor ("step-up authentication") must be presented.</p>
<h3 id="dangers-of-sms-otp">Dangers of SMS-OTP<a class="headerlink" href="#dangers-of-sms-otp" title="Permanent link">&para;</a></h3>
<p>Although one-time passwords (OTP) sent via SMS are a common second factor for two-factor authentication, this method has its shortcomings. In 2016, NIST suggested: "Due to the risk that SMS messages may be intercepted or redirected, implementers of new systems SHOULD carefully consider alternative authenticators.". Below you will find a list of some related threats and suggestions to avoid successful attacks on SMS-OTP.</p>
<p>Threats:</p>
<ul>
<li>Wireless Interception: The adversary can intercept SMS messages by abusing femtocells and other known vulnerabilities in the telecommunications network.</li>
<li>Trojans: Installed malicious applications with access to text messages may forward the OTP to another number or backend.</li>
<li>SIM SWAP Attack: In this attack, the adversary calls the phone company, or works for them, and has the victim's number moved to a SIM card owned by the adversary. If successful, the adversary can see the SMS messages which are sent to the victim's phone number. This includes the messages used in the two-factor authentication.</li>
<li>Verification Code Forwarding Attack: This social engineering attack relies on the trust the users have in the company providing the OTP. In this attack, the user receives a code and is later asked to relay that code using the same means in which it received the information.</li>
<li>Voicemail: Some two-factor authentication schemes allow the OTP to be sent through a phone call when SMS is no longer preferred or available. Many of these calls, if not answered, send the information to voicemail. If an attacker was able to gain access to the voicemail, they could also use the OTP to gain access to a user's account.</li>
</ul>
<p>You can find below several suggestions to reduce the likelihood of exploitation when using SMS for OTP:</p>
<ul>
<li><strong>Messaging</strong>: When sending an OTP via SMS, be sure to include a message that lets the user know 1) what to do if they did not request the code 2) your company will never call or text them requesting that they relay their password or code.</li>
<li><strong>Dedicated Channel</strong>: When using the OS push notification feature (APN on iOS and FCM on Android), OTPs can be sent securely to a registered application. This information is, compared to SMS, not accessible by other applications. Alternatively of a OTP the push notification could trigger a pop-up to approve the requested access.  </li>
<li><strong>Entropy</strong>: Use authenticators with high entropy to make OTPs harder to crack or guess and use at least 6 digits. Make sure that digits are separates in smaller groups in case people have to remember them to copy them to your app.</li>
<li><strong>Avoid Voicemail</strong>: If a user prefers to receive a phone call, do not leave the OTP information as a voicemail.</li>
</ul>
<h3 id="transaction-signing-with-push-notifications-and-pki">Transaction Signing with Push Notifications and PKI<a class="headerlink" href="#transaction-signing-with-push-notifications-and-pki" title="Permanent link">&para;</a></h3>
<p>Another alternative and strong mechanisms to implement a second factor is transaction signing.</p>
<p>Transaction signing requires authentication of the user's approval of critical transactions. Asymmetric cryptography is the best way to implement transaction signing. The app will generate a public/private key pair when the user signs up, then registers the public key on the backend. The private key is securely stored in the KeyStore (Android) or KeyChain (iOS). To authorize a transaction, the backend sends the mobile app a push notification containing the transaction data. The user is then asked to confirm or deny the transaction. After confirmation, the user is prompted to unlock the Keychain (by entering the PIN or fingerprint), and the data is signed with user's private key. The signed transaction is then sent to the server, which verifies the signature with the user's public key.</p>
<h3 id="static-analysis_3">Static Analysis<a class="headerlink" href="#static-analysis_3" title="Permanent link">&para;</a></h3>
<p>There are various two-factor authentication mechanism available which can range from 3rd party libraries, usage of external apps to self implemented checks by the developer(s).</p>
<p>Use the app first and identify where 2FA is needed in the workflows (usually during login or when executing critical transactions). Do also interview the developer(s) and/or architects to understand more about the 2FA implementation. If a 3rd party library or external app is used, verify if the implementation was done accordingly to the security best practices.</p>
<h3 id="dynamic-testing">Dynamic Testing<a class="headerlink" href="#dynamic-testing" title="Permanent link">&para;</a></h3>
<p>Use the app extensively (going through all UI flows) while using an interception proxy to capture the requests sent to remote endpoints. Next, replay requests to endpoints that require 2FA (e.g., performing a financial transactions) while using a token or session ID that hasn't yet been elevated via 2FA or step-up authentication. If an endpoint is still sending back requested data that should only be available after 2FA or step-up authentication, authentication checks haven't been properly implemented at that endpoint.</p>
<p>When OTP authentication is used, consider that most OTPs are short numeric values. An attacker can bypass the second factor by brute-forcing the values within the range at the lifespan of the OTP if the accounts aren't locked after N unsuccessful attempts at this stage. The probability of finding a match for 6-digit values with a 30-second time step within 72 hours is more than 90%.</p>
<p>To test this, the captured request should be sent 10-15 times to the endpoint with random OTP values before providing the correct OTP. If the OTP is still accepted the 2FA implementation is prone to brute force attacks and the OTP can be guessed.</p>
<blockquote>
<p>A OTP should be valid for only a certain amount of time (usually 30 seconds) and after keying in the OTP wrongly several times (usually 3 times) the provided OTP should be invalidated and the user should be redirected to the landing page or logged out.</p>
</blockquote>
<p>You should check if the app relies on static responses from the remote endpoint such as <code>"message":"Success"</code> to grant access to app internal sensitive data or functions. If that's the case, an attacker could easily bypass the 2FA implementation by manipulating the server response e.g. by using an interception proxy such as <a href="../0x08-Testing-Tools/#burp-suite">Burp Suite</a> and modifying the response to be <code>"message":"Success"</code>.</p>
<p>To prevent these kind of attacks, the application should always verify some kind of user token or other dynamic information related to the user that was previously securely stored (e.g. in the Keychain/KeyStore).</p>
<p>Consult the <a href="https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/06-Session_Management_Testing/01-Testing_for_Session_Management_Schema" title="OWASP Testing Guide V4 (Testing for Session Management)">OWASP Testing Guide</a> for more information about testing session management.</p>
<h2 id="testing-stateless-token-based-authentication-mstg-auth-3">Testing Stateless (Token-Based) Authentication (MSTG-AUTH-3)<a class="headerlink" href="#testing-stateless-token-based-authentication-mstg-auth-3" title="Permanent link">&para;</a></h2>
<p>Token-based authentication is implemented by sending a signed token (verified by the server) with each HTTP request. The most commonly used token format is the JSON Web Token, defined in <a href="https://tools.ietf.org/html/rfc7519" title="RFC7519">RFC7519</a>. A JWT may encode the complete session state as a JSON object. Therefore, the server doesn't have to store any session data or authentication information.</p>
<p>JWT tokens consist of three Base64Url-encoded parts separated by dots. The Token structure is as follows:</p>
<div class="highlight"><pre><span></span><code>base64UrlEncode(header).base64UrlEncode(payload).base64UrlEncode(signature)
</code></pre></div>
<p>The following example shows a <a href="https://jwt.io/#debugger" title="JWT Example on jwt.io">Base64Url-encoded JSON Web Token</a>:</p>
<div class="highlight"><pre><span></span><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Ikpva
G4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
</code></pre></div>
<p>The <em>header</em> typically consists of two parts: the token type, which is JWT, and the hashing algorithm being used to compute the signature. In the example above, the header decodes as follows:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="s2">&quot;HS256&quot;</span><span class="p">,</span><span class="nt">&quot;typ&quot;</span><span class="p">:</span><span class="s2">&quot;JWT&quot;</span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The second part of the token is the <em>payload</em>, which contains so-called claims. Claims are statements about an entity (typically, the user) and additional metadata. For example:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;sub&quot;</span><span class="p">:</span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span><span class="nt">&quot;admin&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The signature is created by applying the algorithm specified in the JWT header to the encoded header, encoded payload, and a secret value. For example, when using the HMAC SHA256 algorithm the signature is created in the following way:</p>
<div class="highlight"><pre><span></span><code><span class="n">HMACSHA256</span><span class="p">(</span><span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">header</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span><span class="w"> </span><span class="n">secret</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Note that the secret is shared between the authentication server and the backend service - the client does not know it. This proves that the token was obtained from a legitimate authentication service. It also prevents the client from tampering with the claims contained in the token.</p>
<h3 id="static-analysis_4">Static Analysis<a class="headerlink" href="#static-analysis_4" title="Permanent link">&para;</a></h3>
<p>Identify the JWT library that the server and client use. Find out whether the JWT libraries in use have any known vulnerabilities.</p>
<p>Verify that the implementation adheres to JWT <a href="https://stormpath.com/blog/jwt-the-right-way" title="JWT the right way">best practices</a>:</p>
<ul>
<li>Verify that the HMAC is checked for all incoming requests containing a token;</li>
<li>Verify the location of the private signing key or HMAC secret key. The key should remain on the server and should never be shared with the client. It should be available for the issuer and verifier only.</li>
<li>Verify that no sensitive data, such as personal identifiable information, is embedded in the JWT. If, for some reason, the architecture requires transmission of such information in the token, make sure that payload encryption is being applied. See the sample Java implementation on the <a href="https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html" title="JSON Web Token for Java Cheat Sheet">OWASP JWT Cheat Sheet</a>.</li>
<li>Make sure that replay attacks are addressed with the <code>jti</code> (JWT ID) claim, which gives the JWT a unique identifier.</li>
<li>Make sure that cross service relay attacks are addressed with the <code>aud</code> (audience) claim, which defines for which application the token is entitled.</li>
<li>Verify that tokens are stored securely on the mobile phone, with, for example, KeyChain (iOS) or KeyStore (Android).</li>
</ul>
<h4 id="enforcing-the-hashing-algorithm">Enforcing the Hashing Algorithm<a class="headerlink" href="#enforcing-the-hashing-algorithm" title="Permanent link">&para;</a></h4>
<p>An attacker executes this by altering the token and, using the 'none' keyword, changing the signing algorithm to indicate that the integrity of the token has already been verified. <a href="https://stormpath.com/blog/jwt-the-right-way">Some libraries</a> might treat tokens signed with the 'none' algorithm as if they were valid tokens with verified signatures, so the application will trust altered token claims.</p>
<p>For example, in Java applications, the expected algorithm should be requested explicitly when creating the verification context:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// HMAC key - Block serialization and storage as String in JVM memory</span><span class="w"></span>
<span class="kd">private</span><span class="w"> </span><span class="kd">transient</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">keyHMAC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"></span>

<span class="c1">//Create a verification context for the token requesting explicitly the use of the HMAC-256 HMAC generation</span><span class="w"></span>

<span class="n">JWTVerifier</span><span class="w"> </span><span class="n">verifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JWT</span><span class="p">.</span><span class="na">require</span><span class="p">(</span><span class="n">Algorithm</span><span class="p">.</span><span class="na">HMAC256</span><span class="p">(</span><span class="n">keyHMAC</span><span class="p">)).</span><span class="na">build</span><span class="p">();</span><span class="w"></span>

<span class="c1">//Verify the token; if the verification fails then an exception is thrown</span><span class="w"></span>

<span class="n">DecodedJWT</span><span class="w"> </span><span class="n">decodedToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verifier</span><span class="p">.</span><span class="na">verify</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<h4 id="token-expiration">Token Expiration<a class="headerlink" href="#token-expiration" title="Permanent link">&para;</a></h4>
<p>Once signed, a stateless authentication token is valid forever unless the signing key changes. A common way to limit token validity is to set an expiration date. Make sure that the tokens include an <a href="https://tools.ietf.org/html/rfc7519#section-4.1.4" title="RFC 7519">"exp" expiration claim</a> and the backend doesn't process expired tokens.</p>
<p>A common method of granting tokens combines <a href="https://auth0.com/blog/refresh-tokens-what-are-they-and-when-to-use-them/" title="Refresh tokens &amp; access tokens">access tokens and refresh tokens</a>. When the user logs in, the backend service issues a short-lived <em>access token</em> and a long-lived <em>refresh token</em>. The application can then use the refresh token to obtain a new access token, if the access token expires.</p>
<p>For apps that handle sensitive data, make sure that the refresh token expires after a reasonable period of time. The following example code shows a refresh token API that checks the refresh token's issue date. If the token is not older than 14 days, a new access token is issued. Otherwise, access is denied and the user is prompted to login again.</p>
<div class="highlight"><pre><span></span><code><span class="n">app</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">renew_access_token</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// verify the existing refresh token</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwt</span><span class="p">.</span><span class="na">verify</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">body</span><span class="p">.</span><span class="na">token</span><span class="p">,</span><span class="w"> </span><span class="n">secret</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// if refresh token is more than 14 days old, force login</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">profile</span><span class="p">.</span><span class="na">original_iat</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">14</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// iat == issued at</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="mi">401</span><span class="p">);</span><span class="w"> </span><span class="c1">// re-login</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// check if the user still exists or if authorization hasn&#39;t been revoked</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valid</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="mi">401</span><span class="p">);</span><span class="w"> </span><span class="c1">// re-logging</span><span class="w"></span>

<span class="w">  </span><span class="c1">// issue a new access token</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="n">renewed_access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwt</span><span class="p">.</span><span class="na">sign</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span><span class="w"> </span><span class="n">secret</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">expiresInMinutes</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="o">*</span><span class="mi">5</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="n">res</span><span class="p">.</span><span class="na">json</span><span class="p">({</span><span class="w"> </span><span class="n">token</span><span class="p">:</span><span class="w"> </span><span class="n">renewed_access_token</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>
<h3 id="dynamic-analysis_2">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_2" title="Permanent link">&para;</a></h3>
<p>Investigate the following JWT vulnerabilities while performing dynamic analysis:</p>
<ul>
<li>Token Storage on the client:</li>
<li>The token storage location should be verified for mobile apps that use JWT.</li>
<li>Cracking the signing key:</li>
<li>Token signatures are created via a private key on the server. After you obtain a JWT, choose a tool for <a href="https://www.sjoerdlangkemper.nl/2016/09/28/attacking-jwt-authentication/" title="Attacking JWT Authentication">brute forcing the secret key offline</a>.</li>
<li>Information Disclosure:</li>
<li>Decode the Base64Url-encoded JWT and find out what kind of data it transmits and whether that data is encrypted.</li>
<li>Tampering with the Hashing Algorithm:</li>
<li>Usage of <a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/" title="Critical Vulnerabilities in JSON Web Token">asymmetric algorithms</a>. JWT offers several asymmetric algorithms as RSA or ECDSA. When these algorithms are used, tokens are signed with the private key and the public key is used for verification. If a server is expecting a token to be signed with an asymmetric algorithm and receives a token signed with HMAC, it will treat the public key as an HMAC secret key. The public key can then be misused, employed as an HMAC secret key to sign the tokens.</li>
<li>Modify the <code>alg</code> attribute in the token header, then delete <code>HS256</code>, set it to <code>none</code>, and use an empty signature (e.g., signature = ""). Use this token and replay it in a request. Some libraries treat tokens signed with the none algorithm as a valid token with a verified signature. This allows attackers to create their own "signed" tokens.</li>
</ul>
<p>There are two different Burp Plugins that can help you for testing the vulnerabilities listed above:</p>
<ul>
<li><a href="https://portswigger.net/bappstore/82d6c60490b540369d6d5d01822bdf61" title="JSON Web Token Attacker">JSON Web Token Attacker</a></li>
<li><a href="https://portswigger.net/bappstore/f923cbf91698420890354c1d8958fee6" title="JSON Web Tokens">JSON Web Tokens</a></li>
</ul>
<p>Also, make sure to check out the <a href="https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html" title="JSON Web Token (JWT) Cheat Sheet for Java">OWASP JWT Cheat Sheet</a> for additional information.</p>
<h2 id="testing-oauth-20-flows-mstg-auth-1-and-mstg-auth-3">Testing OAuth 2.0 Flows (MSTG-AUTH-1 and MSTG-AUTH-3)<a class="headerlink" href="#testing-oauth-20-flows-mstg-auth-1-and-mstg-auth-3" title="Permanent link">&para;</a></h2>
<p><a href="https://oauth.net/articles/authentication/" title="OAuth 2.0 delegation protocols">OAuth 2.0 defines a delegation protocol for conveying authorization decisions across APIs and a network of web-enabled applications</a>. It is used in a variety of applications, including user authentication applications.</p>
<p>Common uses for OAuth2 include:</p>
<ul>
<li>Getting permission from the user to access an online service using their account.</li>
<li>Authenticating to an online service on behalf of the user.</li>
<li>Handling authentication errors.</li>
</ul>
<p>According to OAuth 2.0, a mobile client seeking access to a user's resources must first ask the user to authenticate against an <em>authentication server</em>. With the users' approval, the authorization server then issues a token that allows the app to act on behalf of the user. Note that the OAuth2 specification doesn't define any particular kind of authentication or access token format.</p>
<p>OAuth 2.0 defines four roles:</p>
<ul>
<li>Resource Owner: the account owner</li>
<li>Client: the application that wants to access the user's account with the access tokens</li>
<li>Resource Server: hosts the user accounts</li>
<li>Authorization Server: verifies user identity and issues access tokens to the application</li>
</ul>
<p>Note: The API fulfills both the Resource Owner and Authorization Server roles. Therefore, we will refer to both as the API.</p>
<p><img src="../../assets/Images/Chapters/0x04e/abstract_oath2_flow.png" width="400px" /></p>
<p>Here is a more <a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2" title="An Introduction into OAuth2">detailed explanation</a> of the steps in the diagram:</p>
<ol>
<li>The application requests user authorization to access service resources.</li>
<li>If the user authorizes the request, the application receives an authorization grant. The authorization grant may take several forms (explicit, implicit, etc.).</li>
<li>The application requests an access token from the authorization server (API) by presenting authentication of its own identity along with the authorization grant.</li>
<li>If the application identity is authenticated and the authorization grant is valid, the authorization server (API) issues an access token to the application, completing the authorization process. The access token may have a companion refresh token.</li>
<li>The application requests the resource from the resource server (API) and presents the access token for authentication. The access token may be used in several ways (e.g., as a bearer token).</li>
<li>If the access token is valid, the resource server (API) serves the resource to the application.</li>
</ol>
<h3 id="oauth-20-best-practices">OAUTH 2.0 Best Practices<a class="headerlink" href="#oauth-20-best-practices" title="Permanent link">&para;</a></h3>
<p>Verify that the following best practices are followed:</p>
<p>User agent:</p>
<ul>
<li>The user should have a way to visually verify trust (e.g., Transport Layer Security (TLS) confirmation, website mechanisms).</li>
<li>To prevent man-in-the-middle attacks, the client should validate the server's fully qualified domain name with the public key the server presented when the connection was established.</li>
</ul>
<p>Type of grant:</p>
<ul>
<li>On native apps, code grant should be used instead of implicit grant.</li>
<li>When using code grant, PKCE (Proof Key for Code Exchange) should be implemented to protect the code grant. Make sure that the server also implements it.</li>
<li>The auth "code" should be short-lived and used immediately after it is received. Verify that auth codes only reside on transient memory and aren't stored or logged.</li>
</ul>
<p>Client secrets:</p>
<ul>
<li>Shared secrets should not be used to prove the client's identity because the client could be impersonated ("client_id" already serves as proof). If they do use client secrets, be sure that they are stored in secure local storage.</li>
</ul>
<p>End-User credentials:</p>
<ul>
<li>Secure the transmission of end-user credentials with a transport-layer method, such as TLS.</li>
</ul>
<p>Tokens:</p>
<ul>
<li>Keep access tokens in transient memory.</li>
<li>Access tokens must be transmitted over an encrypted connection.</li>
<li>Reduce the scope and duration of access tokens when end-to-end confidentiality can't be guaranteed or the token provides access to sensitive information or transactions.</li>
<li>Remember that an attacker who has stolen tokens can access their scope and all resources associated with them if the app uses access tokens as bearer tokens with no other way to identify the client.</li>
<li>Store refresh tokens in secure local storage; they are long-term credentials.</li>
</ul>
<h4 id="external-user-agent-vs-embedded-user-agent">External User Agent vs. Embedded User Agent<a class="headerlink" href="#external-user-agent-vs-embedded-user-agent" title="Permanent link">&para;</a></h4>
<p>OAuth2 authentication can be performed either through an external user agent (e.g. Chrome or Safari) or in the app itself (e.g. through a WebView embedded into the app or an authentication library). None of the two modes is intrinsically "better" - instead, what mode to choose depends on the context.</p>
<p>Using an <em>external user agent</em> is the method of choice for apps that need to interact with social media accounts (Facebook, Twitter, etc.). Advantages of this method include:</p>
<ul>
<li>
<p>The user's credentials are never directly exposed to the app. This guarantees that the app cannot obtain the credentials during the login process ("credential phishing").</p>
</li>
<li>
<p>Almost no authentication logic must be added to the app itself, preventing coding errors.</p>
</li>
</ul>
<p>On the negative side, there is no way to control the behavior of the browser (e.g. to activate certificate pinning).</p>
<p>For apps that operate within a closed ecosystem, <em>embedded authentication</em> is the better choice. For example, consider a banking app that uses OAuth2 to retrieve an access token from the bank's authentication server, which is then used to access a number of micro services. In that case, credential phishing is not a viable scenario. It is likely preferable to keep the authentication process in the (hopefully) carefully secured banking app, instead of placing trust on external components.</p>
<h3 id="other-oauth2-best-practices">Other OAuth2 Best Practices<a class="headerlink" href="#other-oauth2-best-practices" title="Permanent link">&para;</a></h3>
<p>For additional best practices and detailed information please refer to the following source documents:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6749">RFC6749 - The OAuth 2.0 Authorization Framework (October 2012)</a></li>
<li><a href="https://tools.ietf.org/html/rfc8252">RFC8252 - OAuth 2.0 for Native Apps (October 2017)</a></li>
<li><a href="https://tools.ietf.org/html/rfc6819">RFC6819 - OAuth 2.0 Threat Model and Security Considerations (January 2013)</a></li>
</ul>
<h2 id="testing-login-activity-and-device-blocking-mstg-auth-11">Testing Login Activity and Device Blocking (MSTG-AUTH-11)<a class="headerlink" href="#testing-login-activity-and-device-blocking-mstg-auth-11" title="Permanent link">&para;</a></h2>
<p>For applications which require L2 protection, the MASVS states that they should inform the user about all login activities within the app with the possibility of blocking certain devices. This can be broken down into various scenarios:</p>
<ol>
<li>The application provides a push notification the moment their account is used on another device to notify the user of different activities. The user can then block this device after opening the app via the push-notification.</li>
<li>The application provides an overview of the last session after login. If the previous session was with a different configuration (e.g. location, device, app-version) compared to the current configuration, then the user should have the option to report suspicious activities and block devices used in the previous session.</li>
<li>The application provides an overview of the last session after login at all times.</li>
<li>The application has a self-service portal in which the user can see an audit-log. This allows the user to manage the different devices that are logged in.</li>
</ol>
<p>The developer can make use of specific meta-information and associate it to each different activity or event within the application. This will make it easier for the user to spot suspicious behavior and block the corresponding device. The meta-information may include:</p>
<ul>
<li>Device: The user can clearly identify all devices where the app is being used.</li>
<li>Date and Time: The user can clearly see the latest date and time when the app was used.</li>
<li>Location: The user can clearly identify the latest locations where the app was used.</li>
</ul>
<p>The application can provide a list of activities history which will be updated after each sensitive activity within the application. The choice of which activities to audit needs to be done for each application based on the data it handles and the level of security risk the team is willing to have. Below is a list of common sensitive activities that are usually audited:</p>
<ul>
<li>Login attempts</li>
<li>Password changes</li>
<li>Personal Identifiable Information changes (name, email address, telephone number, etc.)</li>
<li>Sensitive activities (purchase, accessing important resources, etc.)</li>
<li>Consent to Terms and Conditions clauses</li>
</ul>
<p>Paid content requires special care, and additional meta-information (e.g., operation cost, credit, etc.) might be used to ensure user's knowledge about the whole operation's parameters.</p>
<p>In addition, non-repudiation mechanisms should be applied to sensitive transactions (e.g. paid content access, given consent to Terms and Conditions clauses, etc.) in order to prove that a specific transaction was in fact performed (integrity) and by whom (authentication).</p>
<p>In all cases, you should verify whether different devices are detected correctly. Therefore, the binding of the application to the actual device should be tested.
In iOS, a developer can use <code>identifierForVendor</code>, which is related to the bundle ID: the moment you change a bundle ID, the method will return a different value. When the app is ran for the first time, make sure you store the value returned by <code>identifierForVendor</code> to the KeyChain, so that changes to it can be detected at an early stage.</p>
<p>In Android, the developer can use <code>Settings.Secure.ANDROID_ID</code> till Android 8.0 (API level 26) to identify an application instance. Note that starting at Android 8.0 (API level 26), <code>ANDROID_ID</code> is no longer a device unique ID. Instead, it becomes scoped by the combination of app signing key, user and device. So validating <code>ANDROID_ID</code> for device blocking could be tricky for these Android versions. Because if an app changes its signing key, the <code>ANDROID_ID</code> will change and it won't be able to recognize old users devices. Therefore, it's better to store the <code>ANDROID_ID</code> encrypted and privately in a private a shared preferences file using a randomly generated key from the <code>AndroidKeyStore</code> and preferably AES_GCM encryption. The moment the app signature changes, the application can check for a delta and register the new <code>ANDROID_ID</code>. The moment this new ID changes without a new application signing key, it should indicate that something else is wrong.
Next, the device binding can be extended by signing requests with a key stored in the <code>Keychain</code> for iOS and in the <code>KeyStore</code> in Android can reassure strong device binding.
You should also test if using different IPs, different locations and/or different time-slots will trigger the right type of information in all scenarios.</p>
<p>Lastly, the blocking of the devices should be tested, by blocking a registered instance of the app and see if it is then no longer allowed to authenticate.
Note: in case of an application which requires L2 protection, it can be a good idea to warn a user even before the first authentication on a new device. Instead: warn the user already when a second instance of the app is registered.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<h3 id="owasp-masvs">OWASP MASVS<a class="headerlink" href="#owasp-masvs" title="Permanent link">&para;</a></h3>
<ul>
<li>MSTG-ARCH-2: "Security controls are never enforced only on the client side, but on the respective remote endpoints."</li>
<li>MSTG-AUTH-1: "If the app provides users access to a remote service, some form of authentication, such as username/password authentication, is performed at the remote endpoint."</li>
<li>MSTG-AUTH-2: "If stateful session management is used, the remote endpoint uses randomly generated session identifiers to authenticate client requests without sending the user's credentials."</li>
<li>MSTG-AUTH-3: "If stateless token-based authentication is used, the server provides a token that has been signed using a secure algorithm."</li>
<li>MSTG-AUTH-4: "The remote endpoint terminates the existing session when the user logs out."</li>
<li>MSTG-AUTH-5: "A password policy exists and is enforced at the remote endpoint."</li>
<li>MSTG-AUTH-6: "The remote endpoint implements a mechanism to protect against the submission of credentials an excessive number of times."</li>
<li>MSTG-AUTH-7: "Sessions are invalidated at the remote endpoint after a predefined period of inactivity and access tokens expire."</li>
<li>MSTG-AUTH-9: "A second factor of authentication exists at the remote endpoint and the 2FA requirement is consistently enforced."</li>
<li>MSTG-AUTH-10: "Sensitive transactions require step-up authentication."</li>
<li>MSTG-AUTH-11: "The app informs the user of all sensitive activities with their account. Users are able to view a list of devices, view contextual information (IP address, location, etc.), and to block specific devices."</li>
</ul>
<h4 id="sms-otp-research">SMS-OTP Research<a class="headerlink" href="#sms-otp-research" title="Permanent link">&para;</a></h4>
<ul>
<li>[#dmitrienko] Dmitrienko, Alexandra, et al. "On the (in) security of mobile two-factor authentication." International Conference on Financial Cryptography and Data Security. Springer, Berlin, Heidelberg, 2014.</li>
<li>[#grassi] Grassi, Paul A., et al. Digital identity guidelines: Authentication and lifecycle management (DRAFT). No. Special Publication (NIST SP)-800-63B. 2016.</li>
<li>[#grassi2] Grassi, Paul A., et al. Digital identity guidelines: Authentication and lifecycle management. No. Special Publication (NIST SP)-800-63B. 2017.</li>
<li>[#konoth] Konoth, Radhesh Krishnan, Victor van der Veen, and Herbert Bos. "How anywhere computing just killed your phone-based two-factor authentication." International Conference on Financial Cryptography and Data Security. Springer, Berlin, Heidelberg, 2016.</li>
<li>[#mulliner] Mulliner, Collin, et al. "SMS-based one-time passwords: attacks and defense." International Conference on Detection of Intrusions and Malware, and Vulnerability Assessment. Springer, Berlin, Heidelberg, 2013.</li>
<li>[#siadati] Siadati, Hossein, et al. "Mind your SMSes: Mitigating social engineering in second factor authentication." Computers &amp; Security 65 (2017): 14-28.</li>
<li>[#siadati2] Siadati, Hossein, Toan Nguyen, and Nasir Memon. "Verification code forwarding attack (short paper)." International Conference on Passwords. Springer, Cham, 2015.</li>
</ul>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../0x04c-Tampering-and-Reverse-Engineering/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Mobile App Tampering and Reverse Engineering" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Mobile App Tampering and Reverse Engineering
            </div>
          </div>
        </a>
      
      
        
        <a href="../0x04f-Testing-Network-Communication/" class="md-footer__link md-footer__link--next" aria-label="Next: Mobile App Network Communication" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Mobile App Network Communication
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <div style="float: left; padding-right: 1em;">
  <a href="https://www.owasp.org"><img src="https://github.com/OWASP/owasp-mstg/blob/master/Document/Images/OWASP_logo_white.png?raw=true" width="100px" /></a>
</div>
<span>
  &#169; OWASP Foundation 2022. This work is licensed under 
  <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>. For any reuse or distribution, you must make clear to others the license terms of this work.
</span>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://owasp.slack.com/messages/project-mobile_omtg/details/" target="_blank" rel="noopener" title="owasp.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/OWASP_MSTG" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/OWASP/owasp-mstg/discussions" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "toc.integrate", "navigation.top"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../javascripts/tablesort.js"></script>
      
    
  </body>
</html>