
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/logo_circle.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>Android Data Storage - OWASP Mobile Security Project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#android-data-storage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OWASP Mobile Security Project" class="md-header__button md-logo" aria-label="OWASP Mobile Security Project" data-md-component="logo">
      
  <img src="../../assets/logo_circle.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OWASP Mobile Security Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Android Data Storage
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/OWASP/owasp-mstg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/owasp-mstg
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../donate/" class="md-tabs__link">
      ♡ Donations
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../news/" class="md-tabs__link">
      News
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../talks/" class="md-tabs__link">
      Talks
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../0x01-Foreword/" class="md-tabs__link md-tabs__link--active">
        MSTG
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/1_How_Can_You_Contribute/" class="md-tabs__link">
        Contributing
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OWASP Mobile Security Project" class="md-nav__button md-logo" aria-label="OWASP Mobile Security Project" data-md-component="logo">
      
  <img src="../../assets/logo_circle.png" alt="logo">

    </a>
    OWASP Mobile Security Project
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/OWASP/owasp-mstg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/owasp-mstg
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../donate/" class="md-nav__link">
        ♡ Donations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../news/" class="md-nav__link">
        News
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../talks/" class="md-nav__link">
        Talks
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          MSTG
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MSTG" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          MSTG
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x01-Foreword/" class="md-nav__link">
        Foreword
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x02a-Frontispiece/" class="md-nav__link">
        Frontispiece
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x02b-MASVS-MSTG-Adoption/" class="md-nav__link">
        OWASP MASVS and MSTG Adoption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x02c-Acknowledgements/" class="md-nav__link">
        Acknowledgments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x03-Overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04a-Mobile-App-Taxonomy/" class="md-nav__link">
        Mobile App Taxonomy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04b-Mobile-App-Security-Testing/" class="md-nav__link">
        Mobile App Security Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04c-Tampering-and-Reverse-Engineering/" class="md-nav__link">
        Mobile App Tampering and Reverse Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04e-Testing-Authentication-and-Session-Management/" class="md-nav__link">
        Mobile App Authentication Architectures
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04f-Testing-Network-Communication/" class="md-nav__link">
        Mobile App Network Communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04g-Testing-Cryptography/" class="md-nav__link">
        Mobile App Cryptography
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04h-Testing-Code-Quality/" class="md-nav__link">
        Mobile App Code Quality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x04i-Testing-User-Privacy-Protection/" class="md-nav__link">
        Mobile App User Privacy Protection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05a-Platform-Overview/" class="md-nav__link">
        Android Platform Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05b-Basic-Security_Testing/" class="md-nav__link">
        Android Basic Security Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05c-Reverse-Engineering-and-Tampering/" class="md-nav__link">
        Android Tampering and Reverse Engineering
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Android Data Storage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Android Data Storage
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#theory-overview" class="md-nav__link">
    Theory Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-storage-methods-overview" class="md-nav__link">
    Data Storage Methods Overview
  </a>
  
    <nav class="md-nav" aria-label="Data Storage Methods Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-preferences" class="md-nav__link">
    Shared Preferences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    Databases
  </a>
  
    <nav class="md-nav" aria-label="Databases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sqlite-database-unencrypted" class="md-nav__link">
    SQLite Database (Unencrypted)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlite-databases-encrypted" class="md-nav__link">
    SQLite Databases (Encrypted)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firebase-real-time-databases" class="md-nav__link">
    Firebase Real-time Databases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#realm-databases" class="md-nav__link">
    Realm Databases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-storage" class="md-nav__link">
    Internal Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-storage" class="md-nav__link">
    External Storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keystore" class="md-nav__link">
    KeyStore
  </a>
  
    <nav class="md-nav" aria-label="KeyStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware-backed-android-keystore" class="md-nav__link">
    Hardware-backed Android KeyStore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-attestation" class="md-nav__link">
    Key Attestation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secure-key-import-into-keystore" class="md-nav__link">
    Secure Key Import into Keystore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#older-keystore-implementations" class="md-nav__link">
    Older KeyStore Implementations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keychain" class="md-nav__link">
    KeyChain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-a-cryptographic-key-techniques" class="md-nav__link">
    Storing a Cryptographic Key: Techniques
  </a>
  
    <nav class="md-nav" aria-label="Storing a Cryptographic Key: Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storing-keys-using-hardware-backed-android-keystore" class="md-nav__link">
    Storing Keys Using Hardware-backed Android KeyStore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-keys-on-the-server" class="md-nav__link">
    Storing Keys on the Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriving-keys-from-user-input" class="md-nav__link">
    Deriving Keys from User Input
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaning-out-key-material" class="md-nav__link">
    Cleaning out Key Material
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-keys-using-android-keystore-api" class="md-nav__link">
    Storing Keys using Android KeyStore API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storing-keys-by-encrypting-them-with-other-keys" class="md-nav__link">
    Storing keys by encrypting them with other keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insecure-options-to-store-keys" class="md-nav__link">
    Insecure options to store keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-libraries" class="md-nav__link">
    Third Party libraries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    Logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backups" class="md-nav__link">
    Backups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-memory" class="md-nav__link">
    Process Memory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-local-storage-for-sensitive-data-mstg-storage-1-and-mstg-storage-2" class="md-nav__link">
    Testing Local Storage for Sensitive Data (MSTG-STORAGE-1 and MSTG-STORAGE-2)
  </a>
  
    <nav class="md-nav" aria-label="Testing Local Storage for Sensitive Data (MSTG-STORAGE-1 and MSTG-STORAGE-2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-local-storage-for-input-validation-mstg-platform-2" class="md-nav__link">
    Testing Local Storage for Input Validation (MSTG-PLATFORM-2)
  </a>
  
    <nav class="md-nav" aria-label="Testing Local Storage for Input Validation (MSTG-PLATFORM-2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_1" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_1" class="md-nav__link">
    Static analysis
  </a>
  
    <nav class="md-nav" aria-label="Static analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-shared-preferences" class="md-nav__link">
    Using Shared Preferences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-other-storage-mechanisms" class="md-nav__link">
    Using Other Storage Mechanisms
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-logs-for-sensitive-data-mstg-storage-3" class="md-nav__link">
    Testing Logs for Sensitive Data (MSTG-STORAGE-3)
  </a>
  
    <nav class="md-nav" aria-label="Testing Logs for Sensitive Data (MSTG-STORAGE-3)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_2" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_2" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_1" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-whether-sensitive-data-is-shared-with-third-parties-mstg-storage-4" class="md-nav__link">
    Determining Whether Sensitive Data Is Shared with Third Parties (MSTG-STORAGE-4)
  </a>
  
    <nav class="md-nav" aria-label="Determining Whether Sensitive Data Is Shared with Third Parties (MSTG-STORAGE-4)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_3" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#third-party-services-embedded-in-the-app" class="md-nav__link">
    Third-party Services Embedded in the App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-notifications" class="md-nav__link">
    App Notifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_3" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav" aria-label="Static Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#third-party-services-embedded-in-the-app_1" class="md-nav__link">
    Third-party Services Embedded in the App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-notifications_1" class="md-nav__link">
    App Notifications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_2" class="md-nav__link">
    Dynamic Analysis
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#third-party-services-embedded-in-the-app_2" class="md-nav__link">
    Third-party Services Embedded in the App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-notifications_2" class="md-nav__link">
    App Notifications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-whether-the-keyboard-cache-is-disabled-for-text-input-fields-mstg-storage-5" class="md-nav__link">
    Determining Whether the Keyboard Cache Is Disabled for Text Input Fields (MSTG-STORAGE-5)
  </a>
  
    <nav class="md-nav" aria-label="Determining Whether the Keyboard Cache Is Disabled for Text Input Fields (MSTG-STORAGE-5)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_4" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_4" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_3" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-whether-sensitive-stored-data-has-been-exposed-via-ipc-mechanisms-mstg-storage-6" class="md-nav__link">
    Determining Whether Sensitive Stored Data Has Been Exposed via IPC Mechanisms (MSTG-STORAGE-6)
  </a>
  
    <nav class="md-nav" aria-label="Determining Whether Sensitive Stored Data Has Been Exposed via IPC Mechanisms (MSTG-STORAGE-6)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_5" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_5" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav" aria-label="Static Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect-the-android-manifest" class="md-nav__link">
    Inspect the Android Manifest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-the-source-code" class="md-nav__link">
    Inspect the source code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_4" class="md-nav__link">
    Dynamic Analysis
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-content-providers" class="md-nav__link">
    Testing Content Providers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-injection-in-content-providers" class="md-nav__link">
    SQL Injection in Content Providers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-based-content-providers" class="md-nav__link">
    File System Based Content Providers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#checking-for-sensitive-data-disclosure-through-the-user-interface-mstg-storage-7" class="md-nav__link">
    Checking for Sensitive Data Disclosure Through the User Interface (MSTG-STORAGE-7)
  </a>
  
    <nav class="md-nav" aria-label="Checking for Sensitive Data Disclosure Through the User Interface (MSTG-STORAGE-7)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_6" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_6" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav" aria-label="Static Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#text-fields" class="md-nav__link">
    Text Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-notifications_3" class="md-nav__link">
    App Notifications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_5" class="md-nav__link">
    Dynamic Analysis
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#text-fields_1" class="md-nav__link">
    Text Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-notifications_4" class="md-nav__link">
    App Notifications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-backups-for-sensitive-data-mstg-storage-8" class="md-nav__link">
    Testing Backups for Sensitive Data (MSTG-STORAGE-8)
  </a>
  
    <nav class="md-nav" aria-label="Testing Backups for Sensitive Data (MSTG-STORAGE-8)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_7" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_7" class="md-nav__link">
    Static Analysis
  </a>
  
    <nav class="md-nav" aria-label="Static Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    Local
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud" class="md-nav__link">
    Cloud
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_6" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finding-sensitive-information-in-auto-generated-screenshots-mstg-storage-9" class="md-nav__link">
    Finding Sensitive Information in Auto-Generated Screenshots (MSTG-STORAGE-9)
  </a>
  
    <nav class="md-nav" aria-label="Finding Sensitive Information in Auto-Generated Screenshots (MSTG-STORAGE-9)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_8" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_8" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_7" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-memory-for-sensitive-data-mstg-storage-10" class="md-nav__link">
    Testing Memory for Sensitive Data (MSTG-STORAGE-10)
  </a>
  
    <nav class="md-nav" aria-label="Testing Memory for Sensitive Data (MSTG-STORAGE-10)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_9" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_9" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_8" class="md-nav__link">
    Dynamic Analysis
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-and-analyzing-a-memory-dump" class="md-nav__link">
    Retrieving and Analyzing a Memory Dump
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-memory-analysis" class="md-nav__link">
    Runtime Memory Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicitly-dumping-and-analyzing-the-java-heap" class="md-nav__link">
    Explicitly Dumping and Analyzing the Java Heap
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-device-access-security-policy-mstg-storage-11" class="md-nav__link">
    Testing the Device-Access-Security Policy (MSTG-STORAGE-11)
  </a>
  
    <nav class="md-nav" aria-label="Testing the Device-Access-Security Policy (MSTG-STORAGE-11)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_10" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis_10" class="md-nav__link">
    Static Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis_9" class="md-nav__link">
    Dynamic Analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#owasp-masvs" class="md-nav__link">
    OWASP MASVS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#libraries" class="md-nav__link">
    Libraries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05e-Testing-Cryptography/" class="md-nav__link">
        Android Cryptographic APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05f-Testing-Local-Authentication/" class="md-nav__link">
        Android Local Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05g-Testing-Network-Communication/" class="md-nav__link">
        Android Network APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05h-Testing-Platform-Interaction/" class="md-nav__link">
        Android Platform APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05i-Testing-Code-Quality-and-Build-Settings/" class="md-nav__link">
        Android Code Quality and Build Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x05j-Testing-Resiliency-Against-Reverse-Engineering/" class="md-nav__link">
        Android Anti-Reversing Defenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06a-Platform-Overview/" class="md-nav__link">
        iOS Platform Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06b-Basic-Security-Testing/" class="md-nav__link">
        iOS Basic Security Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06c-Reverse-Engineering-and-Tampering/" class="md-nav__link">
        iOS Tampering and Reverse Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06d-Testing-Data-Storage/" class="md-nav__link">
        iOS Data Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06e-Testing-Cryptography/" class="md-nav__link">
        iOS Cryptographic APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06f-Testing-Local-Authentication/" class="md-nav__link">
        iOS Local Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06g-Testing-Network-Communication/" class="md-nav__link">
        iOS Network APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06h-Testing-Platform-Interaction/" class="md-nav__link">
        iOS Platform APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06i-Testing-Code-Quality-and-Build-Settings/" class="md-nav__link">
        iOS Code Quality and Build Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x06j-Testing-Resiliency-Against-Reverse-Engineering/" class="md-nav__link">
        iOS Anti-Reversing Defenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x07-Appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x08-Testing-Tools/" class="md-nav__link">
        Testing Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0x09-Suggested-Reading/" class="md-nav__link">
        Suggested Reading
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/1_How_Can_You_Contribute/" class="md-nav__link">
        How Can You Contribute?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/2_Getting_Started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/3_PRs_and_Reviews/" class="md-nav__link">
        Pull Requests & Reviews
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/4_Add_new_Language/" class="md-nav__link">
        Add a New Language
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/5_Style_Guide/" class="md-nav__link">
        Style Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/OWASP/owasp-mstg/edit/master/docs/MSTG/0x05d-Testing-Data-Storage.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="android-data-storage">Android Data Storage<a class="headerlink" href="#android-data-storage" title="Permanent link">&para;</a></h1>
<p>Protecting authentication tokens, private information, and other sensitive data is key to mobile security. In this chapter, you will learn about the APIs Android offers for local data storage and best practices for using them.</p>
<p>The guidelines for saving data can be summarized quite easily: Public data should be available to everyone, but sensitive and private data must be protected, or, better yet, kept out of device storage.</p>
<p>This chapter is broken into two sections, the first of which focuses on the theory of data storage from a security perspective as well as a brief explanation and example of the various methods of data storage on Android.</p>
<p>The second section focuses on the testing of these data storage solutions through the usage of test cases that utilize both static and dynamic analysis.</p>
<h2 id="theory-overview">Theory Overview<a class="headerlink" href="#theory-overview" title="Permanent link">&para;</a></h2>
<p><a href="https://developer.android.com/guide/topics/data/data-storage.html" title="Storing Data in Android">Storing data</a> is essential to many mobile apps. Conventional wisdom suggests that as little sensitive data as possible should be stored on permanent local storage. In most practical scenarios, however, some type of user data must be stored. For example, asking the user to enter a very complex password every time the app starts isn't a great idea in terms of usability. Most apps must locally cache some kind of authentication token to avoid this. Personally identifiable information (PII) and other types of sensitive data may also be saved if a given scenario calls for it.</p>
<p>Sensitive data is vulnerable when it is not properly protected by the app that is persistently storing it. The app may be able to store the data in several places, for example, on the device or on an external SD card. When you're trying to exploit these kinds of issues, consider that a lot of information may be processed and stored in different locations.</p>
<p>First, it is important to identify the kind of information processed by the mobile application and input by the user. Next, determining what can be considered sensitive data that may be valuable to attackers (e.g., passwords, credit card information, PII) is not always a trivial task and it strongly depends on the context of the target application. You can find more details regarding data classification in the "<a href="../0x04b-Mobile-App-Security-Testing/#identifying-sensitive-data" title="Identifying Sensitive Data">Identifying Sensitive Data</a>" section of the chapter "Mobile App Security Testing". For general information on Android Data Storage Security, refer to the <a href="https://developer.android.com/training/articles/security-tips.html#StoringData" title="Security Tips for Storing Data">Security Tips for Storing Data</a> in the Android developer's guide.</p>
<p>Disclosing sensitive information has several consequences, including decrypted information. In general, an attacker may identify this information and use it for additional attacks, such as social engineering (if PII has been disclosed), account hijacking (if session information or an authentication token has been disclosed), and gathering information from apps that have a payment option (to attack and abuse them).</p>
<p>Next to protecting sensitive data, you need to ensure that data read from any storage source is validated and possibly sanitized. The validation usually ranges from checking for the correct data types to using additional cryptographic controls, such as an HMAC, you can validate the integrity of the data.</p>
<h2 id="data-storage-methods-overview">Data Storage Methods Overview<a class="headerlink" href="#data-storage-methods-overview" title="Permanent link">&para;</a></h2>
<p>Android provides a number of methods for <a href="https://developer.android.com/guide/topics/data/data-storage.html" title="Storing Data in Android">data storage</a> depending on the needs of the user, developer, and application. For example, some apps use data storage to keep track of user settings or user-provided data. Data can be stored persistently for this use case in several ways. The following list of persistent storage techniques are widely used on the Android platform:</p>
<ul>
<li>Shared Preferences</li>
<li>SQLite Databases</li>
<li>Firebase Databases</li>
<li>Realm Databases</li>
<li>Internal Storage</li>
<li>External Storage</li>
<li>Keystore</li>
</ul>
<p>In addition to this, there are a number of other functions in Android built for various use cases that can also result in the storage of data and respectively should also be tested, such as:</p>
<ul>
<li>Logging Functions</li>
<li>Android Backups</li>
<li>Processes Memory</li>
<li>Keyboard Caches</li>
<li>Screenshots</li>
</ul>
<p>It is important to understand each relevant data storage function in order to correctly perform the appropriate test cases. This overview aims to provide a brief outline of each of these data storage methods, as well as point testers to further relevant documentation.</p>
<h3 id="shared-preferences">Shared Preferences<a class="headerlink" href="#shared-preferences" title="Permanent link">&para;</a></h3>
<p>The <a href="https://developer.android.com/training/data-storage/shared-preferences" title="Shared Preferences">SharedPreferences</a> API is commonly used to permanently save small collections of key-value pairs. Data stored in a SharedPreferences object is written to a plain-text XML file. The SharedPreferences object can be declared world-readable (accessible to all apps) or private.
Misuse of the SharedPreferences API can often lead to exposure of sensitive data. Consider the following example:</p>
<p>Example for Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">SharedPreferences</span><span class="w"> </span><span class="n">sharedPref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSharedPreferences</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MODE_WORLD_READABLE</span><span class="p">);</span><span class="w"></span>
<span class="n">SharedPreferences</span><span class="p">.</span><span class="na">Editor</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sharedPref</span><span class="p">.</span><span class="na">edit</span><span class="p">();</span><span class="w"></span>
<span class="n">editor</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;administrator&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">editor</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;supersecret&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">editor</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>Example for Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nv">sharedPref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSharedPreferences</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="na">MODE_WORLD_READABLE</span><span class="p">)</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nv">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sharedPref</span><span class="p">.</span><span class="na">edit</span><span class="p">()</span><span class="w"></span>
<span class="n">editor</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;administrator&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">editor</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;supersecret&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">editor</span><span class="p">.</span><span class="na">commit</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Once the activity has been called, the file key.xml will be created with the provided data. This code violates several best practices.</p>
<ul>
<li>The username and password are stored in clear text in <code>/data/data/&lt;package-name&gt;/shared_prefs/key.xml</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39; standalone=&#39;yes&#39; ?&gt;</span>
<span class="nt">&lt;map&gt;</span>
  <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>administrator<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>supersecret<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/map&gt;</span>
</code></pre></div>
<ul>
<li><code>MODE_WORLD_READABLE</code> allows all applications to access and read the contents of <code>key.xml</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code>root@hermes:/data/data/sg.vp.owasp_mobile.myfirstapp/shared_prefs <span class="c1"># ls -la</span>
-rw-rw-r-- u0_a118    <span class="m">170</span> <span class="m">2016</span>-04-23 <span class="m">16</span>:51 key.xml
</code></pre></div>
<blockquote>
<p>Please note that <code>MODE_WORLD_READABLE</code> and <code>MODE_WORLD_WRITEABLE</code> were deprecated starting on API level 17. Although newer devices may not be affected by this, applications compiled with an <code>android:targetSdkVersion</code> value less than 17 may be affected if they run on an OS version that was released before Android 4.2 (API level 17).</p>
</blockquote>
<h3 id="databases">Databases<a class="headerlink" href="#databases" title="Permanent link">&para;</a></h3>
<p>The Android platform provides a number of database options as aforementioned in the previous list. Each database option has its own quirks and methods that need to be understood.</p>
<h4 id="sqlite-database-unencrypted">SQLite Database (Unencrypted)<a class="headerlink" href="#sqlite-database-unencrypted" title="Permanent link">&para;</a></h4>
<p>SQLite is an SQL database engine that stores data in <code>.db</code> files. The Android SDK has <a href="https://developer.android.com/training/data-storage/sqlite" title="SQLite Documentation">built-in support</a> for SQLite databases. The main package used to manage the databases is <code>android.database.sqlite</code>.
For example, you may use the following code to store sensitive information within an activity:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">notSoSecure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openOrCreateDatabase</span><span class="p">(</span><span class="s">&quot;privateNotSoSecure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MODE_PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="n">notSoSecure</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;CREATE TABLE IF NOT EXISTS Accounts(Username VARCHAR, Password VARCHAR);&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">notSoSecure</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;INSERT INTO Accounts VALUES(&#39;admin&#39;,&#39;AdminPass&#39;);&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">notSoSecure</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nv">notSoSecure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openOrCreateDatabase</span><span class="p">(</span><span class="s">&quot;privateNotSoSecure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="na">MODE_PRIVATE</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="n">notSoSecure</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;CREATE TABLE IF NOT EXISTS Accounts(Username VARCHAR, Password VARCHAR);&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">notSoSecure</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;INSERT INTO Accounts VALUES(&#39;admin&#39;,&#39;AdminPass&#39;);&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">notSoSecure</span><span class="p">.</span><span class="na">close</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Once the activity has been called, the database file <code>privateNotSoSecure</code> will be created with the provided data and stored in the clear text file <code>/data/data/&lt;package-name&gt;/databases/privateNotSoSecure</code>.</p>
<p>The database's directory may contain several files besides the SQLite database:</p>
<ul>
<li><a href="https://www.sqlite.org/tempfiles.html" title="SQLite Journal files">Journal files</a>: These are temporary files used to implement atomic commit and rollback.</li>
<li><a href="https://www.sqlite.org/lockingv3.html" title="SQLite Lock Files">Lock files</a>: The lock files are part of the locking and journaling feature, which was designed to improve SQLite concurrency and reduce the writer starvation problem.</li>
</ul>
<p>Sensitive information should not be stored in unencrypted SQLite databases.</p>
<h4 id="sqlite-databases-encrypted">SQLite Databases (Encrypted)<a class="headerlink" href="#sqlite-databases-encrypted" title="Permanent link">&para;</a></h4>
<p>With the library <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" title="SQLCipher">SQLCipher</a>, SQLite databases can be password-encrypted.</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">SQLiteDatabase</span><span class="w"> </span><span class="n">secureDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SQLiteDatabase</span><span class="p">.</span><span class="na">openOrCreateDatabase</span><span class="p">(</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;password123&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="n">secureDB</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;CREATE TABLE IF NOT EXISTS Accounts(Username VARCHAR,Password VARCHAR);&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">secureDB</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;INSERT INTO Accounts VALUES(&#39;admin&#39;,&#39;AdminPassEnc&#39;);&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">secureDB</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nv">secureDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SQLiteDatabase</span><span class="p">.</span><span class="na">openOrCreateDatabase</span><span class="p">(</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;password123&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="n">secureDB</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;CREATE TABLE IF NOT EXISTS Accounts(Username VARCHAR,Password VARCHAR);&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">secureDB</span><span class="p">.</span><span class="na">execSQL</span><span class="p">(</span><span class="s">&quot;INSERT INTO Accounts VALUES(&#39;admin&#39;,&#39;AdminPassEnc&#39;);&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">secureDB</span><span class="p">.</span><span class="na">close</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Secure ways to retrieve the database key include:</p>
<ul>
<li>Asking the user to decrypt the database with a PIN or password once the app is opened (weak passwords and PINs are vulnerable to brute force attacks)</li>
<li>Storing the key on the server and allowing it to be accessed from a web service only (so that the app can be used only when the device is online)</li>
</ul>
<h4 id="firebase-real-time-databases">Firebase Real-time Databases<a class="headerlink" href="#firebase-real-time-databases" title="Permanent link">&para;</a></h4>
<p>Firebase is a development platform with more than 15 products, and one of them is Firebase Real-time Database. It can be leveraged by application developers to store and sync data with a NoSQL cloud-hosted database. The data is stored as JSON and is synchronized in real-time to every connected client and also remains available even when the application goes offline.</p>
<p>A misconfigured Firebase instance can be identified by making the following network call:</p>
<p><code>https://_firebaseProjectName_.firebaseio.com/.json</code></p>
<p>The <em>firebaseProjectName</em> can be retrieved from the mobile application by reverse engineering the application. Alternatively, the analysts can use <a href="https://github.com/shivsahni/FireBaseScanner" title="Firebase Scanner">Firebase Scanner</a>, a python script that automates the task above as shown below:</p>
<div class="highlight"><pre><span></span><code>python FirebaseScanner.py -p &lt;pathOfAPKFile&gt;

python FirebaseScanner.py -f &lt;commaSeperatedFirebaseProjectNames&gt;
</code></pre></div>
<h4 id="realm-databases">Realm Databases<a class="headerlink" href="#realm-databases" title="Permanent link">&para;</a></h4>
<p>The <a href="https://realm.io/docs/java/latest/" title="Realm Database">Realm Database for Java</a> is becoming more and more popular among developers. The database and its contents can be encrypted with a key stored in the configuration file.</p>
<div class="highlight"><pre><span></span><code><span class="c1">//the getKey() method either gets the key from the server or from a KeyStore, or is derived from a password.</span><span class="w"></span>
<span class="n">RealmConfiguration</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RealmConfiguration</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="na">encryptionKey</span><span class="p">(</span><span class="n">getKey</span><span class="p">())</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w"></span>

<span class="n">Realm</span><span class="w"> </span><span class="n">realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Realm</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">config</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>If the database is not encrypted, you should be able to obtain the data. If the database <em>is</em> encrypted, determine whether the key is hard-coded in the source or resources and whether it is stored unprotected in shared preferences or some other location.</p>
<h3 id="internal-storage">Internal Storage<a class="headerlink" href="#internal-storage" title="Permanent link">&para;</a></h3>
<p>You can save files to the device's <a href="https://developer.android.com/guide/topics/data/data-storage.html#filesInternal" title="Using Internal Storage">internal storage</a>. Files saved to internal storage are containerized by default and cannot be accessed by other apps on the device. When the user uninstalls your app, these files are removed.
The following code snippets would persistently store sensitive data to internal storage.</p>
<p>Example for Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openFileOutput</span><span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="na">MODE_PRIVATE</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">fos</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">test</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span><span class="w"></span>
<span class="w">   </span><span class="n">fos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Example for Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nv">fos</span><span class="p">:</span><span class="w"> </span><span class="n">FileOutputStream? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openFileOutput</span><span class="p">(</span><span class="s">&quot;FILENAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="na">MODE_PRIVATE</span><span class="p">)</span><span class="w"></span>
<span class="n">fos</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">test</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">(</span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">))</span><span class="w"></span>
<span class="n">fos</span><span class="p">.</span><span class="na">close</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>You should check the file mode to make sure that only the app can access the file. You can set this access with <code>MODE_PRIVATE</code>. Modes such as <code>MODE_WORLD_READABLE</code> (deprecated) and <code>MODE_WORLD_WRITEABLE</code> (deprecated) may pose a security risk.</p>
<p>Search for the class <code>FileInputStream</code> to find out which files are opened and read within the app.</p>
<h3 id="external-storage">External Storage<a class="headerlink" href="#external-storage" title="Permanent link">&para;</a></h3>
<p>Every Android-compatible device supports <a href="https://developer.android.com/guide/topics/data/data-storage.html#filesExternal" title="Using External Storage">shared external storage</a>. This storage may be removable (such as an SD card) or internal (non-removable).
Files saved to external storage are world-readable. The user can modify them when USB mass storage is enabled.
You can use the following code snippets to persistently store sensitive information to external storage as the contents of the file <code>password.txt</code>.</p>
<p>Example for Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="na">getExternalFilesDir</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;password.txt&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SecretPassword&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fos</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">fos</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="n">fos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>Example for Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SecretPassword&quot;</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getExternalFilesDir</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;password.txt&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">file</span><span class="p">.</span><span class="na">appendText</span><span class="p">(</span><span class="n">password</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>The file will be created and the data will be stored in a clear text file in external storage once the activity has been called.</p>
<p>It's also worth knowing that files stored outside the application folder (<code>data/data/&lt;package-name&gt;/</code>) will not be deleted when the user uninstalls the application.
Finally, it's worth noting that the external storage can be used by an attacker to allow for arbitrary control of the application in some cases. For more information: <a href="https://blog.checkpoint.com/2018/08/12/man-in-the-disk-a-new-attack-surface-for-android-apps/" title="Man in the disk">see the blog from Checkpoint</a>.</p>
<h3 id="keystore">KeyStore<a class="headerlink" href="#keystore" title="Permanent link">&para;</a></h3>
<p>The <a href="https://www.androidauthority.com/use-android-keystore-store-passwords-sensitive-information-623779/" title="Use Android KeyStore">Android KeyStore</a> supports relatively secure credential storage. As of Android 4.3 (API level 18), it provides public APIs for storing and using app-private keys. An app can use a public key to create a new private/public key pair for encrypting application secrets, and it can decrypt the secrets with the private key.</p>
<p>You can protect keys stored in the Android KeyStore with user authentication in a confirm credential flow. The user's lock screen credentials (pattern, PIN, password, or fingerprint) are used for authentication.</p>
<p>You can use stored keys in one of two modes:</p>
<ol>
<li>
<p>Users are authorized to use keys for a limited period of time after authentication. In this mode, all keys can be used as soon as the user unlocks the device. You can customize the period of authorization for each key. You can use this option only if the secure lock screen is enabled. If the user disables the secure lock screen, all stored keys will become permanently invalid.</p>
</li>
<li>
<p>Users are authorized to use a specific cryptographic operation that is associated with one key. In this mode, users must request a separate authorization for each operation that involves the key. Currently, fingerprint authentication is the only way to request such authorization.</p>
</li>
</ol>
<p>The level of security afforded by the Android KeyStore depends on its implementation, which depends on the device. Most modern devices offer a <a href="./#hardware-backed-android-keyStore">hardware-backed KeyStore implementation</a>: keys are generated and used in a Trusted Execution Environment (TEE) or a Secure Element (SE), and the operating system can't access them directly. This means that the encryption keys themselves can't be easily retrieved, even from a rooted device. You can verify hardware-backed keys with <a href="./#key-attestation">Key Attestation</a> You can determine whether the keys are inside the secure hardware by checking the return value of the <code>isInsideSecureHardware</code> method, which is part of the <a href="https://developer.android.com/reference/android/security/keystore/KeyInfo.html" title="Class KeyInfo"><code>KeyInfo</code> class</a>.</p>
<blockquote>
<p>Note that the relevant KeyInfo indicates that secret keys and HMAC keys are insecurely stored on several devices despite private keys being correctly stored on the secure hardware.</p>
</blockquote>
<p>The keys of a software-only implementation are encrypted with a <a href="https://nelenkov.blogspot.sg/2013/08/credential-storage-enhancements-android-43.html" title="Nikolay Elenvok - Credential storage enhancements in Android 4.3">per-user encryption master key</a>. An attacker can access all keys stored on rooted devices that have this implementation in the folder <code>/data/misc/keystore/</code>. Because the user's lock screen pin/password is used to generate the master key, the Android KeyStore is unavailable when the device is locked. For more security Android 9 (API level 28) introduces the <code>unlockedDeviceRequied</code> flag. By passing <code>true</code> to the <code>setUnlockedDeviceRequired</code> method the app prevents its keys stored in <code>AndroidKeystore</code> from being decrypted when the device is locked, and it requires the screen to be unlocked before allowing decryption.</p>
<h4 id="hardware-backed-android-keystore">Hardware-backed Android KeyStore<a class="headerlink" href="#hardware-backed-android-keystore" title="Permanent link">&para;</a></h4>
<p>As mentioned before, hardware-backed Android KeyStore gives another layer to defense-in-depth security concept for Android. Keymaster Hardware Abstraction Layer (HAL) was introduced with Android 6 (API level 23). Applications can verify if the key is stored inside the security hardware (by checking if <code>KeyInfo.isinsideSecureHardware</code> returns <code>true</code>). Devices running Android 9 (API level 28) and higher can have a <code>StrongBox Keymaster</code> module, an implementation of the Keymaster HAL that resides in a hardware security module which has its own CPU, Secure storage, a true random number generator and a mechanism to resist package tampering. To use this feature, <code>true</code> must be passed to the <code>setIsStrongBoxBacked</code> method in either the <code>KeyGenParameterSpec.Builder</code> class or the <code>KeyProtection.Builder</code> class when generating or importing keys using <code>AndroidKeystore</code>. To make sure that StrongBox is used during runtime, check that <code>isInsideSecureHardware</code> returns <code>true</code> and that the system does not throw <code>StrongBoxUnavailableException</code> which gets thrown if the StrongBox Keymaster isn't available for the given algorithm and key size associated with a key. Description of features on hardware-based keystore can be found on <a href="https://source.android.com/security/keystore" title="AOSP Hardware-based KeyStore">AOSP pages</a>.</p>
<p>Keymaster HAL is an interface to hardware-backed components - Trusted Execution Environment (TEE) or a Secure Element (SE), which is used by Android Keystore. An example of such a hardware-backed component is <a href="https://android-developers.googleblog.com/2018/10/building-titan-better-security-through.html" title="Building a Titan: Better security through a tiny chip">Titan M</a>.</p>
<h4 id="key-attestation">Key Attestation<a class="headerlink" href="#key-attestation" title="Permanent link">&para;</a></h4>
<p>For the applications which heavily rely on Android Keystore for business-critical operations such as multi-factor authentication through cryptographic primitives, secure storage of sensitive data at the client-side, etc. Android provides the feature of <a href="https://developer.android.com/training/articles/security-key-attestation" title="Key Attestation">Key Attestation</a> which helps to analyze the security of cryptographic material managed through Android Keystore. From Android 8.0 (API level 26), the key attestation was made mandatory for all new (Android 7.0 or higher) devices that need to have device certification for Google apps. Such devices use attestation keys signed by the <a href="https://developer.android.com/training/articles/security-key-attestation#root_certificate" title="Google Hardware Attestation Root Certificate">Google hardware attestation root certificate</a> and the same can be verified through the key attestation process.</p>
<p>During key attestation, we can specify the alias of a key pair and in return, get a certificate chain, which we can use to verify the properties of that key pair. If the root certificate of the chain is the <a href="https://developer.android.com/training/articles/security-key-attestation#root_certificate" title="Google Hardware Attestation Root certificate">Google Hardware Attestation Root certificate</a> and the checks related to key pair storage in hardware are made it gives an assurance that the device supports hardware-level key attestation and the key is in the hardware-backed keystore that Google believes to be secure. Alternatively, if the attestation chain has any other root certificate, then Google does not make any claims about the security of the hardware.</p>
<p>Although the key attestation process can be implemented within the application directly but it is recommended that it should be implemented at the server-side for security reasons. The following are the high-level guidelines for the secure implementation of Key Attestation:</p>
<ul>
<li>The server should initiate the key attestation process by creating a random number securely using CSPRNG(Cryptographically Secure Random Number Generator) and the same should be sent to the user as a challenge.</li>
<li>The client should call the <code>setAttestationChallenge</code> API with the challenge received from the server and should then retrieve the attestation certificate chain using the <code>KeyStore.getCertificateChain</code> method.</li>
<li>The attestation response should be sent to the server for the verification and following checks should be performed for the verification of the key attestation response:</li>
<li>Verify the certificate chain, up to the root and perform certificate sanity checks such as validity, integrity and trustworthiness. Check the <a href="https://developer.android.com/training/articles/security-key-attestation#root_certificat" title="Certificate Revocation Status List">Certificate Revocation Status List</a> maintained by Google, if none of the certificates in the chain was revoked.</li>
<li>Check if the root certificate is signed with the Google attestation root key which makes the attestation process trustworthy.</li>
<li>Extract the attestation <a href="https://developer.android.com/training/articles/security-key-attestation#certificate_schema" title="Certificate extension data schema">certificate extension data</a>, which appears within the first element of the certificate chain and perform the following checks:<ul>
<li>Verify that the attestation challenge is having the same value which was generated at the server while initiating the attestation process.</li>
<li>Verify the signature in the key attestation response.</li>
<li>Verify the security level of the Keymaster to determine if the device has secure key storage mechanism. Keymaster is a piece of software that runs in the security context and provides all the secure keystore operations. The security level will be one of <code>Software</code>, <code>TrustedEnvironment</code> or <code>StrongBox</code>. The client supports hardware-level key attestation if security level is <code>TrustedEnvironment</code> or <code>StrongBox</code> and attestation certificate chain contains a root certificate signed with Google attestation root key.</li>
<li>Verify client's status to ensure full chain of trust - verified boot key, locked bootloader and verified boot state.</li>
<li>Additionally, you can verify the key pair's attributes such as purpose, access time, authentication requirement, etc.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note, if for any reason that process fails, it means that the key is not in security hardware. That does not mean that the key is compromised.</p>
</blockquote>
<p>The typical example of Android Keystore attestation response looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;fmt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;android-key&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;authData&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9569088f1ecee3232954035dbd10d7cae391305a2751b559bb8fd7cbb229bd...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;attStmt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;alg&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-7</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;sig&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;304402202ca7a8cfb6299c4a073e7e022c57082a46c657e9e53...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;x5c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;308202ca30820270a003020102020101300a06082a8648ce3d040302308188310b30090603550406130...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;308202783082021ea00302010202021001300a06082a8648ce3d040302308198310b300906035504061...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;3082028b30820232a003020102020900a2059ed10e435b57300a06082a8648ce3d040302308198310b3...&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>In the above JSON snippet, the keys have the following meaning:
        <code>fmt</code>: Attestation statement format identifier
        <code>authData</code>: It denotes the authenticator data for the attestation
        <code>alg</code>: The algorithm that is used for the Signature
        <code>sig</code>: Signature
        <code>x5c</code>: Attestation certificate chain</p>
<p>Note: The <code>sig</code> is generated by concatenating <code>authData</code> and <code>clientDataHash</code> (challenge sent by the server) and signing through the credential private key using the <code>alg</code> signing algorithm and the same is verified at the server-side by using the public key in the first certificate.</p>
<p>For more understanding on the implementation guidelines, <a href="https://github.com/googlesamples/android-key-attestation/blob/master/server/src/main/java/com/android/example/KeyAttestationExample.java" title="Google Sample Code For Android Key Attestation">Google Sample Code</a> can be referred.</p>
<p>For the security analysis perspective the analysts may perform the following checks for the secure implementation of Key Attestation:</p>
<ul>
<li>Check if the key attestation is totally implemented at the client-side. In such scenario, the same can be easily bypassed by tampering the application, method hooking, etc.</li>
<li>Check if the server uses random challenge while initiating the key attestation. As failing to do that would lead to insecure implementation thus making it vulnerable to replay attacks. Also, checks pertaining to the randomness of the challenge should be performed.</li>
<li>Check if the server verifies the integrity of key attestation response.</li>
<li>Check if the server performs basic checks such as integrity verification, trust verification, validity, etc. on the certificates in the chain.</li>
</ul>
<h4 id="secure-key-import-into-keystore">Secure Key Import into Keystore<a class="headerlink" href="#secure-key-import-into-keystore" title="Permanent link">&para;</a></h4>
<p>Android 9 (API level 28) adds the ability to import keys securely into the <code>AndroidKeystore</code>. First <code>AndroidKeystore</code> generates a key pair using <code>PURPOSE_WRAP_KEY</code> which should also be protected with an attestation certificate, this pair aims to protect the Keys being imported to <code>AndroidKeystore</code>. The encrypted keys are generated as ASN.1-encoded message in the <code>SecureKeyWrapper</code> format which also contains a description of the ways the imported key is allowed to be used. The keys are then decrypted inside the <code>AndroidKeystore</code> hardware belonging to the specific device that generated the wrapping key so they never appear as plaintext in the device's host memory.</p>
<p><img src="../../assets/Images/Chapters/0x05d/Android9_secure_key_import_to_keystore.jpg" alt="Secure key import into Keystore" width="500px"/></p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">KeyDescription</span><span class="w"> </span><span class="p">::</span><span class="o">=</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">keyFormat</span><span class="w"> </span><span class="n">INTEGER</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">authorizationList</span><span class="w"> </span><span class="n">AuthorizationList</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">SecureKeyWrapper</span><span class="w"> </span><span class="p">::</span><span class="o">=</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">wrapperFormatVersion</span><span class="w"> </span><span class="n">INTEGER</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">encryptedTransportKey</span><span class="w"> </span><span class="n">OCTET_STRING</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">initializationVector</span><span class="w"> </span><span class="n">OCTET_STRING</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">keyDescription</span><span class="w"> </span><span class="n">KeyDescription</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">secureKey</span><span class="w"> </span><span class="n">OCTET_STRING</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">tag</span><span class="w"> </span><span class="n">OCTET_STRING</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The code above present the different parameters to be set when generating the encrypted keys in the SecureKeyWrapper format. Check the Android documentation on <a href="https://developer.android.com/reference/android/security/keystore/WrappedKeyEntry" title="WrappedKeyEntry"><code>WrappedKeyEntry</code></a> for more details.</p>
<p>When defining the KeyDescription AuthorizationList, the following parameters will affect the encrypted keys security:</p>
<ul>
<li>The <code>algorithm</code> parameter Specifies the cryptographic algorithm with which the key is used</li>
<li>The <code>keySize</code> parameter Specifies the size, in bits, of the key, measuring in the normal way for the key's algorithm</li>
<li>The <code>digest</code> parameter Specifies the digest algorithms that may be used with the key to perform signing and verification operations</li>
</ul>
<h4 id="older-keystore-implementations">Older KeyStore Implementations<a class="headerlink" href="#older-keystore-implementations" title="Permanent link">&para;</a></h4>
<p>Older Android versions don't include KeyStore, but they <em>do</em> include the KeyStore interface from JCA (Java Cryptography Architecture). You can use KeyStores that implement this interface to ensure the secrecy and integrity of keys stored with KeyStore; BouncyCastle KeyStore (BKS) is recommended. All implementations are based on the fact that files are stored on the filesystem; all files are password-protected.
To create one, you can use the <code>KeyStore.getInstance("BKS", "BC") method</code>, where "BKS" is the KeyStore name (BouncyCastle Keystore) and "BC" is the provider (BouncyCastle). You can also use SpongyCastle as a wrapper and initialize the KeyStore as follows: <code>KeyStore.getInstance("BKS", "SC")</code>.</p>
<p>Be aware that not all KeyStores properly protect the keys stored in the KeyStore files.</p>
<h4 id="keychain">KeyChain<a class="headerlink" href="#keychain" title="Permanent link">&para;</a></h4>
<p>The <a href="https://developer.android.com/reference/android/security/KeyChain.html" title="Android KeyChain">KeyChain class</a> is used to store and retrieve <em>system-wide</em> private keys and their corresponding certificates (chain). The user will be prompted to set a lock screen pin or password to protect the credential storage if something is being imported into the KeyChain for the first time. Note that the KeyChain is system-wide, every application can access the materials stored in the KeyChain.</p>
<p>Inspect the source code to determine whether native Android mechanisms identify sensitive information. Sensitive information should be encrypted, not stored in clear text. For sensitive information that must be stored on the device, several API calls are available to protect the data via the <code>KeyChain</code> class. Complete the following steps:</p>
<ul>
<li>Make sure that the app is using the Android KeyStore and Cipher mechanisms to securely store encrypted information on the device. Look for the patterns <code>AndroidKeystore</code>, <code>import java.security.KeyStore</code>, <code>import javax.crypto.Cipher</code>, <code>import java.security.SecureRandom</code>, and corresponding usages.</li>
<li>Use the <code>store(OutputStream stream, char[] password)</code> function to store the KeyStore to disk with a password. Make sure that the password is provided by the user, not hard-coded.</li>
</ul>
<h4 id="storing-a-cryptographic-key-techniques">Storing a Cryptographic Key: Techniques<a class="headerlink" href="#storing-a-cryptographic-key-techniques" title="Permanent link">&para;</a></h4>
<p>To mitigate unauthorized use of keys on the Android device, Android KeyStore lets apps specify authorized uses of their keys when generating or importing the keys. Once made, authorizations cannot be changed.</p>
<p>Storing a Key - from most secure to least secure:</p>
<ul>
<li>the key is stored in hardware-backed Android KeyStore</li>
<li>all keys are stored on server and are available after strong authentication</li>
<li>master key is stored on server and use to encrypt other keys, which are stored in Android SharedPreferences</li>
<li>the key is derived each time from a strong user provided passphrase with sufficient length and salt</li>
<li>the key is stored in software implementation of Android KeyStore</li>
<li>master key is stored in software implementation of Android Keystore and used to encrypt other keys, which are stored in SharedPreferences</li>
<li>[not recommended] all keys are stored in SharedPreferences</li>
<li>[not recommended] hardcoded encryption keys in the source code</li>
<li>[not recommended] predictable obfuscation function or key derivation function based on stable attributes</li>
<li>[not recommended] stored generated keys in public places (like <code>/sdcard/</code>)</li>
</ul>
<h5 id="storing-keys-using-hardware-backed-android-keystore">Storing Keys Using Hardware-backed Android KeyStore<a class="headerlink" href="#storing-keys-using-hardware-backed-android-keystore" title="Permanent link">&para;</a></h5>
<p>You can use the <a href="./#hardware-backed-android-keystore">hardware-backed Android KeyStore</a> if the device is running Android 7.0 (API level 24) and above with available hardware component (Trusted Execution Environment (TEE) or a Secure Element (SE)). You can even verify that the keys are hardware-backed by using the guidelines provided for <a href="./#key-attestation">the secure implementation of Key Attestation</a>. If a hardware component is not available and/or support for Android 6.0 (API level 23) and below is required, then you might want to store your keys on a remote server and make them available after authentication.</p>
<h5 id="storing-keys-on-the-server">Storing Keys on the Server<a class="headerlink" href="#storing-keys-on-the-server" title="Permanent link">&para;</a></h5>
<p>It is possible to securely store keys on a key management server, however the app needs to be online to decrypt the data. This might be a limitation for certain mobile app use cases and should be carefully thought through as this becomes part of the architecture of the app and might highly impact usability.</p>
<h5 id="deriving-keys-from-user-input">Deriving Keys from User Input<a class="headerlink" href="#deriving-keys-from-user-input" title="Permanent link">&para;</a></h5>
<p>Deriving a key from a user provided passphrase is a common solution (depending on which Android API level you use), but it also impacts usability, might affect the attack surface and could introduce additional weaknesses.</p>
<p>Each time the application needs to perform a cryptographic operation, the user's passphrase is needed. Either the user is prompted for it every time, which isn't an ideal user experience, or the passphrase is kept in memory as long as the user is authenticated. Keeping the passphrase in memory is not a best-practice as any cryptographic material must only be kept in memory while it is being used. Zeroing out a key is often a very challenging task as explained in <a href="#cleaning-out-key-material">"Cleaning out Key Material"</a>.</p>
<p>Additionally, consider that keys derived from a passphrase have their own weaknesses. For instance, the passwords or passphrases might be reused by the user or easy to guess. Please refer to the <a href="../0x04g-Testing-Cryptography/#weak-key-generation-functions">Testing Cryptography chapter</a> for more information.</p>
<h5 id="cleaning-out-key-material">Cleaning out Key Material<a class="headerlink" href="#cleaning-out-key-material" title="Permanent link">&para;</a></h5>
<p>The key material should be cleared out from memory as soon as it is not need anymore. There are certain limitations of realibly cleaning up secret data in languages with garbage collector (Java) and immutable strings (Swift, Objective-C, Kotlin). <a href="https://docs.oracle.com/en/java/javase/16/security/java-cryptography-architecture-jca-reference-guide.html#GUID-C9F76AFB-6B20-45A7-B84F-96756C8A94B4" title="Java Cryptography Architecture (JCA) Reference Guide">Java Cryptography Architecture Reference Guide</a> suggests using <code>char[]</code> instead of <code>String</code> for storing sensitive data, and nullify array after usage.</p>
<p>Note that some ciphers do not properly clean up their byte-arrays. For instance, the AES Cipher in BouncyCastle does not always clean up its latest working key leaving some copies of the byte-array in memory. Next, BigInteger based keys (e.g. private keys) cannot be removed from the heap nor zeroed out without additional effort. Clearing byte array can be achieved by writing a wrapper which implements <a href="https://docs.oracle.com/javase/8/docs/api/javax/security/auth/Destroyable.html#destroy--">Destroyable</a>.</p>
<h5 id="storing-keys-using-android-keystore-api">Storing Keys using Android KeyStore API<a class="headerlink" href="#storing-keys-using-android-keystore-api" title="Permanent link">&para;</a></h5>
<p>More user-friendly and recommended way is to use the <a href="https://developer.android.com/reference/java/security/KeyStore.html" title="Android AndroidKeyStore API">Android KeyStore API</a> system (itself or through KeyChain) to store key material. If it is possible, hardware-backed storage should be used. Otherwise, it should fallback to software implementation of Android Keystore. However, be aware that the <code>AndroidKeyStore</code> API has been changed significantly throughout various versions of Android. In earlier versions, the <code>AndroidKeyStore</code> API only supported storing public/private key pairs (e.g., RSA). Symmetric key support has only been added since Android 6.0 (API level 23). As a result, a developer needs to handle the different Android API levels to securely store symmetric keys.</p>
<h5 id="storing-keys-by-encrypting-them-with-other-keys">Storing keys by encrypting them with other keys<a class="headerlink" href="#storing-keys-by-encrypting-them-with-other-keys" title="Permanent link">&para;</a></h5>
<p>In order to securely store symmetric keys on devices running on Android 5.1 (API level 22) or lower, we need to generate a public/private key pair. We encrypt the symmetric key using the public key and store the private key in the <code>AndroidKeyStore</code>. The encrypted symmetric key can encoded using base64 and stored in the <code>SharedPreferences</code>. Whenever we need the symmetric key, the application retrieves the private key from the <code>AndroidKeyStore</code> and decrypts the symmetric key.</p>
<p>Envelope encryption, or key wrapping, is a similar approach that uses symmetric encryption to encapsulate key material. Data encryption keys (DEKs) can be encrypted with key encryption keys (KEKs) which are securely stored. Encrypted DEKs can be stored in <code>SharedPreferences</code> or written to files. When required, the application reads the KEK, then decrypts the DEK. Refer to <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#encrypting-stored-keys" title="OWASP Cryptographic Storage Cheat Sheet: Encrypting Stored Keys">OWASP Cryptographic Storage Cheat Sheet</a> to learn more about encrypting cryptographic keys.</p>
<p>Also, as the illustration of this approach, refer to the <a href="https://developer.android.com/jetpack/androidx/releases/security" title="androidx.security.crypto API reference">EncryptedSharedPreferences from androidx.security.crypto package</a>.</p>
<h5 id="insecure-options-to-store-keys">Insecure options to store keys<a class="headerlink" href="#insecure-options-to-store-keys" title="Permanent link">&para;</a></h5>
<p>A less secure way of storing encryption keys, is in the SharedPreferences of Android. When <a href="https://developer.android.com/reference/android/content/SharedPreferences.html" title="Android SharedPreference API">SharedPreferences</a> are used, the file is only readable by the application that created it. However, on rooted devices any other application with root access can simply read the SharedPreference file of other apps. This is not the case for the AndroidKeyStore. Since AndroidKeyStore access is managed on kernel level, which needs considerably more work and skill to bypass without the AndroidKeyStore clearing or destroying the keys.</p>
<p>The last three options are to use hardcoded encryption keys in the source code, having a predictable obfuscation function or key derivation function based on stable attributes, and storing generated keys in public places like <code>/sdcard/</code>. Hardcoded encryption keys are an issue since this means every instance of the application uses the same encryption key. An attacker can reverse-engineer a local copy of the application in order to extract the cryptographic key, and use that key to decrypt any data which was encrypted by the application on any device.</p>
<p>Next, when you have a predictable key derivation function based on identifiers which are accessible to other applications, the attacker only needs to find the KDF and apply it to the device in order to find the key. Lastly, storing encryption keys publicly also is highly discouraged as other applications can have permission to read the public partition and steal the keys.</p>
<h4 id="third-party-libraries">Third Party libraries<a class="headerlink" href="#third-party-libraries" title="Permanent link">&para;</a></h4>
<p>There are several different open-source libraries that offer encryption capabilities specific for the Android platform.</p>
<ul>
<li><strong><a href="https://github.com/tozny/java-aes-crypto" title="Java AES Crypto">Java AES Crypto</a></strong> - A simple Android class for encrypting and decrypting strings.</li>
<li><strong><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" title="SQL Cipher">SQL Cipher</a></strong> - SQLCipher is an open source extension to SQLite that provides transparent 256-bit AES encryption of database files.</li>
<li><strong><a href="https://github.com/scottyab/secure-preferences" title="Secure Preferences">Secure Preferences</a></strong> - Android Shared preference wrapper than encrypts the keys and values of Shared Preferences.</li>
<li><strong><a href="https://github.com/cossacklabs/themis" title="Themis cryptographic library">Themis</a></strong> - A cross-platform high-level cryptographic library that provides same API across many platforms for securing data during authentication, storage, messaging, etc.</li>
</ul>
<blockquote>
<p>Please keep in mind that as long as the key is not stored in the KeyStore, it is always possible to easily retrieve the key on a rooted device and then decrypt the values you are trying to protect.</p>
</blockquote>
<h3 id="logs">Logs<a class="headerlink" href="#logs" title="Permanent link">&para;</a></h3>
<p>There are many legitimate reasons to create log files on a mobile device, such as keeping track of crashes, errors, and usage statistics. Log files can be stored locally when the app is offline and sent to the endpoint once the app is online. However, logging sensitive data may expose the data to attackers or malicious applications, and it might also violate user confidentiality.
You can create log files in several ways. The following list includes two classes that are available for Android:</p>
<ul>
<li><a href="https://developer.android.com/reference/android/util/Log.html" title="Log Class">Log Class</a></li>
<li><a href="https://developer.android.com/reference/java/util/logging/Logger.html" title="Logger Class">Logger Class</a></li>
</ul>
<h3 id="backups">Backups<a class="headerlink" href="#backups" title="Permanent link">&para;</a></h3>
<p>Android provides users with an auto-backup feature. The backups usually include copies of data and settings for all installed apps. Given its diverse ecosystem, Android supports many backup options:</p>
<ul>
<li>
<p>Stock Android has built-in USB backup facilities. When USB debugging is enabled, you can use the <code>adb backup</code> command to create full data backups and backups of an app's data directory.</p>
</li>
<li>
<p>Google provides a "Back Up My Data" feature that backs up all app data to Google's servers.</p>
</li>
<li>
<p>Two Backup APIs are available to app developers:</p>
</li>
<li>
<p><a href="https://developer.android.com/guide/topics/data/keyvaluebackup.html" title="Key/Value Backup">Key/Value Backup</a> (Backup API or Android Backup Service) uploads to the Android Backup Service cloud.</p>
</li>
<li>
<p><a href="https://developer.android.com/guide/topics/data/autobackup.html" title="Auto Backup for Apps">Auto Backup for Apps</a>: With Android 6.0 (API level 23) and above, Google added the "Auto Backup for Apps feature". This feature automatically syncs at most 25MB of app data with the user's Google Drive account.</p>
</li>
<li>
<p>OEMs may provide additional options. For example, HTC devices have a "HTC Backup" option that performs daily backups to the cloud when activated.</p>
</li>
</ul>
<p>Apps must carefully ensure that sensitive user data doesn't end within these backups as this may allow an attacker to extract it.</p>
<h3 id="process-memory">Process Memory<a class="headerlink" href="#process-memory" title="Permanent link">&para;</a></h3>
<p>All applications on Android use memory to perform normal computational operations like any regular modern-day computer. It is of no surprise then that at times sensitive operations will be performed within process memory. For this reason, it is important that once the relevant sensitive data has been processed, it should be disposed from process memory as quickly as possible.</p>
<p>The investigation of an application's memory can be done from memory dumps, and from analyzing the memory in real time via a debugger.</p>
<p>This is further explained in the 'Testing Memory for Sensitive Data' section.</p>
<h2 id="testing-local-storage-for-sensitive-data-mstg-storage-1-and-mstg-storage-2">Testing Local Storage for Sensitive Data (MSTG-STORAGE-1 and MSTG-STORAGE-2)<a class="headerlink" href="#testing-local-storage-for-sensitive-data-mstg-storage-1-and-mstg-storage-2" title="Permanent link">&para;</a></h2>
<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h3>
<p>This test case focuses on identifying potentially sensitive data stored by an application and verifying if it is securely stored. The following checks should be performed:</p>
<ul>
<li>Analyze data storage in the source code.</li>
<li>Be sure to trigger all possible functionality in the application (e.g. by clicking everywhere possible) in order to ensure data generation.</li>
<li>Check all application generated and modified files and ensure that the storage method is sufficiently secure.</li>
<li>This includes SharedPreferences, SQL databases, Realm Databases, Internal Storage, External Storage, etc.</li>
</ul>
<p>In general sensitive data stored locally on the device should always be at least encrypted, and any keys used for encryption methods should be securely stored within the Android Keystore. These files should also be stored within the application sandbox. If achievable for the application, sensitive data should be stored off device or, even better, not stored at all.</p>
<h3 id="static-analysis">Static Analysis<a class="headerlink" href="#static-analysis" title="Permanent link">&para;</a></h3>
<p>First of all, try to determine the kind of storage used by the Android app and to find out whether the app processes sensitive data insecurely.</p>
<ul>
<li>Check <code>AndroidManifest.xml</code> for read/write external storage permissions, for example, <code>uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"</code>.</li>
<li>Check the source code for keywords and API calls that are used to store data:</li>
<li>File permissions, such as:<ul>
<li><code>MODE_WORLD_READABLE</code> or <code>MODE_WORLD_WRITABLE</code>: You should avoid using <code>MODE_WORLD_WRITEABLE</code> and <code>MODE_WORLD_READABLE</code> for files because any app will be able to read from or write to the files, even if they are stored in the app's private data directory. If data must be shared with other applications, consider a content provider. A content provider offers read and write permissions to other apps and can grant dynamic permission on a case-by-case basis.</li>
</ul>
</li>
<li>Classes and functions, such as:<ul>
<li>the <code>SharedPreferences</code> class ( stores key-value pairs)</li>
<li>the <code>FileOutPutStream</code> class (uses internal or external storage)</li>
<li>the <code>getExternal*</code> functions (use external storage)</li>
<li>the <code>getWritableDatabase</code> function (returns a SQLiteDatabase for writing)</li>
<li>the <code>getReadableDatabase</code> function (returns a SQLiteDatabase for reading)</li>
<li>the <code>getCacheDir</code> and <code>getExternalCacheDirs</code> function (use cached files)</li>
</ul>
</li>
</ul>
<p>Encryption should be implemented using proven SDK functions. The following describes bad practices to look for in the source code:</p>
<ul>
<li>Locally stored sensitive information "encrypted" via simple bit operations like XOR or bit flipping. These operations should be avoided because the encrypted data can be recovered easily.</li>
<li>Keys used or created without Android onboard features, such as the Android KeyStore</li>
<li>Keys disclosed by hard-coding</li>
</ul>
<p>A typical misuse are hard-coded cryptographic keys. Hard-coded and world-readable cryptographic keys significantly increase the possibility that encrypted data will be recovered. Once an attacker obtains the data, decrypting it is trivial. Symmetric cryptography keys must be stored on the device, so identifying them is just a matter of time and effort. Consider the following code:</p>
<div class="highlight"><pre><span></span><code><span class="k">this</span><span class="p">.</span><span class="na">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localUserSecretStore</span><span class="p">.</span><span class="na">getWritableDatabase</span><span class="p">(</span><span class="s">&quot;SuperPassword123&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Obtaining the key is trivial because it is contained in the source code and identical for all installations of the app. Encrypting data this way is not beneficial. Look for hard-coded API keys/private keys and other valuable data; they pose a similar risk. Encoded/encrypted keys represent another attempt to make it harder but not impossible to get the crown jewels.</p>
<p>Consider the following code:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//A more complicated effort to store the XOR&#39;ed halves of a key (instead of the key itself)</span><span class="w"></span>
<span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">myCompositeKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;oNQavjbaNNSgEqoCkT9Em4imeQQ=&quot;</span><span class="p">,</span><span class="s">&quot;3o8eFOX4ri/F8fgHgiy/BS47&quot;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">myCompositeKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrayOf</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;oNQavjbaNNSgEqoCkT9Em4imeQQ=&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3o8eFOX4ri/F8fgHgiy/BS47&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>The algorithm for decoding the original key might be something like this:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">useXorStringHiding</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">myHiddenMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">xorParts0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">myCompositeKey</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">xorParts1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">myCompositeKey</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">xorKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="n">xorParts0</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">xorParts1</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">xorKey</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">xorParts0</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">xorParts1</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">HidingUtil</span><span class="p">.</span><span class="na">doHiding</span><span class="p">(</span><span class="n">myHiddenMessage</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(),</span><span class="w"> </span><span class="n">xorKey</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">useXorStringHiding</span><span class="p">(</span><span class="n">myHiddenMessage</span><span class="p">:</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">xorParts0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">myCompositeKey</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">xorParts1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">myCompositeKey</span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">xorKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteArray</span><span class="p">(</span><span class="n">xorParts0</span><span class="p">.</span><span class="na">size</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">xorParts1</span><span class="p">.</span><span class="na">indices</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">xorKey</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xorParts0</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="n">xor</span><span class="w"> </span><span class="n">xorParts1</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">).</span><span class="na">toByte</span><span class="p">()</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">HidingUtil</span><span class="p">.</span><span class="na">doHiding</span><span class="p">(</span><span class="n">myHiddenMessage</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">(),</span><span class="w"> </span><span class="n">xorKey</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Verify common locations of secrets:</p>
<ul>
<li>resources (typically at res/values/strings.xml)
  Example:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;app_name&quot;</span><span class="nt">&gt;</span>SuperApp<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;hello_world&quot;</span><span class="nt">&gt;</span>Hello world!<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;action_settings&quot;</span><span class="nt">&gt;</span>Settings<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;secret_key&quot;</span><span class="nt">&gt;</span>My_Secret_Key<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;/resources&gt;</span>
</code></pre></div>
<ul>
<li>build configs, such as in local.properties or gradle.properties
  Example:</li>
</ul>
<div class="highlight"><pre><span></span><code>buildTypes {
  debug {
    minifyEnabled true
    buildConfigField &quot;String&quot;, &quot;hiddenPassword&quot;, &quot;\&quot;${hiddenPassword}\&quot;&quot;
  }
}
</code></pre></div>
<h3 id="dynamic-analysis">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis" title="Permanent link">&para;</a></h3>
<p>Install and use the app, executing all functions at least once. Data can be generated when entered by the user, sent by the endpoint, or shipped with the app. Then complete the following:</p>
<ul>
<li>Check both internal and external local storage for any files created by the application that contain sensitive data.</li>
<li>Identify development files, backup files, and old files that shouldn't be included with a production release.</li>
<li>Determine whether SQLite databases are available and whether they contain sensitive information. SQLite databases are stored in <code>/data/data/&lt;package-name&gt;/databases</code>.</li>
<li>Identify if SQLite databases are encrypted. If so, determine how the database password is generated and stored and if this is sufficiently protected as described in the "<a href="#storing-a-key">Storing a Key</a>" section of the Keystore overview.</li>
<li>Check Shared Preferences that are stored as XML files (in <code>/data/data/&lt;package-name&gt;/shared_prefs</code>) for sensitive information. Shared Preferences are insecure and unencrypted by default. Some apps might opt to use <a href="https://github.com/scottyab/secure-preferences" title="Secure-preferences encrypts the values of Shared Preferences">secure-preferences</a> to encrypt the values stored in Shared Preferences.</li>
<li>Check the permissions of the files in <code>/data/data/&lt;package-name&gt;</code>. Only the user and group created when you installed the app (e.g., u0_a82) should have user read, write, and execute permissions (<code>rwx</code>). Other users should not have permission to access files, but they may have execute permissions for directories.</li>
<li>Check for the usage of any Firebase Real-time databases and attempt to identify if they are misconfigured by making the following network call:</li>
<li><code>https://_firebaseProjectName_.firebaseio.com/.json</code></li>
<li>Determine whether a Realm database is available in <code>/data/data/&lt;package-name&gt;/files/</code>, whether it is unencrypted, and whether it contains sensitive information. By default, the file extension is <code>realm</code> and the file name is <code>default</code>. Inspect the Realm database with the <a href="https://github.com/realm/realm-browser-osx" title="Realm Browser for macOS">Realm Browser</a>.</li>
</ul>
<h2 id="testing-local-storage-for-input-validation-mstg-platform-2">Testing Local Storage for Input Validation (MSTG-PLATFORM-2)<a class="headerlink" href="#testing-local-storage-for-input-validation-mstg-platform-2" title="Permanent link">&para;</a></h2>
<h3 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link">&para;</a></h3>
<p>For any publicly accessible data storage, any process can override the data. This means that input validation needs to be applied the moment the data is read back again.</p>
<blockquote>
<p>Note: Similar holds for private accessible data on a rooted device</p>
</blockquote>
<h3 id="static-analysis_1">Static analysis<a class="headerlink" href="#static-analysis_1" title="Permanent link">&para;</a></h3>
<h4 id="using-shared-preferences">Using Shared Preferences<a class="headerlink" href="#using-shared-preferences" title="Permanent link">&para;</a></h4>
<p>When you use the <code>SharedPreferences.Editor</code> to read or write int/boolean/long values, you cannot check whether the data is overridden or not. However: it can hardly be used for actual attacks other than chaining the values (e.g. no additional exploits can be packed which will take over the control flow). In the case of a <code>String</code> or a <code>StringSet</code> you should be careful with how the data is interpreted.
Using reflection based persistence? Check the section on "Testing Object Persistence" for Android to see how it should be validated.
Using the <code>SharedPreferences.Editor</code> to store and read certificates or keys? Make sure you have patched your security provider given vulnerabilities such as found in <a href="https://www.cvedetails.com/cve/CVE-2018-1000613/" title="Key reading vulnerability due to unsafe reflection">Bouncy Castle</a>.</p>
<p>In all cases, having the content HMACed can help to ensure that no additions and/or changes have been applied.</p>
<h4 id="using-other-storage-mechanisms">Using Other Storage Mechanisms<a class="headerlink" href="#using-other-storage-mechanisms" title="Permanent link">&para;</a></h4>
<p>In case other public storage mechanisms (than the <code>SharedPreferences.Editor</code>) are used, the data needs to be validated the moment it is read from the storage mechanism.</p>
<h2 id="testing-logs-for-sensitive-data-mstg-storage-3">Testing Logs for Sensitive Data (MSTG-STORAGE-3)<a class="headerlink" href="#testing-logs-for-sensitive-data-mstg-storage-3" title="Permanent link">&para;</a></h2>
<h3 id="overview_2">Overview<a class="headerlink" href="#overview_2" title="Permanent link">&para;</a></h3>
<p>This test case focuses on identifying any sensitive application data within both system and application logs. The following checks should be performed:</p>
<ul>
<li>Analyze source code for logging related code.</li>
<li>Check application data directory for log files.</li>
<li>Gather system messages and logs and analyze for any sensitive data.</li>
</ul>
<p>As a general recommendation to avoid potential sensitive application data leakage, logging statements should be removed from production releases unless deemed necessary to the application or explicitly identified as safe, e.g. as a result of a security audit.</p>
<h3 id="static-analysis_2">Static Analysis<a class="headerlink" href="#static-analysis_2" title="Permanent link">&para;</a></h3>
<p>Applications will often use the <a href="https://developer.android.com/reference/android/util/Log.html" title="Log Class">Log Class</a> and <a href="https://developer.android.com/reference/java/util/logging/Logger.html" title="Logger Class">Logger Class</a> to create logs. To discover this, you should audit the application's source code for any such logging classes. These can often be found by searching for the following keywords:</p>
<ul>
<li>Functions and classes, such as:</li>
<li><code>android.util.Log</code></li>
<li><code>Log.d</code> | <code>Log.e</code> | <code>Log.i</code> | <code>Log.v</code> | <code>Log.w</code> | <code>Log.wtf</code></li>
<li>
<p><code>Logger</code></p>
</li>
<li>
<p>Keywords and system output:</p>
</li>
<li><code>System.out.print</code> | <code>System.err.print</code></li>
<li>logfile</li>
<li>logging</li>
<li>logs</li>
</ul>
<p>While preparing the production release, you can use tools like <a href="../0x08-Testing-Tools/#proguard">ProGuard</a> (included in Android Studio). To determine whether all logging functions from the <code>android.util.Log</code> class have been removed, check the ProGuard configuration file (proguard-rules.pro) for the following options (according to this <a href="https://www.guardsquare.com/en/products/proguard/manual/examples#logging" title="ProGuard\'s example of removing logging code">example of removing logging code</a> and this article about <a href="https://developer.android.com/studio/build/shrink-code#enable" title="Android Developer - Enable shrinking, obfuscation, and optimization">enabling ProGuard in an Android Studio project</a>):</p>
<div class="highlight"><pre><span></span><code><span class="o">-</span><span class="n">assumenosideeffects</span><span class="w"> </span><span class="kd">class</span> <span class="nc">android</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">Log</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isLoggable</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">String</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">v</span><span class="p">(...);</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">i</span><span class="p">(...);</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">w</span><span class="p">(...);</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">d</span><span class="p">(...);</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">e</span><span class="p">(...);</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">wtf</span><span class="p">(...);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Note that the example above only ensures that calls to the Log class' methods will be removed. If the string that will be logged is dynamically constructed, the code that constructs the string may remain in the bytecode. For example, the following code issues an implicit <code>StringBuilder</code> to construct the log statement:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">Log</span><span class="p">.</span><span class="na">v</span><span class="p">(</span><span class="s">&quot;Private key tag&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Private key [byte format]: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="n">Log</span><span class="p">.</span><span class="na">v</span><span class="p">(</span><span class="s">&quot;Private key tag&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Private key [byte format]: </span><span class="si">$</span><span class="n">key</span><span class="s">&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>The compiled bytecode, however, is equivalent to the bytecode of the following log statement, which constructs the string explicitly:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">Log</span><span class="p">.</span><span class="na">v</span><span class="p">(</span><span class="s">&quot;Private key tag&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="s">&quot;Private key [byte format]: &quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">toString</span><span class="p">()).</span><span class="na">toString</span><span class="p">());</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="n">Log</span><span class="p">.</span><span class="na">v</span><span class="p">(</span><span class="s">&quot;Private key tag&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="s">&quot;Private key [byte format]: &quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">toString</span><span class="p">())</span><span class="w"></span>
</code></pre></div>
<p>ProGuard guarantees removal of the <code>Log.v</code> method call. Whether the rest of the code (<code>new StringBuilder ...</code>) will be removed depends on the complexity of the code and the <a href="https://stackoverflow.com/questions/6009078/removing-unused-strings-during-proguard-optimisation" title="Removing unused strings during ProGuard optimization">ProGuard version</a>.</p>
<p>This is a security risk because the (unused) string leaks plain text data into memory, which can be accessed via a debugger or memory dumping.</p>
<p>Unfortunately, no silver bullet exists for this issue, but one option would be to implement a custom logging facility that takes simple arguments and constructs the log statements internally.</p>
<div class="highlight"><pre><span></span><code><span class="n">SecureLog</span><span class="p">.</span><span class="na">v</span><span class="p">(</span><span class="s">&quot;Private key [byte format]: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Then configure ProGuard to strip its calls.</p>
<h3 id="dynamic-analysis_1">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_1" title="Permanent link">&para;</a></h3>
<p>Use all the mobile app functions at least once, then identify the application's data directory and look for log files (<code>/data/data/&lt;package-name&gt;</code>). Check the application logs to determine whether log data has been generated; some mobile applications create and store their own logs in the data directory.</p>
<p>Many application developers still use <code>System.out.println</code> or <code>printStackTrace</code> instead of a proper logging class. Therefore, your testing strategy must include all output generated while the application is starting, running and closing. To determine what data is directly printed by <code>System.out.println</code> or <code>printStackTrace</code>, you can use <a href="https://developer.android.com/tools/debugging/debugging-log.html" title="Debugging with Logcat"><code>Logcat</code></a> as explained in the chapter "Basic Security Testing", section "Monitoring System Logs".</p>
<p>Remember that you can target a specific app by filtering the Logcat output as follows:</p>
<div class="highlight"><pre><span></span><code>$ adb logcat <span class="p">|</span> grep <span class="s2">&quot;</span><span class="k">$(</span>adb shell ps <span class="p">|</span> grep &lt;package-name&gt; <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
<blockquote>
<p>If you already know the app PID you may give it directly using <code>--pid</code> flag.</p>
</blockquote>
<p>You may also want to apply further filters or regular expressions (using <code>logcat</code>'s regex flags <code>-e &lt;expr&gt;, --regex=&lt;expr&gt;</code> for example) if you expect certain strings or patterns to come up in the logs.</p>
<h2 id="determining-whether-sensitive-data-is-shared-with-third-parties-mstg-storage-4">Determining Whether Sensitive Data Is Shared with Third Parties (MSTG-STORAGE-4)<a class="headerlink" href="#determining-whether-sensitive-data-is-shared-with-third-parties-mstg-storage-4" title="Permanent link">&para;</a></h2>
<h3 id="overview_3">Overview<a class="headerlink" href="#overview_3" title="Permanent link">&para;</a></h3>
<p>Sensitive information might be leaked to third parties by several means, which include but are not limited to the following:</p>
<h3 id="third-party-services-embedded-in-the-app">Third-party Services Embedded in the App<a class="headerlink" href="#third-party-services-embedded-in-the-app" title="Permanent link">&para;</a></h3>
<p>The features these services provide can involve tracking services to monitor the user's behavior while using the app, selling banner advertisements, or improving the user experience.</p>
<p>The downside is that developers don't usually know the details of the code executed via third-party libraries. Consequently, no more information than is necessary should be sent to a service, and no sensitive information should be disclosed.</p>
<p>Most third-party services are implemented in two ways:</p>
<ul>
<li>with a standalone library</li>
<li>with a full SDK</li>
</ul>
<h3 id="app-notifications">App Notifications<a class="headerlink" href="#app-notifications" title="Permanent link">&para;</a></h3>
<p>It is important to understand that <a href="https://developer.android.com/guide/topics/ui/notifiers/notifications" title="Notifications Overview">notifications</a> should never be considered private. When a notification is handled by the Android system it is broadcasted system-wide and any application running with a <a href="https://developer.android.com/reference/kotlin/android/service/notification/NotificationListenerService" title="NotificationListenerService">NotificationListenerService</a> can listen for these notifications to receive them in full and may handle them however it wants.</p>
<p>There are many known malware samples such as <a href="https://research.checkpoint.com/2020/new-joker-variant-hits-google-play-with-an-old-trick/" title="Joker Malware">Joker</a>, and <a href="https://www.threatfabric.com/blogs/alien_the_story_of_cerberus_demise.html" title="Alien Malware">Alien</a> which abuses the <code>NotificationListenerService</code> to listen for notifications on the device and then send them to attacker-controlled C2 infrastructure. Commonly this is done in order to listen for two-factor authentication (2FA) codes that appear as notifications on the device which are then sent to the attacker. A safer alternative for the user would be to use a 2FA application that does not generate notifications.</p>
<p>Furthermore there are a number of apps on the Google Play Store that provide notification logging, which basically logs locally any notifications on the Android system. This highlights that notifications are in no way private on Android and accessible by any other app on the device.</p>
<p>For this reason all notification usage should be inspected for confidential or high risk information that could be used by malicious applications.</p>
<h3 id="static-analysis_3">Static Analysis<a class="headerlink" href="#static-analysis_3" title="Permanent link">&para;</a></h3>
<h4 id="third-party-services-embedded-in-the-app_1">Third-party Services Embedded in the App<a class="headerlink" href="#third-party-services-embedded-in-the-app_1" title="Permanent link">&para;</a></h4>
<p>To determine whether API calls and functions provided by the third-party library are used according to best practices, review their source code, requested permissions and check for any known vulnerabilities (see <a href="../0x05i-Testing-Code-Quality-and-Build-Settings/#checking-for-weaknesses-in-third-party-libraries-mstg-code-5">"Checking for Weaknesses in Third Party Libraries (MSTG-CODE-5)"</a>).</p>
<p>All data that's sent to third-party services should be anonymized to prevent exposure of PII (Personal Identifiable Information) that would allow the third party to identify the user account. No other data (such as IDs that can be mapped to a user account or session) should be sent to a third party.</p>
<h4 id="app-notifications_1">App Notifications<a class="headerlink" href="#app-notifications_1" title="Permanent link">&para;</a></h4>
<p>Search for any usage of the <code>NotificationManager</code> class which might be an indication of some form of notification management. If the class is being used, the next step would be to understand how the application is <a href="https://developer.android.com/training/notify-user/build-notification#SimpleNotification" title="Create a Notification">generating the notifications</a> and which data ends up being shown.</p>
<h3 id="dynamic-analysis_2">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_2" title="Permanent link">&para;</a></h3>
<h4 id="third-party-services-embedded-in-the-app_2">Third-party Services Embedded in the App<a class="headerlink" href="#third-party-services-embedded-in-the-app_2" title="Permanent link">&para;</a></h4>
<p>Check all requests to external services for embedded sensitive information.
To intercept traffic between the client and server, you can perform dynamic analysis by launching a man-in-the-middle (MITM) attack with <a href="../0x08-Testing-Tools/#burp-suite">Burp Suite</a> Professional or <a href="../0x08-Testing-Tools/#owasp-zap">OWASP ZAP</a>. Once you route the traffic through the interception proxy, you can try to sniff the traffic that passes between the app and server. All app requests that aren't sent directly to the server on which the main function is hosted should be checked for sensitive information, such as PII in a tracker or ad service.</p>
<h4 id="app-notifications_2">App Notifications<a class="headerlink" href="#app-notifications_2" title="Permanent link">&para;</a></h4>
<p>Run the application and start tracing all calls to functions related to the notifications creation, e.g. <code>setContentTitle</code> or <code>setContentText</code> from <a href="https://developer.android.com/reference/androidx/core/app/NotificationCompat.Builder"><code>NotificationCompat.Builder</code></a>. Observe the trace in the end and evaluate if it contains any sensitive information which another app might have eavesdropped.</p>
<h2 id="determining-whether-the-keyboard-cache-is-disabled-for-text-input-fields-mstg-storage-5">Determining Whether the Keyboard Cache Is Disabled for Text Input Fields (MSTG-STORAGE-5)<a class="headerlink" href="#determining-whether-the-keyboard-cache-is-disabled-for-text-input-fields-mstg-storage-5" title="Permanent link">&para;</a></h2>
<h3 id="overview_4">Overview<a class="headerlink" href="#overview_4" title="Permanent link">&para;</a></h3>
<p>When users type in input fields, the software automatically suggests data. This feature can be very useful for messaging apps. However, the keyboard cache may disclose sensitive information when the user selects an input field that takes this type of information.</p>
<h3 id="static-analysis_4">Static Analysis<a class="headerlink" href="#static-analysis_4" title="Permanent link">&para;</a></h3>
<p>In the layout definition of an activity, you can define <code>TextViews</code> that have XML attributes. If the XML attribute <code>android:inputType</code> is given the value <code>textNoSuggestions</code>, the keyboard cache will not be shown when the input field is selected. The user will have to type everything manually.</p>
<div class="highlight"><pre><span></span><code>   <span class="nt">&lt;EditText</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/KeyBoardCache&quot;</span>
        <span class="na">android:inputType=</span><span class="s">&quot;textNoSuggestions&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<p>The code for all input fields that take sensitive information should include this XML attribute to <a href="https://developer.android.com/reference/android/text/InputType.html#TYPE_TEXT_FLAG_NO_SUGGESTIONS" title="Disable keyboard suggestions">disable the keyboard suggestions</a>.</p>
<h3 id="dynamic-analysis_3">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_3" title="Permanent link">&para;</a></h3>
<p>Start the app and click in the input fields that take sensitive data. If strings are suggested, the keyboard cache has not been disabled for these fields.</p>
<h2 id="determining-whether-sensitive-stored-data-has-been-exposed-via-ipc-mechanisms-mstg-storage-6">Determining Whether Sensitive Stored Data Has Been Exposed via IPC Mechanisms (MSTG-STORAGE-6)<a class="headerlink" href="#determining-whether-sensitive-stored-data-has-been-exposed-via-ipc-mechanisms-mstg-storage-6" title="Permanent link">&para;</a></h2>
<h3 id="overview_5">Overview<a class="headerlink" href="#overview_5" title="Permanent link">&para;</a></h3>
<p>As part of Android's IPC mechanisms, content providers allow an app's stored data to be accessed and modified by other apps. If not properly configured, these mechanisms may leak sensitive data.</p>
<h3 id="static-analysis_5">Static Analysis<a class="headerlink" href="#static-analysis_5" title="Permanent link">&para;</a></h3>
<p>The first step is to look at <code>AndroidManifest.xml</code> to detect content providers exposed by the app. You can identify content providers by the <code>&lt;provider&gt;</code> element. Complete the following steps:</p>
<ul>
<li>Determine whether the value of the export tag (<code>android:exported</code>) is <code>"true"</code>. Even if it is not, the tag will be set to <code>"true"</code> automatically if an <code>&lt;intent-filter&gt;</code> has been defined for the tag. If the content is meant to be accessed only by the app itself, set <code>android:exported</code> to <code>"false"</code>. If not, set the flag to <code>"true"</code> and define proper read/write permissions.</li>
<li>Determine whether the data is being protected by a permission tag (<code>android:permission</code>). Permission tags limit exposure to other apps.</li>
<li>Determine whether the <code>android:protectionLevel</code> attribute has the value <code>signature</code>. This setting indicates that the data is intended to be accessed only by apps from the same enterprise (i.e., signed with the same key). To make the data accessible to other apps, apply a security policy with the <code>&lt;permission&gt;</code> element and set a proper <code>android:protectionLevel</code>. If you use <code>android:permission</code>, other applications must declare corresponding <code>&lt;uses-permission&gt;</code> elements in their manifests to interact with your content provider. You can use the <code>android:grantUriPermissions</code> attribute to grant more specific access to other apps; you can limit access with the <code>&lt;grant-uri-permission&gt;</code> element.</li>
</ul>
<p>Inspect the source code to understand how the content provider is meant to be used. Search for the following keywords:</p>
<ul>
<li><code>android.content.ContentProvider</code></li>
<li><code>android.database.Cursor</code></li>
<li><code>android.database.sqlite</code></li>
<li><code>.query</code></li>
<li><code>.update</code></li>
<li><code>.delete</code></li>
</ul>
<blockquote>
<p>To avoid SQL injection attacks within the app, use parameterized query methods, such as <code>query</code>, <code>update</code>, and <code>delete</code>. Be sure to properly sanitize all method arguments; for example, the <code>selection</code> argument could lead to SQL injection if it is made up of concatenated user input.</p>
</blockquote>
<p>If you expose a content provider, determine whether parameterized <a href="https://developer.android.com/reference/android/content/ContentProvider.html#query%28android.net.Uri%2C%20java.lang.String[]%2C%20java.lang.String%2C%20java.lang.String[]%2C%20java.lang.String%29" title="Query method in ContentProvider Class">query methods</a> (<code>query</code>, <code>update</code>, and <code>delete</code>) are being used to prevent SQL injection. If so, make sure all their arguments are properly sanitized.</p>
<p>We will use the vulnerable password manager app <a href="https://github.com/mwrlabs/drozer/releases/download/2.3.4/sieve.apk" title="Sieve - Vulnerable Password Manager">Sieve</a> as an example of a vulnerable content provider.</p>
<h4 id="inspect-the-android-manifest">Inspect the Android Manifest<a class="headerlink" href="#inspect-the-android-manifest" title="Permanent link">&para;</a></h4>
<p>Identify all defined <code>&lt;provider&gt;</code> elements:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;provider</span>
      <span class="na">android:authorities=</span><span class="s">&quot;com.mwr.example.sieve.DBContentProvider&quot;</span>
      <span class="na">android:exported=</span><span class="s">&quot;true&quot;</span>
      <span class="na">android:multiprocess=</span><span class="s">&quot;true&quot;</span>
      <span class="na">android:name=</span><span class="s">&quot;.DBContentProvider&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;path-permission</span>
          <span class="na">android:path=</span><span class="s">&quot;/Keys&quot;</span>
          <span class="na">android:readPermission=</span><span class="s">&quot;com.mwr.example.sieve.READ_KEYS&quot;</span>
          <span class="na">android:writePermission=</span><span class="s">&quot;com.mwr.example.sieve.WRITE_KEYS&quot;</span>
     <span class="nt">/&gt;</span>
<span class="nt">&lt;/provider&gt;</span>
<span class="nt">&lt;provider</span>
      <span class="na">android:authorities=</span><span class="s">&quot;com.mwr.example.sieve.FileBackupProvider&quot;</span>
      <span class="na">android:exported=</span><span class="s">&quot;true&quot;</span>
      <span class="na">android:multiprocess=</span><span class="s">&quot;true&quot;</span>
      <span class="na">android:name=</span><span class="s">&quot;.FileBackupProvider&quot;</span>
<span class="nt">/&gt;</span>
</code></pre></div>
<p>As shown in the <code>AndroidManifest.xml</code> above, the application exports two content providers. Note that one path ("/Keys") is protected by read and write permissions.</p>
<h4 id="inspect-the-source-code">Inspect the source code<a class="headerlink" href="#inspect-the-source-code" title="Permanent link">&para;</a></h4>
<p>Inspect the <code>query</code> function in the <code>DBContentProvider.java</code> file to determine whether any sensitive information is being leaked:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">Cursor</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">array2</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">sUriMatcher</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="n">uri</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">SQLiteQueryBuilder</span><span class="w"> </span><span class="n">sqLiteQueryBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQLiteQueryBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sqLiteQueryBuilder</span><span class="p">.</span><span class="na">setTables</span><span class="p">(</span><span class="s">&quot;Passwords&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sqLiteQueryBuilder</span><span class="p">.</span><span class="na">setTables</span><span class="p">(</span><span class="s">&quot;Key&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sqLiteQueryBuilder</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">pwdb</span><span class="p">.</span><span class="na">getReadableDatabase</span><span class="p">(),</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">array2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="n">uri</span><span class="p">:</span><span class="w"> </span><span class="n">Uri?,</span><span class="w"> </span><span class="n">array</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String?</span><span class="o">&gt;?</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span><span class="w"> </span><span class="n">array2</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String?</span><span class="o">&gt;?</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">):</span><span class="w"> </span><span class="n">Cursor</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">match</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">sUriMatcher</span><span class="p">.</span><span class="na">match</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">sqLiteQueryBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SQLiteQueryBuilder</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">sqLiteQueryBuilder</span><span class="p">.</span><span class="na">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Passwords&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">sqLiteQueryBuilder</span><span class="p">.</span><span class="na">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Key&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sqLiteQueryBuilder</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">pwdb</span><span class="p">.</span><span class="na">getReadableDatabase</span><span class="p">(),</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">array2</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Here we see that there are actually two paths, "/Keys" and "/Passwords", and the latter is not being protected in the manifest and is therefore vulnerable.</p>
<p>When accessing a URI, the query statement returns all passwords and the path <code>Passwords/</code>. We will address this in the "Dynamic Analysis" section and show the exact URI that is required.</p>
<h3 id="dynamic-analysis_4">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_4" title="Permanent link">&para;</a></h3>
<h4 id="testing-content-providers">Testing Content Providers<a class="headerlink" href="#testing-content-providers" title="Permanent link">&para;</a></h4>
<p>To dynamically analyze an application's content providers, first enumerate the attack surface: pass the app's package name to the Drozer module <code>app.provider.info</code>:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.info -a com.mwr.example.sieve
  Package: com.mwr.example.sieve
  Authority: com.mwr.example.sieve.DBContentProvider
  Read Permission: null
  Write Permission: null
  Content Provider: com.mwr.example.sieve.DBContentProvider
  Multiprocess Allowed: True
  Grant Uri Permissions: False
  Path Permissions:
  Path: /Keys
  Type: PATTERN_LITERAL
  Read Permission: com.mwr.example.sieve.READ_KEYS
  Write Permission: com.mwr.example.sieve.WRITE_KEYS
  Authority: com.mwr.example.sieve.FileBackupProvider
  Read Permission: null
  Write Permission: null
  Content Provider: com.mwr.example.sieve.FileBackupProvider
  Multiprocess Allowed: True
  Grant Uri Permissions: False
</code></pre></div>
<p>In this example, two content providers are exported. Both can be accessed without permission, except for the <code>/Keys</code> path in the <code>DBContentProvider</code>. With this information, you can reconstruct part of the content URIs to access the <code>DBContentProvider</code> (the URIs begin with <code>content://</code>).</p>
<p>To identify content provider URIs within the application, use Drozer's <code>scanner.provider.finduris</code> module. This module guesses paths and determines accessible content URIs in several ways:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
</code></pre></div>
<p>Once you have a list of accessible content providers, try to extract data from each provider with the <code>app.provider.query</code> module:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: <span class="m">1</span>
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w<span class="o">==</span> <span class="o">(</span>Base64 - encoded<span class="o">)</span>
email: incognitoguy50@gmail.com
</code></pre></div>
<p>You can also use Drozer to insert, update, and delete records from a vulnerable content provider:</p>
<ul>
<li>Insert record</li>
</ul>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.insert content://com.vulnerable.im/messages
                --string date <span class="m">1331763850325</span>
                --string <span class="nb">type</span> <span class="m">0</span>
                --integer _id <span class="m">7</span>
</code></pre></div>
<ul>
<li>Update record</li>
</ul>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.update content://settings/secure
                --selection <span class="s2">&quot;name=?&quot;</span>
                --selection-args assisted_gps_enabled
                --integer value <span class="m">0</span>
</code></pre></div>
<ul>
<li>Delete record</li>
</ul>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.delete content://settings/secure
                --selection <span class="s2">&quot;name=?&quot;</span>
                --selection-args my_setting
</code></pre></div>
<h4 id="sql-injection-in-content-providers">SQL Injection in Content Providers<a class="headerlink" href="#sql-injection-in-content-providers" title="Permanent link">&para;</a></h4>
<p>The Android platform promotes SQLite databases for storing user data. Because these databases are based on SQL, they may be vulnerable to SQL injection. You can use the Drozer module <code>app.provider.query</code> to test for SQL injection by manipulating the projection and selection fields that are passed to the content provider:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection <span class="s2">&quot;&#39;&quot;</span>
unrecognized token: <span class="s2">&quot;&#39; FROM Passwords&quot;</span> <span class="o">(</span>code <span class="m">1</span><span class="o">)</span>: , <span class="k">while</span> compiling: SELECT <span class="s1">&#39; FROM Passwords</span>

<span class="s1">dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection &quot;&#39;</span><span class="s2">&quot;</span>
<span class="s2">unrecognized token: &quot;</span><span class="s1">&#39;)&quot; (code 1): , while compiling: SELECT * FROM Passwords WHERE (&#39;</span><span class="o">)</span>
</code></pre></div>
<p>If an application is vulnerable to SQL Injection, it will return a verbose error message. SQL Injection on Android may be used to modify or query data from the vulnerable content provider. In the following example, the Drozer module <code>app.provider.query</code> is used to list all the database tables:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection <span class="s2">&quot;*</span>
<span class="s2">FROM SQLITE_MASTER WHERE type=&#39;table&#39;;--&quot;</span>
<span class="p">|</span> <span class="nb">type</span>  <span class="p">|</span> name             <span class="p">|</span> tbl_name         <span class="p">|</span> rootpage <span class="p">|</span> sql              <span class="p">|</span>
<span class="p">|</span> table <span class="p">|</span> android_metadata <span class="p">|</span> android_metadata <span class="p">|</span> <span class="m">3</span>        <span class="p">|</span> CREATE TABLE ... <span class="p">|</span>
<span class="p">|</span> table <span class="p">|</span> Passwords        <span class="p">|</span> Passwords        <span class="p">|</span> <span class="m">4</span>        <span class="p">|</span> CREATE TABLE ... <span class="p">|</span>
<span class="p">|</span> table <span class="p">|</span> Key              <span class="p">|</span> Key              <span class="p">|</span> <span class="m">5</span>        <span class="p">|</span> CREATE TABLE ... <span class="p">|</span>
</code></pre></div>
<p>SQL Injection may also be used to retrieve data from otherwise protected tables:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection <span class="s2">&quot;* FROM Key;--&quot;</span>
<span class="p">|</span> Password <span class="p">|</span> pin <span class="p">|</span>
<span class="p">|</span> thisismypassword <span class="p">|</span> <span class="m">9876</span> <span class="p">|</span>
</code></pre></div>
<p>You can automate these steps with the <code>scanner.provider.injection</code> module, which automatically finds vulnerable content providers within an app:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection <span class="k">in</span> Projection:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection <span class="k">in</span> Selection:
  content://com.mwr.example.sieve.DBContentProvider/Keys/
  content://com.mwr.example.sieve.DBContentProvider/Passwords
  content://com.mwr.example.sieve.DBContentProvider/Passwords/
</code></pre></div>
<h4 id="file-system-based-content-providers">File System Based Content Providers<a class="headerlink" href="#file-system-based-content-providers" title="Permanent link">&para;</a></h4>
<p>Content providers can provide access to the underlying filesystem. This allows apps to share files (the Android sandbox normally prevents this). You can use the Drozer modules <code>app.provider.read</code> and <code>app.provider.download</code> to read and download files, respectively, from exported file-based content providers. These content providers are susceptible to directory traversal, which allows otherwise protected files in the target application's sandbox to be read.</p>
<div class="highlight"><pre><span></span><code>dz&gt; run app.provider.download content://com.vulnerable.app.FileProvider/../../../../../../../../data/data/com.vulnerable.app/database.db /home/user/database.db
Written <span class="m">24488</span> bytes
</code></pre></div>
<p>Use the <code>scanner.provider.traversal</code> module to automate the process of finding content providers that are susceptible to directory traversal:</p>
<div class="highlight"><pre><span></span><code>dz&gt; run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
  content://com.mwr.example.sieve.FileBackupProvider/
  content://com.mwr.example.sieve.FileBackupProvider
</code></pre></div>
<p>Note that <code>adb</code> can also be used to query content providers:</p>
<div class="highlight"><pre><span></span><code>$ adb shell content query --uri content://com.owaspomtg.vulnapp.provider.CredentialProvider/credentials
Row: <span class="m">0</span> <span class="nv">id</span><span class="o">=</span><span class="m">1</span>, <span class="nv">username</span><span class="o">=</span>admin, <span class="nv">password</span><span class="o">=</span>StrongPwd
Row: <span class="m">1</span> <span class="nv">id</span><span class="o">=</span><span class="m">2</span>, <span class="nv">username</span><span class="o">=</span>test, <span class="nv">password</span><span class="o">=</span><span class="nb">test</span>
...
</code></pre></div>
<h2 id="checking-for-sensitive-data-disclosure-through-the-user-interface-mstg-storage-7">Checking for Sensitive Data Disclosure Through the User Interface (MSTG-STORAGE-7)<a class="headerlink" href="#checking-for-sensitive-data-disclosure-through-the-user-interface-mstg-storage-7" title="Permanent link">&para;</a></h2>
<h3 id="overview_6">Overview<a class="headerlink" href="#overview_6" title="Permanent link">&para;</a></h3>
<p>Entering sensitive information when, for example, registering an account or making payments, is an essential part of using many apps. This data may be financial information such as credit card data or user account passwords. The data may be exposed if the app doesn't properly mask it while it is being typed.</p>
<p>In order to prevent disclosure and mitigate risks such as <a href="https://en.wikipedia.org/wiki/Shoulder_surfing_%28computer_security%29">shoulder surfing</a> you should verify that no sensitive data is exposed via the user interface unless explicitly required (e.g. a password being entered). For the data required to be present it should be properly masked, typically by showing asterisks or dots instead of clear text.</p>
<p>Carefully review all UI components that either show such information or take it as input. Search for any traces of sensitive information and evaluate if it should be masked or completely removed.</p>
<h3 id="static-analysis_6">Static Analysis<a class="headerlink" href="#static-analysis_6" title="Permanent link">&para;</a></h3>
<h4 id="text-fields">Text Fields<a class="headerlink" href="#text-fields" title="Permanent link">&para;</a></h4>
<p>To make sure an application is masking sensitive user input, check for the following attribute in the definition of <code>EditText</code>:</p>
<div class="highlight"><pre><span></span><code>android:inputType=&quot;textPassword&quot;
</code></pre></div>
<p>With this setting, dots (instead of the input characters) will be displayed in the text field, preventing the app from leaking passwords or pins to the user interface.</p>
<h4 id="app-notifications_3">App Notifications<a class="headerlink" href="#app-notifications_3" title="Permanent link">&para;</a></h4>
<p>When statically assessing an application, it is recommended to search for any usage of the <code>NotificationManager</code> class which might be an indication of some form of notification management. If the class is being used, the next step would be to understand how the application is <a href="https://developer.android.com/training/notify-user/build-notification#SimpleNotification" title="Create a Notification">generating the notifications</a>.</p>
<p>These code locations can be fed into the Dynamic Analysis section below, providing an idea of where in the application notifications may be dynamically generated.</p>
<h3 id="dynamic-analysis_5">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_5" title="Permanent link">&para;</a></h3>
<p>To determine whether the application leaks any sensitive information to the user interface, run the application and identify components that could be disclosing information.</p>
<h4 id="text-fields_1">Text Fields<a class="headerlink" href="#text-fields_1" title="Permanent link">&para;</a></h4>
<p>If the information is masked by, for example, replacing input with asterisks or dots, the app isn't leaking data to the user interface.</p>
<h4 id="app-notifications_4">App Notifications<a class="headerlink" href="#app-notifications_4" title="Permanent link">&para;</a></h4>
<p>To identify the usage of notifications run through the entire application and all its available functions looking for ways to trigger any notifications. Consider that you may need to perform actions outside of the application in order to trigger certain notifications.</p>
<p>While running the application you may want to start tracing all calls to functions related to the notifications creation, e.g. <code>setContentTitle</code> or <code>setContentText</code> from <a href="https://developer.android.com/reference/androidx/core/app/NotificationCompat.Builder"><code>NotificationCompat.Builder</code></a>. Observe the trace in the end and evaluate if it contains any sensitive information.</p>
<h2 id="testing-backups-for-sensitive-data-mstg-storage-8">Testing Backups for Sensitive Data (MSTG-STORAGE-8)<a class="headerlink" href="#testing-backups-for-sensitive-data-mstg-storage-8" title="Permanent link">&para;</a></h2>
<h3 id="overview_7">Overview<a class="headerlink" href="#overview_7" title="Permanent link">&para;</a></h3>
<p>This test case focuses on ensuring that backups do not store sensitive application specific data. The following checks should be performed:</p>
<ul>
<li>Check <code>AndroidManifest.xml</code> for relevant backup flags.</li>
<li>Attempt to backup the application and inspect the backup for sensitive data.</li>
</ul>
<h3 id="static-analysis_7">Static Analysis<a class="headerlink" href="#static-analysis_7" title="Permanent link">&para;</a></h3>
<h4 id="local">Local<a class="headerlink" href="#local" title="Permanent link">&para;</a></h4>
<p>Android provides an attribute called <a href="https://developer.android.com/guide/topics/manifest/application-element.html#allowbackup" title="allowBackup attribute"><code>allowBackup</code></a> to back up all your application data. This attribute is set in the <code>AndroidManifest.xml</code> file. If the value of this attribute is <strong>true</strong>, the device allows users to back up the application with Android Debug Bridge (ADB) via the command <code>$ adb backup</code>.</p>
<p>To prevent the app data backup, set the <code>android:allowBackup</code> attribute to <strong>false</strong>. When this attribute is unavailable, the allowBackup setting is enabled by default, and backup must be manually deactivated.</p>
<blockquote>
<p>Note: If the device was encrypted, then the backup files will be encrypted as well.</p>
</blockquote>
<p>Check the <code>AndroidManifest.xml</code> file for the following flag:</p>
<div class="highlight"><pre><span></span><code>android:allowBackup=&quot;true&quot;
</code></pre></div>
<p>If the flag value is <strong>true</strong>, determine whether the app saves any kind of sensitive data (check the test case "Testing for Sensitive Data in Local Storage").</p>
<h4 id="cloud">Cloud<a class="headerlink" href="#cloud" title="Permanent link">&para;</a></h4>
<p>Regardless of whether you use key/value backup or auto backup, you must determine the following:</p>
<ul>
<li>which files are sent to the cloud (e.g., SharedPreferences)</li>
<li>whether the files contain sensitive information</li>
<li>whether sensitive information is encrypted before being sent to the cloud.</li>
</ul>
<blockquote>
<p>If you don't want to share files with Google Cloud, you can exclude them from <a href="https://developer.android.com/guide/topics/data/autobackup.html#IncludingFiles" title="Exclude files from Auto Backup">Auto Backup</a>. Sensitive information stored at rest on the device should be encrypted before being sent to the cloud.</p>
</blockquote>
<ul>
<li><strong>Auto Backup</strong>: You configure Auto Backup via the boolean attribute <code>android:allowBackup</code> within the application's manifest file. <a href="https://developer.android.com/guide/topics/data/autobackup.html#EnablingAutoBackup" title="Enabling AutoBackup">Auto Backup</a> is enabled by default for applications that target Android 6.0 (API level 23). You can use the attribute <code>android:fullBackupOnly</code> to activate auto backup when implementing a backup agent, but this attribute is available for Android versions 6.0 and above only. Other Android versions use key/value backup instead.</li>
</ul>
<div class="highlight"><pre><span></span><code>android:fullBackupOnly
</code></pre></div>
<p>Auto backup includes almost all the app files and stores up 25 MB of them per app in the user's Google Drive account. Only the most recent backup is stored; the previous backup is deleted.</p>
<ul>
<li><strong>Key/Value Backup</strong>: To enable key/value backup, you must define the backup agent in the manifest file. Look in <code>AndroidManifest.xml</code> for the following attribute:</li>
</ul>
<div class="highlight"><pre><span></span><code>android:backupAgent
</code></pre></div>
<p>To implement key/value backup, extend one of the following classes:</p>
<ul>
<li><a href="https://developer.android.com/reference/android/app/backup/BackupAgent.html" title="BackupAgent">BackupAgent</a></li>
<li><a href="https://developer.android.com/reference/android/app/backup/BackupAgentHelper.html" title="BackupAgentHelper">BackupAgentHelper</a></li>
</ul>
<p>To check for key/value backup implementations, look for these classes in the source code.</p>
<h3 id="dynamic-analysis_6">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_6" title="Permanent link">&para;</a></h3>
<p>After executing all available app functions, attempt to back up via <code>adb</code>. If the backup is successful, inspect the backup archive for sensitive data. Open a terminal and run the following command:</p>
<div class="highlight"><pre><span></span><code>$ adb backup -apk -nosystem &lt;package-name&gt;
</code></pre></div>
<p>ADB should respond now with "Now unlock your device and confirm the backup operation" and you should be asked on the Android phone for a password. This is an optional step and you don't need to provide one. If the phone does not prompt this message, try the following command including the quotes:</p>
<div class="highlight"><pre><span></span><code>$ adb backup <span class="s2">&quot;-apk -nosystem &lt;package-name&gt;&quot;</span>
</code></pre></div>
<p>The problem happens when your device has an adb version prior to 1.0.31. If that's the case you must use an adb version of 1.0.31 also on your host computer. Versions of adb after 1.0.32 <a href="https://issuetracker.google.com/issues/37096097" title="adb backup is broken since ADB version 1.0.32">broke the backwards compatibility.</a></p>
<p>Approve the backup from your device by selecting the <em>Back up my data</em> option. After the backup process is finished, the file <em>.ab</em> will be in your working directory.
Run the following command to convert the .ab file to tar.</p>
<div class="highlight"><pre><span></span><code>$ dd <span class="k">if</span><span class="o">=</span>mybackup.ab <span class="nv">bs</span><span class="o">=</span><span class="m">24</span> <span class="nv">skip</span><span class="o">=</span><span class="m">1</span><span class="p">|</span>openssl zlib -d &gt; mybackup.tar
</code></pre></div>
<p>In case you get the error <code>openssl:Error: 'zlib' is an invalid command.</code> you can try to use Python instead.</p>
<div class="highlight"><pre><span></span><code>$ dd <span class="k">if</span><span class="o">=</span>backup.ab <span class="nv">bs</span><span class="o">=</span><span class="m">1</span> <span class="nv">skip</span><span class="o">=</span><span class="m">24</span> <span class="p">|</span> python -c <span class="s2">&quot;import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))&quot;</span> &gt; backup.tar
</code></pre></div>
<p>The <a href="https://github.com/nelenkov/android-backup-extractor" title="Android Backup Extractor"><em>Android Backup Extractor</em></a> is another alternative backup tool. To make the tool to work, you have to download the Oracle JCE Unlimited Strength Jurisdiction Policy Files for <a href="https://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html" title="Oracle JCE Unlimited Strength Jurisdiction Policy Files JRE7">JRE7</a> or <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html" title="Oracle JCE Unlimited Strength Jurisdiction Policy Files JRE8">JRE8</a> and place them in the JRE lib/security folder. Run the following command to convert the tar file:</p>
<div class="highlight"><pre><span></span><code>$ java -jar abe.jar unpack backup.ab
</code></pre></div>
<p>if it shows some Cipher information and usage, which means it hasn't unpacked successfully. In this case you can give a try with more arguments:</p>
<div class="highlight"><pre><span></span><code>$ abe <span class="o">[</span>-debug<span class="o">]</span> <span class="o">[</span>-useenv<span class="o">=</span>yourenv<span class="o">]</span> unpack &lt;backup.ab&gt; &lt;backup.tar&gt; <span class="o">[</span>password<span class="o">]</span>
</code></pre></div>
<p>[password]: is the password when your android device asked you earlier. For example here is: 123</p>
<div class="highlight"><pre><span></span><code>$ java -jar abe.jar unpack backup.ab backup.tar <span class="m">123</span>
</code></pre></div>
<p>Extract the tar file to your working directory.</p>
<div class="highlight"><pre><span></span><code>$ tar xvf mybackup.tar
</code></pre></div>
<h2 id="finding-sensitive-information-in-auto-generated-screenshots-mstg-storage-9">Finding Sensitive Information in Auto-Generated Screenshots (MSTG-STORAGE-9)<a class="headerlink" href="#finding-sensitive-information-in-auto-generated-screenshots-mstg-storage-9" title="Permanent link">&para;</a></h2>
<h3 id="overview_8">Overview<a class="headerlink" href="#overview_8" title="Permanent link">&para;</a></h3>
<p>Manufacturers want to provide device users with an aesthetically pleasing experience at application startup and exit, so they introduced the screenshot-saving feature for use when the application is backgrounded. This feature may pose a security risk. Sensitive data may be exposed if the user deliberately screenshots the application while sensitive data is displayed. A malicious application that is running on the device and able to continuously capture the screen may also expose data. Screenshots are written to local storage, from which they may be recovered by a rogue application (if the device is rooted) or someone who has stolen the device.</p>
<p>For example, capturing a screenshot of a banking application may reveal information about the user's account, credit, transactions, and so on.</p>
<h3 id="static-analysis_8">Static Analysis<a class="headerlink" href="#static-analysis_8" title="Permanent link">&para;</a></h3>
<p>A screenshot of the current activity is taken when an Android app goes into background and displayed for aesthetic purposes when the app returns to the foreground. However, this may leak sensitive information.</p>
<p>To determine whether the application may expose sensitive information via the app switcher, find out whether the <a href="https://developer.android.com/reference/android/view/Display.html#FLAG_SECURE" title="FLAG_SECURE Option"><code>FLAG_SECURE</code></a> option has been set. You should find something similar to the following code snippet:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">getWindow</span><span class="p">().</span><span class="na">setFlags</span><span class="p">(</span><span class="n">WindowManager</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">FLAG_SECURE</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">WindowManager</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">FLAG_SECURE</span><span class="p">);</span><span class="w"></span>

<span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_main</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="n">window</span><span class="p">.</span><span class="na">setFlags</span><span class="p">(</span><span class="n">WindowManager</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">FLAG_SECURE</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">WindowManager</span><span class="p">.</span><span class="na">LayoutParams</span><span class="p">.</span><span class="na">FLAG_SECURE</span><span class="p">)</span><span class="w"></span>

<span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_main</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>If the option has not been set, the application is vulnerable to screen capturing.</p>
<h3 id="dynamic-analysis_7">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_7" title="Permanent link">&para;</a></h3>
<p>While black-box testing the app, navigate to any screen that contains sensitive information and click the home button to send the app to the background, then press the app switcher button to see the snapshot. As shown below, if <code>FLAG_SECURE</code> is set (left image), the snapshot will be empty; if the flag has not been set (right image), activity information will be shown:</p>
<p><img src="../../assets/Images/Chapters/0x05d/2.png" width="200px" />
<img src="../../assets/Images/Chapters/0x05d/1.png" width="200px" /></p>
<p>On devices supporting <a href="https://source.android.com/security/encryption/file-based" title="FBE">file-based encryption (FBE)</a>, snapshots are stored in the <code>/data/system_ce/&lt;USER_ID&gt;/&lt;IMAGE_FOLDER_NAME&gt;</code> folder. <code>&lt;IMAGE_FOLDER_NAME&gt;</code> depends on the vendor but most common names are <code>snapshots</code> and <code>recent_images</code>. If the device doesn't support FBE, the <code>/data/system/&lt;IMAGE_FOLDER_NAME&gt;</code> folder is used.</p>
<blockquote>
<p>Accessing these folders and the snapshots requires root.</p>
</blockquote>
<h2 id="testing-memory-for-sensitive-data-mstg-storage-10">Testing Memory for Sensitive Data (MSTG-STORAGE-10)<a class="headerlink" href="#testing-memory-for-sensitive-data-mstg-storage-10" title="Permanent link">&para;</a></h2>
<h3 id="overview_9">Overview<a class="headerlink" href="#overview_9" title="Permanent link">&para;</a></h3>
<p>Analyzing memory can help developers identify the root causes of several problems, such as application crashes. However, it can also be used to access sensitive data. This section describes how to check for data disclosure via process memory.</p>
<p>First identify sensitive information that is stored in memory. Sensitive assets have likely been loaded into memory at some point. The objective is to verify that this information is exposed as briefly as possible.</p>
<p>To investigate an application's memory, you must first create a memory dump. You can also analyze the memory in real-time, e.g., via a debugger. Regardless of your approach, memory dumping is a very error-prone process in terms of verification because each dump contains the output of executed functions. You may miss executing critical scenarios. In addition, overlooking data during analysis is probable unless you know the data's footprint (either the exact value or the data format). For example, if the app encrypts with a randomly generated symmetric key, you likely won't be able to spot it in memory unless you can recognize the key's value in another context.</p>
<p>Therefore, you are better off starting with static analysis.</p>
<h3 id="static-analysis_9">Static Analysis<a class="headerlink" href="#static-analysis_9" title="Permanent link">&para;</a></h3>
<p>For an overview of possible sources of data exposure, check the documentation and identify application components before you examine the source code. For example, sensitive data from a backend may be in the HTTP client, the XML parser, etc. You want all these copies to be removed from memory as soon as possible.</p>
<p>In addition, understanding the application's architecture and the architecture's role in the system will help you identify sensitive information that doesn't have to be exposed in memory at all. For example, assume your app receives data from one server and transfers it to another without any processing. That data can be handled in an encrypted format, which prevents exposure in memory.</p>
<p>However, if you need to expose sensitive data in memory, you should make sure that your app is designed to expose as few data copies as possible as briefly as possible. In other words, you want the handling of sensitive data to be centralized (i.e., with as few components as possible) and based on primitive, mutable data structures.</p>
<p>The latter requirement gives developers direct memory access. Make sure that they use this access to overwrite the sensitive data with dummy data (typically zeroes). Examples of preferable data types include <code>byte []</code> and <code>char []</code>, but not <code>String</code> or <code>BigInteger</code>. Whenever you try to modify an immutable object like <code>String</code>, you create and change a copy of the object.</p>
<p>Using non-primitive mutable types like <code>StringBuffer</code> and <code>StringBuilder</code> may be acceptable, but it's indicative and requires care. Types like <code>StringBuffer</code> are used to modify content (which is what you want to do). To access such a type's value, however, you would use the <code>toString</code> method, which would create an immutable copy of the data. There are several ways to use these data types without creating an immutable copy, but they require more effort than simply using a primitive array. Safe memory management is one benefit of using types like <code>StringBuffer</code> , but this can be a two-edged sword. If you try to modify the content of one of these types and the copy exceeds the buffer capacity, the buffer size will automatically increase. The buffer content may be copied to a different location, leaving the old content without a reference you can use to overwrite it.</p>
<p>Unfortunately, few libraries and frameworks are designed to allow sensitive data to be overwritten. For example, destroying a key, as shown below, doesn't really remove the key from memory:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">SecretKey</span><span class="w"> </span><span class="n">secretKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SecretKeySpec</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;AES&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">secretKey</span><span class="p">.</span><span class="na">destroy</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">secretKey</span><span class="p">:</span><span class="w"> </span><span class="n">SecretKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SecretKeySpec</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;AES&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">secretKey</span><span class="p">.</span><span class="na">destroy</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Overwriting the backing byte-array from <code>secretKey.getEncoded</code> doesn't remove the key either; the SecretKeySpec-based key returns a copy of the backing byte-array. See the sections below for the proper way to remove a <code>SecretKey</code> from memory.</p>
<p>The RSA key pair is based on the <code>BigInteger</code> type and therefore resides in memory after its first use outside the <code>AndroidKeyStore</code>. Some ciphers (such as the AES <code>Cipher</code> in <code>BouncyCastle</code>) do not properly clean up their byte-arrays.</p>
<p>User-provided data (credentials, social security numbers, credit card information, etc.) is another type of data that may be exposed in memory. Regardless of whether you flag it as a password field, <code>EditText</code> delivers content to the app via the <code>Editable</code> interface. If your app doesn't provide <code>Editable.Factory</code>, user-provided data will probably be exposed in memory for longer than necessary. The default <code>Editable</code> implementation, the <code>SpannableStringBuilder</code>, causes the same issues as Java's <code>StringBuilder</code> and <code>StringBuffer</code> cause (discussed above).</p>
<p>In summary, when performing static analysis to identify sensitive data that is exposed in memory, you should:</p>
<ul>
<li>Try to identify application components and map where data is used.</li>
<li>Make sure that sensitive data is handled by as few components as possible.</li>
<li>Make sure that object references are properly removed once the object containing the sensitive data is no longer needed.</li>
<li>Make sure that garbage collection is requested after references have been removed.</li>
<li>Make sure that sensitive data gets overwritten as soon as it is no longer needed.</li>
<li>Don't represent such data with immutable data types (such as <code>String</code> and <code>BigInteger</code>).</li>
<li>Avoid non-primitive data types (such as <code>StringBuilder</code>).</li>
<li>Overwrite references before removing them, outside the <code>finalize</code> method.</li>
<li>Pay attention to third-party components (libraries and frameworks).
    Public APIs are good indicators. Determine whether the public API handles the sensitive data as described in this chapter.</li>
</ul>
<p><strong>The following section describes pitfalls of data leakage in memory and best practices for avoiding them.</strong></p>
<p>Don't use immutable structures (e.g., <code>String</code> and <code>BigInteger</code>) to represent secrets. Nullifying these structures will be ineffective: the garbage collector may collect them, but they may remain on the heap after garbage collection. Nevertheless, you should ask for garbage collection after every critical operation (e.g., encryption, parsing server responses that contain sensitive information). When copies of the information have not been properly cleaned (as explained below), your request will help reduce the length of time for which these copies are available in memory.</p>
<p>To properly clean sensitive information from memory, store it in primitive data types, such as byte-arrays (<code>byte[]</code>) and char-arrays (<code>char[]</code>). As described in the "Static Analysis" section above, you should avoid storing the information in mutable non-primitive data types.</p>
<p>Make sure to overwrite the content of the critical object once the object is no longer needed. Overwriting the content with zeroes is one simple and very popular method:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="k">try</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//get or generate the secret, do work with it, make sure you make no local copies</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">secret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Arrays</span><span class="p">.</span><span class="na">fill</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">secret</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="c1">//get or generate the secret, do work with it, make sure you make no local copies</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">secret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Arrays</span><span class="p">.</span><span class="na">fill</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="w"> </span><span class="m">0.</span><span class="n">toByte</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>This doesn't, however, guarantee that the content will be overwritten at runtime. To optimize the bytecode, the compiler will analyze and decide not to overwrite data because it will not be used afterwards (i.e., it is an unnecessary operation). Even if the code is in the compiled DEX, the optimization may occur during the just-in-time or ahead-of-time compilation in the VM.</p>
<p>There is no silver bullet for this problem because different solutions have different consequences. For example, you may perform additional calculations (e.g., XOR the data into a dummy buffer), but you'll have no way to know the extent of the compiler's optimization analysis. On the other hand, using the overwritten data outside the compiler's scope (e.g., serializing it in a temp file) guarantees that it will be overwritten but obviously impacts performance and maintenance.</p>
<p>Then, using <code>Arrays.fill</code> to overwrite the data is a bad idea because the method is an obvious hooking target (see the chapter "<a href="../0x05c-Reverse-Engineering-and-Tampering/">Tampering and Reverse Engineering on Android</a>" for more details).</p>
<p>The final issue with the above example is that the content was overwritten with zeroes only. You should try to overwrite critical objects with random data or content from non-critical objects. This will make it really difficult to construct scanners that can identify sensitive data on the basis of its management.</p>
<p>Below is an improved version of the previous example:</p>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">nonSecret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">somePublicString</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="s">&quot;ISO-8859-1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="k">try</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//get or generate the secret, do work with it, make sure you make no local copies</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">secret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">secret</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">secret</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nonSecret</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">nonSecret</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;/dev/null&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">secret</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">nonSecret</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">somePublicString</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="s">&quot;ISO-8859-1&quot;</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nv">secret</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="c1">//get or generate the secret, do work with it, make sure you make no local copies</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">secret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">secret</span><span class="p">.</span><span class="na">indices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">secret</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nonSecret</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">nonSecret</span><span class="p">.</span><span class="na">size</span><span class="o">]</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;/dev/null&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="na">flush</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="na">close</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>For more information, take a look at <a href="https://www.nowsecure.com/resources/secure-mobile-development/coding-practices/securely-store-sensitive-data-in-ram/" title="Securely store sensitive data in RAM">Securely Storing Sensitive Data in RAM</a>.</p>
<p>In the "Static Analysis" section, we mentioned the proper way to handle cryptographic keys when you are using <code>AndroidKeyStore</code> or <code>SecretKey</code>.</p>
<p>For a better implementation of <code>SecretKey</code>, look at the <code>SecureSecretKey</code> class below. Although the implementation is probably missing some boilerplate code that would make the class compatible with <code>SecretKey</code>, it addresses the main security concerns:</p>
<ul>
<li>No cross-context handling of sensitive data. Each copy of the key can be cleared from within the scope in which it was created.</li>
<li>The local copy is cleared according to the recommendations given above.</li>
</ul>
<p>Example in Java:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SecureSecretKey</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">javax</span><span class="p">.</span><span class="na">crypto</span><span class="p">.</span><span class="na">SecretKey</span><span class="p">,</span><span class="w"> </span><span class="n">Destroyable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kd">private</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">key</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">algorithm</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Constructs SecureSecretKey instance out of a copy of the provided key bytes.</span>
<span class="cm">        * The caller is responsible of clearing the key array provided as input.</span>
<span class="cm">        * The internal copy of the key can be cleared by calling the destroy() method.</span>
<span class="cm">        */</span><span class="w"></span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="nf">SecureSecretKey</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">algorithm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="na">algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">algorithm</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAlgorithm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">algorithm</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getFormat</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;RAW&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Returns a copy of the key.</span>
<span class="cm">        * Make sure to clear the returned byte array when no longer needed.</span>
<span class="cm">        */</span><span class="w"></span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getEncoded</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">key</span><span class="p">){</span><span class="w"></span>
<span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cm">/** Overwrites the key with dummy data to ensure this copy is no longer present in memory.*/</span><span class="w"></span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">destroy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isDestroyed</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">nonSecret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="s">&quot;RuntimeException&quot;</span><span class="p">).</span><span class="na">getBytes</span><span class="p">(</span><span class="s">&quot;ISO-8859-1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">key</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nonSecret</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">nonSecret</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;/dev/null&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">out</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">out</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="n">out</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>

<span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="na">gc</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isDestroyed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Example in Kotlin:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">SecureSecretKey</span><span class="p">(</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray</span><span class="p">,</span><span class="w"> </span><span class="n">algorithm</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SecretKey</span><span class="p">,</span><span class="w"> </span><span class="n">Destroyable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">key</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray?</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">algorithm</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAlgorithm</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">algorithm</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getFormat</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;RAW&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/** Returns a copy of the key.</span>
<span class="cm">     * Make sure to clear the returned byte array when no longer needed.</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getEncoded</span><span class="p">():</span><span class="w"> </span><span class="n">ByteArray</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">key</span><span class="o">!!</span><span class="p">.</span><span class="na">clone</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/** Overwrites the key with dummy data to ensure this copy is no longer present in memory. */</span><span class="w"></span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">destroy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isDestroyed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">nonSecret</span><span class="p">:</span><span class="w"> </span><span class="n">ByteArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="s">&quot;RuntimeException&quot;</span><span class="p">).</span><span class="na">toByteArray</span><span class="p">(</span><span class="n">charset</span><span class="p">(</span><span class="s">&quot;ISO-8859-1&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">key</span><span class="o">!!</span><span class="p">.</span><span class="na">indices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">key</span><span class="o">!![</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nonSecret</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">nonSecret</span><span class="p">.</span><span class="na">size</span><span class="o">]</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;/dev/null&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="na">flush</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="na">close</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">gc</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isDestroyed</span><span class="p">():</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="cm">/** Constructs SecureSecretKey instance out of a copy of the provided key bytes.</span>
<span class="cm">     * The caller is responsible of clearing the key array provided as input.</span>
<span class="cm">     * The internal copy of the key can be cleared by calling the destroy() method.</span>
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">.</span><span class="na">clone</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">algorithm</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Secure user-provided data is the final secure information type usually found in memory. This is often managed by implementing a custom input method, for which you should follow the recommendations given here. However, Android allows information to be partially erased from <code>EditText</code> buffers via a custom <code>Editable.Factory</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">EditText</span><span class="w"> </span><span class="n">editText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"> </span><span class="c1">//  point your variable to your EditText instance</span><span class="w"></span>
<span class="n">EditText</span><span class="p">.</span><span class="na">setEditableFactory</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Editable</span><span class="p">.</span><span class="na">Factory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Editable</span><span class="w"> </span><span class="nf">newEditable</span><span class="p">(</span><span class="n">CharSequence</span><span class="w"> </span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="c1">// return a new instance of a secure implementation of Editable.</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>
<p>Refer to the <code>SecureSecretKey</code> example above for an example <code>Editable</code> implementation. Note that you will be able to securely handle all copies made by <code>editText.getText</code> if you provide your factory. You can also try to overwrite the internal <code>EditText</code> buffer by calling <code>editText.setText</code>, but there is no guarantee that the buffer will not have been copied already. If you choose to rely on the default input method and <code>EditText</code>, you will have no control over the keyboard or other components that are used. Therefore, you should use this approach for semi-confidential information only.</p>
<p>In all cases, make sure that sensitive data in memory is cleared when a user signs out of the application. Finally, make sure that highly sensitive information is cleared out the moment an Activity or Fragment's <code>onPause</code> event is triggered.</p>
<blockquote>
<p>Note that this might mean that a user has to re-authenticate every time the application resumes.</p>
</blockquote>
<h3 id="dynamic-analysis_8">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_8" title="Permanent link">&para;</a></h3>
<p>Static analysis will help you identify potential problems, but it can't provide statistics about how long data has been exposed in memory, nor can it help you identify problems in closed-source dependencies. This is where dynamic analysis comes into play.</p>
<p>There are various ways to analyze the memory of a process, e.g. live analysis via a debugger/dynamic instrumentation and analyzing one or more memory dumps.</p>
<h4 id="retrieving-and-analyzing-a-memory-dump">Retrieving and Analyzing a Memory Dump<a class="headerlink" href="#retrieving-and-analyzing-a-memory-dump" title="Permanent link">&para;</a></h4>
<p>Whether you are using a rooted or a non-rooted device, you can dump the app's process memory with <a href="https://github.com/sensepost/objection" title="Objection">objection</a> and <a href="https://github.com/Nightbringer21/fridump" title="Fridump">Fridump</a>. You can find a detailed explanation of this process in the section "<a href="../0x05c-Reverse-Engineering-and-Tampering/#memory-dump" title="Memory Dump">Memory Dump</a>", in the chapter "Tampering and Reverse Engineering on Android".</p>
<p>After the memory has been dumped (e.g. to a file called "memory"), depending on the nature of the data you're looking for, you'll need a set of different tools to process and analyze that memory dump. For instance, if you're focusing on strings, it might be sufficient for you to execute the command <code>strings</code> or <code>rabin2 -zz</code> to extract those strings.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># using strings</span>
$ strings memory &gt; strings.txt

<span class="c1"># using rabin2</span>
$ rabin2 -ZZ memory &gt; strings.txt
</code></pre></div>
<p>Open <code>strings.txt</code> in your favorite editor and dig through it to identify sensitive information.</p>
<p>However if you'd like to inspect other kind of data, you'd rather want to use radare2 and its search capabilities. See radare2's help on the search command (<code>/?</code>) for more information and a list of options. The following shows only a subset of them:</p>
<div class="highlight"><pre><span></span><code>$ r2 &lt;name_of_your_dump_file&gt;

<span class="o">[</span>0x00000000<span class="o">]</span>&gt; /?
Usage: /<span class="o">[</span>!bf<span class="o">]</span> <span class="o">[</span>arg<span class="o">]</span>  Search stuff <span class="o">(</span>see <span class="s1">&#39;e??search&#39;</span> <span class="k">for</span> options<span class="o">)</span>
<span class="p">|</span>Use io.va <span class="k">for</span> searching <span class="k">in</span> non virtual addressing spaces
<span class="p">|</span> / foo<span class="se">\x</span><span class="m">00</span>                    search <span class="k">for</span> string <span class="s1">&#39;foo\0&#39;</span>
<span class="p">|</span> /c<span class="o">[</span>ar<span class="o">]</span>                       search <span class="k">for</span> crypto materials
<span class="p">|</span> /e /E.F/i                    match regular expression
<span class="p">|</span> /i foo                       search <span class="k">for</span> string <span class="s1">&#39;foo&#39;</span> ignoring <span class="k">case</span>
<span class="p">|</span> /m<span class="o">[</span>?<span class="o">][</span>ebm<span class="o">]</span> magicfile         search <span class="k">for</span> magic, filesystems or binary headers
<span class="p">|</span> /v<span class="o">[</span><span class="m">1248</span><span class="o">]</span> value               look <span class="k">for</span> an <span class="sb">`</span>cfg.bigendian<span class="sb">`</span> 32bit value
<span class="p">|</span> /w foo                       search <span class="k">for</span> wide string <span class="s1">&#39;f\0o\0o\0&#39;</span>
<span class="p">|</span> /x ff0033                    search <span class="k">for</span> hex string
<span class="p">|</span> /z min max                   search <span class="k">for</span> strings of given size
...
</code></pre></div>
<h4 id="runtime-memory-analysis">Runtime Memory Analysis<a class="headerlink" href="#runtime-memory-analysis" title="Permanent link">&para;</a></h4>
<p>Instead of dumping the memory to your host computer, you can alternatively use <a href="../0x08-Testing-Tools/#r2frida">r2frida</a>. With it, you can analyze and inspect the app's memory while it's running.
For example, you may run the previous search commands from r2frida and search the memory for a string, hexadecimal values, etc. When doing so, remember to prepend the search command (and any other r2frida specific commands) with a backslash <code>\</code> after starting the session with <code>r2 frida://usb//&lt;name_of_your_app&gt;</code>.</p>
<p>For more information, options and approaches, please refer to section "<a href="../0x05c-Reverse-Engineering-and-Tampering/#in-memory-search" title="In-Memory Search">In-Memory Search</a>" in the chapter "Tampering and Reverse Engineering on Android".</p>
<h4 id="explicitly-dumping-and-analyzing-the-java-heap">Explicitly Dumping and Analyzing the Java Heap<a class="headerlink" href="#explicitly-dumping-and-analyzing-the-java-heap" title="Permanent link">&para;</a></h4>
<p>For rudimentary analysis, you can use Android Studio's built-in tools. They are on the <em>Android Monitor</em> tab. To dump memory, select the device and app you want to analyze and click <em>Dump Java Heap</em>. This will create a <em>.hprof</em> file in the <em>captures</em> directory, which is on the app's project path.</p>
<p><img src="../../assets/Images/Chapters/0x05d/Dump_Java_Heap.png" width="100%" /></p>
<p>To navigate through class instances that were saved in the memory dump, select the Package Tree View in the tab showing the <em>.hprof</em> file.</p>
<p><img src="../../assets/Images/Chapters/0x05d/Package_Tree_View.png" width="100%" /></p>
<p>For more advanced analysis of the memory dump, use the <a href="https://eclipse.org/mat/downloads.php" title="Eclipse Memory Analyzer Tool">Eclipse Memory Analyzer Tool (MAT)</a>. It is available as an Eclipse plugin and as a standalone application.</p>
<p>To analyze the dump in MAT, use the <em>hprof-conv</em> platform tool, which comes with the Android SDK.</p>
<div class="highlight"><pre><span></span><code>$ ./hprof-conv memory.hprof memory-mat.hprof
</code></pre></div>
<p>MAT provides several tools for analyzing the memory dump. For example, the <em>Histogram</em> provides an estimate of the number of objects that have been captured from a given type, and the <em>Thread Overview</em> shows processes' threads and stack frames. The <em>Dominator Tree</em> provides information about keep-alive dependencies between objects. You can use regular expressions to filter the results these tools provide.</p>
<p><em>Object Query Language</em> studio is a MAT feature that allows you to query objects from the memory dump with an SQL-like language. The tool allows you to transform simple objects by invoking Java methods on them, and it provides an API for building sophisticated tools on top of the MAT.</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span><span class="w"></span>
</code></pre></div>
<p>In the example above, all <code>String</code> objects present in the memory dump will be selected. The results will include the object's class, memory address, value, and retain count. To filter this information and see only the value of each string, use the following code:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">toString</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="k">object</span><span class="w"></span>
</code></pre></div>
<p>Or</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="k">object</span><span class="w"></span>
</code></pre></div>
<p>SQL supports primitive data types as well, so you can do something like the following to access the content of all <code>char</code> arrays:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">toString</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nb">char</span><span class="p">[]</span><span class="w"> </span><span class="n">arr</span><span class="w"></span>
</code></pre></div>
<p>Don't be surprised if you get results that are similar to the previous results; after all, <code>String</code> and other Java data types are just wrappers around primitive data types. Now let's filter the results. The following sample code will select all byte arrays that contain the ASN.1 OID of an RSA key. This doesn't imply that a given byte array actually contains an RSA (the same byte sequence may be part of something else), but this is probable.</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">toString</span><span class="p">(</span><span class="n">b</span><span class="p">).</span><span class="n">matches</span><span class="p">(</span><span class="ss">&quot;.*1\.2\.840\.113549\.1\.1\.1.*&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Finally, you don't have to select whole objects. Consider an SQL analogy: classes are tables, objects are rows, and fields are columns. If you want to find all objects that have a "password" field, you can do something like the following:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">&quot;.*&quot;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="k">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>During your analysis, search for:</p>
<ul>
<li>Indicative field names: "password", "pass", "pin", "secret", "private", etc.</li>
<li>Indicative patterns (e.g., RSA footprints) in strings, char arrays, byte arrays, etc.</li>
<li>Known secrets (e.g., a credit card number that you've entered or an authentication token provided by the backend)</li>
<li>etc.</li>
</ul>
<p>Repeating tests and memory dumps will help you obtain statistics about the length of data exposure. Furthermore, observing the way a particular memory segment (e.g., a byte array) changes may lead you to some otherwise unrecognizable sensitive data (more on this in the "Remediation" section below).</p>
<h2 id="testing-the-device-access-security-policy-mstg-storage-11">Testing the Device-Access-Security Policy (MSTG-STORAGE-11)<a class="headerlink" href="#testing-the-device-access-security-policy-mstg-storage-11" title="Permanent link">&para;</a></h2>
<h3 id="overview_10">Overview<a class="headerlink" href="#overview_10" title="Permanent link">&para;</a></h3>
<p>Apps that process or query sensitive information should run in a trusted and secure environment. To create this environment, the app can check the device for the following:</p>
<ul>
<li>PIN- or password-protected device locking</li>
<li>Recent Android OS version</li>
<li>USB Debugging activation</li>
<li>Device encryption</li>
<li>Device rooting (see also "Testing Root Detection")</li>
</ul>
<h3 id="static-analysis_10">Static Analysis<a class="headerlink" href="#static-analysis_10" title="Permanent link">&para;</a></h3>
<p>To test the device-access-security policy that the app enforces, a written copy of the policy must be provided. The policy should define available checks and their enforcement. For example, one check could require that the app run only on Android 6.0 (API level 23) or a more recent version, closing the app or displaying a warning if the Android version is less than 6.0.</p>
<p>Check the source code for functions that implement the policy and determine whether it can be bypassed.</p>
<p>You can implement checks on the Android device by querying  <a href="https://developer.android.com/reference/android/provider/Settings.Secure.html" title="Settings.Secure"><em>Settings.Secure</em></a> for system preferences. <a href="https://developer.android.com/guide/topics/admin/device-admin.html" title="Device Administration API"><em>Device Administration API</em></a> offers techniques for creating applications that can enforce password policies and device encryption.</p>
<h3 id="dynamic-analysis_9">Dynamic Analysis<a class="headerlink" href="#dynamic-analysis_9" title="Permanent link">&para;</a></h3>
<p>The dynamic analysis depends on the checks enforced by the app and their expected behavior. If the checks can be bypassed, they must be validated.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<h3 id="owasp-masvs">OWASP MASVS<a class="headerlink" href="#owasp-masvs" title="Permanent link">&para;</a></h3>
<ul>
<li>MSTG-STORAGE-1: "System credential storage facilities need to be used to store sensitive data, such as PII, user credentials or cryptographic keys."</li>
<li>MSTG-STORAGE-2: "No sensitive data should be stored outside of the app container or system credential storage facilities."</li>
<li>MSTG-STORAGE-3: "No sensitive data is written to application logs."</li>
<li>MSTG-STORAGE-4: "No sensitive data is shared with third parties unless it is a necessary part of the architecture."</li>
<li>MSTG-STORAGE-5: "The keyboard cache is disabled on text inputs that process sensitive data."</li>
<li>MSTG-STORAGE-6: "No sensitive data is exposed via IPC mechanisms."</li>
<li>MSTG-STORAGE-7: "No sensitive data, such as passwords or pins, is exposed through the user interface."</li>
<li>MSTG-STORAGE-8: "No sensitive data is included in backups generated by the mobile operating system."</li>
<li>MSTG-STORAGE-9: "The app removes sensitive data from views when moved to the background."</li>
<li>MSTG-STORAGE-10: "The app does not hold sensitive data in memory longer than necessary, and memory is cleared explicitly after use."</li>
<li>MSTG-STORAGE-11: "The app enforces a minimum device-access-security policy, such as requiring the user to set a device passcode."</li>
<li>MSTG-PLATFORM-2: "All inputs from external sources and the user are validated and if necessary sanitized. This includes data received via the UI, IPC mechanisms such as intents, custom URLs, and network sources."</li>
</ul>
<h3 id="libraries">Libraries<a class="headerlink" href="#libraries" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/tozny/java-aes-crypto" title="Java AES Crypto">Java AES Crypto</a></li>
<li><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android" title="SQL Cipher for Android">SQL Cipher</a></li>
<li><a href="https://github.com/scottyab/secure-preferences" title="Secure Preferences">Secure Preferences</a></li>
<li><a href="https://github.com/cossacklabs/themis" title="Themis cryptographic library">Themis</a></li>
</ul>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../0x05c-Reverse-Engineering-and-Tampering/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Android Tampering and Reverse Engineering" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Android Tampering and Reverse Engineering
            </div>
          </div>
        </a>
      
      
        
        <a href="../0x05e-Testing-Cryptography/" class="md-footer__link md-footer__link--next" aria-label="Next: Android Cryptographic APIs" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Android Cryptographic APIs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <div style="float: left; padding-right: 1em;">
  <a href="https://www.owasp.org"><img src="https://github.com/OWASP/owasp-mstg/blob/master/Document/Images/OWASP_logo_white.png?raw=true" width="100px" /></a>
</div>
<span>
  &#169; OWASP Foundation 2022. This work is licensed under 
  <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>. For any reuse or distribution, you must make clear to others the license terms of this work.
</span>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://owasp.slack.com/messages/project-mobile_omtg/details/" target="_blank" rel="noopener" title="owasp.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/OWASP_MSTG" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/OWASP/owasp-mstg/discussions" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "toc.integrate", "navigation.top"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../javascripts/tablesort.js"></script>
      
    
  </body>
</html>